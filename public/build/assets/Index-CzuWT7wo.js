import{c as D,i as g,o as m,f as e,s as re,l as X,t as w,v as te,z as ie,x as de,R as ke,k as j,n as A,F as ae,m as _e,g as F,r as V,w as G,u as Ce,Z as $e,q as Ee,N as Q}from"./vendor-d19pJyVS.js";import{a as ee}from"./utils-Dq7h7Pqt.js";import{N as je}from"./app-BcT2PLJy.js";import{g as Ve}from"./pdfGenerator-C15gTT3V.js";import{A as Me}from"./AppLayout-CcnrZQKI.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Be}from"./Modales-BBthfVFz.js";import{_ as Pe}from"./Pagination-B0Pz79Or.js";import"./jspdf.es.min-BE3S9W4e.js";const De={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Ne={class:"bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-5 border-b border-gray-200/60"},Fe={class:"flex items-center justify-between"},Le={class:"flex items-center space-x-3"},Ie={class:"px-6 py-4 bg-gray-50/30 border-b border-gray-200/40"},Te={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},Se={class:"bg-white p-4 rounded-lg border border-gray-200/50 shadow-sm"},Ae={class:"flex items-center justify-between"},ze={class:"text-2xl font-bold text-gray-900"},Oe={class:"bg-white p-4 rounded-lg border border-gray-200/50 shadow-sm"},Ue={class:"flex items-center justify-between"},He={class:"text-2xl font-bold text-gray-600"},We={class:"bg-white p-4 rounded-lg border border-gray-200/50 shadow-sm"},qe={class:"flex items-center justify-between"},Xe={class:"text-2xl font-bold text-yellow-600"},Ke={class:"bg-white p-4 rounded-lg border border-gray-200/50 shadow-sm"},Re={class:"flex items-center justify-between"},Ge={class:"text-2xl font-bold text-blue-600"},Ye={class:"bg-white p-4 rounded-lg border border-gray-200/50 shadow-sm"},Ze={class:"flex items-center justify-between"},Je={class:"text-2xl font-bold text-red-600"},Qe={class:"px-6 py-4 bg-white border-b border-gray-200/40"},et={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0"},tt={class:"flex-1 max-w-md"},ot={class:"relative"},at=["placeholder"],rt={class:"flex items-center space-x-3"},st={class:"relative"},nt={__name:"VentasHeader",props:{total:{type:Number,default:0},borrador:{type:Number,default:0},aprobadas:{type:Number,default:0},pendientes:{type:Number,default:0},cancelada:{type:Number,default:0},searchTerm:{type:String,default:""},sortBy:{type:String,default:"fecha-desc"},filtroEstado:{type:String,default:""},config:{type:Object,default:()=>({})}},emits:["update:searchTerm","update:sortBy","update:filtroEstado","limpiar-filtros","crear-nuevo"],setup(p,{emit:M}){const c=p,f=M,B=D({get:()=>c.searchTerm,set:b=>f("update:searchTerm",b)});D({get:()=>c.sortBy,set:b=>f("update:sortBy",b)});const P=D({get:()=>c.filtroEstado,set:b=>f("update:filtroEstado",b)}),z=b=>{f("update:searchTerm",b.target.value)},k=b=>{f("update:filtroEstado",b.target.value)},U=()=>{f("limpiar-filtros")},h=()=>{f("crear-nuevo")};return(b,i)=>(m(),g("div",De,[e("div",Ne,[e("div",Fe,[i[3]||(i[3]=re('<div class="flex items-center space-x-4" data-v-83ea9ee0><div class="flex items-center space-x-3" data-v-83ea9ee0><div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center shadow-sm" data-v-83ea9ee0><svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-83ea9ee0><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-83ea9ee0></path></svg></div><div data-v-83ea9ee0><h1 class="text-xl font-bold text-gray-900 tracking-tight" data-v-83ea9ee0>Ventas</h1><p class="text-sm text-gray-600" data-v-83ea9ee0>Gestión de ventas del sistema</p></div></div></div>',1)),e("div",Le,[e("button",{onClick:h,class:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 shadow-sm hover:shadow-md"},[i[2]||(i[2]=e("svg",{class:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),X(" "+w(p.config.createButtonText||"Nueva Venta"),1)])])])]),e("div",Ie,[e("div",Te,[e("div",Se,[e("div",Ae,[e("div",null,[i[4]||(i[4]=e("p",{class:"text-sm font-medium text-gray-600"},"Total",-1)),e("p",ze,w(p.total),1)]),i[5]||(i[5]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))])]),e("div",Oe,[e("div",Ue,[e("div",null,[i[6]||(i[6]=e("p",{class:"text-sm font-medium text-gray-600"},"Borradores",-1)),e("p",He,w(p.borrador),1)]),i[7]||(i[7]=e("div",{class:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})])],-1))])]),e("div",We,[e("div",qe,[e("div",null,[i[8]||(i[8]=e("p",{class:"text-sm font-medium text-gray-600"},"Pendientes",-1)),e("p",Xe,w(p.pendientes),1)]),i[9]||(i[9]=e("div",{class:"w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Ke,[e("div",Re,[e("div",null,[i[10]||(i[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Aprobadas",-1)),e("p",Ge,w(p.aprobadas),1)]),i[11]||(i[11]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Ye,[e("div",Ze,[e("div",null,[i[12]||(i[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Canceladas",-1)),e("p",Je,w(p.cancelada),1)]),i[13]||(i[13]=e("div",{class:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1))])])])]),e("div",Qe,[e("div",et,[e("div",tt,[e("div",ot,[i[14]||(i[14]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),te(e("input",{"onUpdate:modelValue":i[0]||(i[0]=H=>B.value=H),type:"text",placeholder:p.config.searchPlaceholder||"Buscar ventas...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-green-500 focus:border-green-500 transition-colors duration-200",onInput:z},null,40,at),[[ie,B.value]])])]),e("div",rt,[e("div",st,[te(e("select",{"onUpdate:modelValue":i[1]||(i[1]=H=>P.value=H),class:"block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500 rounded-lg transition-colors duration-200 bg-white",onChange:k},i[15]||(i[15]=[re('<option value="" data-v-83ea9ee0>Todos los estados</option><option value="borrador" data-v-83ea9ee0>Borrador</option><option value="pendiente" data-v-83ea9ee0>Pendiente</option><option value="aprobado" data-v-83ea9ee0>Aprobado</option><option value="aprobada" data-v-83ea9ee0>Aprobada</option><option value="vendido" data-v-83ea9ee0>Vendido</option><option value="cancelado" data-v-83ea9ee0>Cancelado</option><option value="cancelada" data-v-83ea9ee0>Cancelada</option>',8)]),544),[[de,P.value]]),i[16]||(i[16]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("svg",{class:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))]),e("button",{onClick:U,class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},i[17]||(i[17]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),X(" Limpiar ")]))])])])]))}},lt=se(nt,[["__scopeId","data-v-83ea9ee0"]]),it={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},dt={class:"bg-gradient-to-r from-gray-50 to-gray-100/50 px-6 py-4 border-b border-gray-200/60"},ct={class:"flex items-center justify-between"},ut={class:"text-sm text-gray-600 bg-white/70 px-3 py-1 rounded-full border border-gray-200/50"},gt={class:"overflow-x-auto"},mt={class:"min-w-full divide-y divide-gray-200/60"},vt={class:"bg-gray-50/60"},pt={class:"flex items-center space-x-1"},ft={class:"flex items-center space-x-1"},bt={class:"flex items-center space-x-1"},xt={class:"flex items-center space-x-1"},ht={class:"flex items-center space-x-1"},yt={class:"bg-white divide-y divide-gray-200/40"},wt={class:"px-6 py-4"},kt={class:"flex flex-col space-y-0.5"},_t={class:"text-sm font-medium text-gray-900"},Ct={class:"text-xs text-gray-500"},$t={class:"px-6 py-4"},Et={class:"flex flex-col space-y-0.5"},jt={class:"text-sm font-medium text-gray-900 group-hover:text-gray-800"},Vt={key:0,class:"text-xs text-gray-500 truncate max-w-48"},Mt={class:"px-6 py-4"},Bt={class:"text-sm font-mono font-medium text-gray-700 bg-gray-100/60 px-2 py-1 rounded-md inline-block"},Pt={class:"px-6 py-4"},Dt={class:"text-sm font-semibold text-gray-900"},Nt={class:"px-6 py-4"},Ft={class:"px-6 py-4"},Lt={class:"flex items-center space-x-2"},It={key:0,class:"text-xs text-gray-500"},Tt={class:"px-6 py-4"},St={class:"flex items-center justify-end space-x-1"},At=["onClick"],zt=["onClick"],Ot=["onClick"],Ut=["onClick","title"],Ht=["onClick"],Wt=["onClick"],qt=["onClick"],Xt={key:1},Kt={__name:"VentasTable",props:{documentos:{type:Array,default:()=>[]},searchTerm:{type:String,default:""},sortBy:{type:String,default:"fecha-desc"}},emits:["ver-detalles","editar","eliminar","imprimir","sort","marcar-pagado","cancelar","enviar-email"],setup(p,{emit:M}){const c=p,f=M,B={borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},aprobado:{label:"Aprobado",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},aprobada:{label:"Aprobada",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},vendido:{label:"Vendido",classes:"bg-green-100 text-green-700",color:"bg-green-400"},cancelado:{label:"Cancelado",classes:"bg-red-100 text-red-700",color:"bg-red-400"},cancelada:{label:"Cancelada",classes:"bg-red-100 text-red-700",color:"bg-red-400"}},P=n=>n.estado==="cancelado"||n.estado==="cancelada"?n.estado:n.pagado?n.estado==="aprobada"||n.estado==="aprobado"||n.estado==="vendido"?n.estado:"aprobada":n.estado||"pendiente",z=n=>{var u;const r=P(n);return((u=B[r])==null?void 0:u.classes)||"bg-gray-100 text-gray-700"},k=n=>{var u;const r=P(n);return((u=B[r])==null?void 0:u.color)||"bg-gray-400"},U=n=>{var u;const r=P(n);return((u=B[r])==null?void 0:u.label)||"Pendiente"},h=new Map,b=n=>{if(!n)return"Fecha no disponible";const r=`fecha-${n}`;if(h.has(r))return h.get(r);try{const u=new Date(n).getTime();if(Number.isNaN(u))return"Fecha inválida";const a=new Date(u).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"});return h.set(r,a),a}catch{return"Fecha inválida"}},i=n=>{if(!n)return"";const r=`hora-${n}`;if(h.has(r))return h.get(r);try{const u=new Date(n).getTime();if(Number.isNaN(u))return"";const a=new Date(u).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"});return h.set(r,a),a}catch{return""}},H=n=>{const r=parseFloat(n),u=Number.isFinite(r)?r:0,a=`moneda-${u}`;if(h.has(a))return h.get(a);const x=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(u);return h.set(a,x),x},W=D(()=>{if(!Array.isArray(c.documentos))return[];let n=c.documentos.slice();if(c.searchTerm){const a=c.searchTerm.toLowerCase();n=n.filter(x=>{var $;const y=P(x);return((($=x.cliente)==null?void 0:$.nombre)||"").toLowerCase().includes(a)||(x.numero_venta||x.id||"").toString().toLowerCase().includes(a)||y.toLowerCase().includes(a)})}const[r,u]=c.sortBy.split("-");return n.sort((a,x)=>{var Y,Z;let y,$;switch(r){case"fecha":y=new Date(a.created_at||a.fecha||0).getTime(),$=new Date(x.created_at||x.fecha||0).getTime();break;case"cliente":y=(((Y=a.cliente)==null?void 0:Y.nombre)||"").toLowerCase(),$=(((Z=x.cliente)==null?void 0:Z.nombre)||"").toLowerCase();break;case"numero_venta":y=(a.numero_venta||a.id||"").toString().toLowerCase(),$=(x.numero_venta||x.id||"").toString().toLowerCase();break;case"total":y=parseFloat(a.total||0),$=parseFloat(x.total||0);break;case"estado":y=P(a).toLowerCase(),$=P(x).toLowerCase();break;default:y=(a[r]||"").toLowerCase(),$=(x[r]||"").toLowerCase()}const I=y<$?-1:y>$?1:0;return u==="desc"?-I:I})}),T=D(()=>{var n;return((n=c.documentos)==null?void 0:n.length)||0}),S=n=>f("ver-detalles",n),O=n=>f("editar",n),_=n=>f("eliminar",n),oe=n=>f("imprimir",n),C=n=>f("marcar-pagado",n),L=n=>f("cancelar",n),K=n=>f("enviar-email",n),q=n=>{const u=(c.sortBy.startsWith(n)?c.sortBy:`${n}-desc`)===`${n}-desc`?`${n}-asc`:`${n}-desc`;f("sort",u)};return(n,r)=>{const u=ke("font-awesome-icon");return m(),g("div",it,[e("div",dt,[e("div",ct,[r[5]||(r[5]=e("h2",{class:"text-lg font-semibold text-gray-900 tracking-tight"},"Ventas",-1)),e("div",ut,w(W.value.length)+" de "+w(T.value)+" ventas ",1)])]),e("div",gt,[e("table",mt,[e("thead",vt,[e("tr",null,[e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:r[0]||(r[0]=a=>q("fecha"))},[e("div",pt,[r[7]||(r[7]=e("span",null,"Fecha",-1)),p.sortBy.startsWith("fecha")?(m(),g("svg",{key:0,class:A(["w-4 h-4 transition-transform duration-200",p.sortBy==="fecha-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[6]||(r[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):j("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:r[1]||(r[1]=a=>q("cliente"))},[e("div",ft,[r[9]||(r[9]=e("span",null,"Cliente",-1)),p.sortBy.startsWith("cliente")?(m(),g("svg",{key:0,class:A(["w-4 h-4 transition-transform duration-200",p.sortBy==="cliente-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[8]||(r[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):j("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:r[2]||(r[2]=a=>q("numero_venta"))},[e("div",bt,[r[11]||(r[11]=e("span",null,"N° Venta",-1)),p.sortBy.startsWith("numero_venta")?(m(),g("svg",{key:0,class:A(["w-4 h-4 transition-transform duration-200",p.sortBy==="numero_venta-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[10]||(r[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):j("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:r[3]||(r[3]=a=>q("total"))},[e("div",xt,[r[13]||(r[13]=e("span",null,"Total",-1)),p.sortBy.startsWith("total")?(m(),g("svg",{key:0,class:A(["w-4 h-4 transition-transform duration-200",p.sortBy==="total-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[12]||(r[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):j("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:r[4]||(r[4]=a=>q("estado"))},[e("div",ht,[r[15]||(r[15]=e("span",null,"Estado",-1)),p.sortBy.startsWith("estado")?(m(),g("svg",{key:0,class:A(["w-4 h-4 transition-transform duration-200",p.sortBy==="estado-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},r[14]||(r[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):j("",!0)])]),r[16]||(r[16]=e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Pago ",-1)),r[17]||(r[17]=e("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ",-1))])]),e("tbody",yt,[W.value.length>0?(m(!0),g(ae,{key:0},_e(W.value,a=>{var x,y,$;return m(),g("tr",{key:a.id,class:A(["group hover:bg-gray-50/60 transition-all duration-150 hover:shadow-sm",a.estado==="cancelada"?"opacity-50":""])},[e("td",wt,[e("div",kt,[e("div",_t,w(b(a.created_at||a.fecha)),1),e("div",Ct,w(i(a.created_at||a.fecha)),1)])]),e("td",$t,[e("div",Et,[e("div",jt,w(((x=a.cliente)==null?void 0:x.nombre)||"Sin cliente"),1),(y=a.cliente)!=null&&y.email?(m(),g("div",Vt,w(a.cliente.email),1)):j("",!0)])]),e("td",Mt,[e("div",Bt,w(a.numero_venta||a.id||"N/A"),1)]),e("td",Pt,[e("div",Dt,[typeof a.total<"u"&&a.total!==null?(m(),g(ae,{key:0},[X(" $"+w(H(a.total)),1)],64)):(m(),g(ae,{key:1},[X("-")],64))])]),e("td",Nt,[e("span",{class:A([z(a),"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-150 hover:shadow-sm"])},[e("span",{class:A(["w-2 h-2 rounded-full mr-2 transition-all duration-150",k(a)])},null,2),X(" "+w(U(a)),1)],2)]),e("td",Ft,[e("div",Lt,[e("span",{class:A(["inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium",a.pagado?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"])},[e("span",{class:A(["w-1.5 h-1.5 rounded-full mr-1.5",a.pagado?"bg-green-400":"bg-gray-400"])},null,2),X(" "+w(a.pagado?"Pagado":"Pendiente"),1)],2),a.pagado&&a.metodo_pago?(m(),g("span",It," ("+w(a.metodo_pago)+") ",1)):j("",!0)])]),e("td",Tt,[e("div",St,[e("button",{onClick:I=>S(a),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Ver detalles"},[F(u,{icon:"eye",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,At),a.estado!=="cancelada"?(m(),g("button",{key:0,onClick:I=>O(a.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-1",title:"Editar"},[F(u,{icon:"edit",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,zt)):j("",!0),!a.pagado&&a.estado!=="cancelada"?(m(),g("button",{key:1,onClick:I=>C(a),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:"Marcar como Pagado"},[F(u,{icon:"dollar-sign",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Ot)):j("",!0),a.estado!=="cancelada"&&(($=a.cliente)!=null&&$.email)?(m(),g("button",{key:2,onClick:I=>K(a),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:a.email_enviado?"Reenviar por Email":"Enviar por Email"},[F(u,{icon:a.email_enviado?"envelope-open":"envelope",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"},null,8,["icon"])],8,Ut)):j("",!0),a.estado!=="cancelada"?(m(),g("button",{key:3,onClick:I=>oe(a),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-purple-50 text-purple-600 hover:bg-purple-100 hover:text-purple-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:ring-offset-1",title:"Imprimir"},[F(u,{icon:"print",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Ht)):j("",!0),a.estado!=="cancelada"?(m(),g("button",{key:4,onClick:I=>L(a.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-orange-50 text-orange-600 hover:bg-orange-100 hover:text-orange-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-1",title:"Cancelar Venta"},[F(u,{icon:"times-circle",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Wt)):j("",!0),a.estado!=="cancelada"&&!(a.pagado&&(a.estado==="aprobada"||a.estado==="aprobado"))?(m(),g("button",{key:5,onClick:I=>_(a.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50 focus:ring-offset-1",title:"Eliminar"},[F(u,{icon:"trash",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,qt)):j("",!0)])])],2)}),128)):(m(),g("tr",Xt,r[18]||(r[18]=[e("td",{colspan:7,class:"px-6 py-16 text-center"},[e("div",{class:"flex flex-col items-center space-y-4"},[e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("div",{class:"space-y-1"},[e("p",{class:"text-gray-700 font-medium"},"No hay ventas"),e("p",{class:"text-sm text-gray-500"},"Las ventas aparecerán aquí cuando se creen")])])],-1)])))])])])])}}},Rt=se(Kt,[["__scopeId","data-v-0d08f6b9"]]),Gt={class:"ventas-index min-h-screen bg-gray-50"},Yt={class:"max-w-8xl mx-auto px-6 py-8"},Zt={class:"mt-6"},Jt={class:"bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto"},Qt={class:"p-6"},eo={key:0,class:"space-y-4"},to={class:"bg-gray-50 p-4 rounded-lg"},oo={class:"flex justify-between items-center"},ao={class:"text-sm font-mono text-gray-900"},ro={class:"flex justify-between items-center mt-2"},so={class:"text-lg font-bold text-gray-900"},no={class:"flex justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50"},lo=["disabled"],io={key:0,class:"flex items-center"},co={key:1},uo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},go=Object.assign({layout:Me},{__name:"Index",props:{ventas:{type:Array,default:()=>[]},estadisticas:{type:Object,default:()=>({total:0,borrador:0,aprobadas:0,pendientes:0,cancelada:0})}},setup(p){const M=p,c=new je({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),f=V(!1),B=V(null),P=V("details"),z=V(null),k=V(!1),U=V(!1),h=V(null),b=V(""),i=V(""),H=t=>{B.value=t||null,P.value="details",f.value=!0},W=()=>{f.value=!1,B.value=null,z.value=null},T=V(""),S=V("fecha-desc"),O=V(""),_=V([...M.ventas]),oe=D(()=>{const t=B.value;if(!t)return null;const o=t.metadata||{};return{creado_por:t.creado_por_nombre||t.created_by_user_name||o.creado_por||"N/A",actualizado_por:t.actualizado_por_nombre||t.updated_by_user_name||o.actualizado_por||"N/A",eliminado_por:t.eliminado_por_nombre||t.deleted_by_user_name||o.eliminado_por||null,creado_en:t.created_at||o.creado_en||null,actualizado_en:t.updated_at||o.actualizado_en||null,eliminado_en:t.deleted_at||o.eliminado_en||null}});D(()=>[..._.value]);const C=V(1),L=V(10),K=D(()=>{let t=[..._.value];if(T.value.trim()){const o=T.value.toLowerCase().trim();t=t.filter(d=>{var v,N,R;const E=((N=(v=d.cliente)==null?void 0:v.nombre)==null?void 0:N.toLowerCase())||"",s=String(d.numero_venta||d.id||"").toLowerCase(),l=((R=d.estado)==null?void 0:R.toLowerCase())||"";return E.includes(o)||s.includes(o)||l.includes(o)})}if(O.value&&(t=t.filter(o=>o.estado===O.value)),S.value){const[o,d]=S.value.split("-"),E=d==="desc";t.sort((s,l)=>{var R,le;let v,N;switch(o){case"fecha":v=new Date(s.fecha||s.created_at||0),N=new Date(l.fecha||l.created_at||0);break;case"cliente":v=((R=s.cliente)==null?void 0:R.nombre)||"",N=((le=l.cliente)==null?void 0:le.nombre)||"";break;case"total":v=parseFloat(s.total||0),N=parseFloat(l.total||0);break;case"estado":v=s.estado||"",N=l.estado||"";break;default:v=s[o]||"",N=l[o]||""}return v<N?E?1:-1:v>N?E?-1:1:0})}return t}),q=D(()=>{const t=(C.value-1)*L.value,o=t+L.value;return K.value.slice(t,o)}),n=D(()=>Math.ceil(K.value.length/L.value)),r=D(()=>K.value.length),u=D(()=>({current_page:C.value,last_page:n.value,per_page:L.value,from:r.value>0?(C.value-1)*L.value+1:0,to:Math.min(C.value*L.value,r.value),total:r.value,prev_page_url:C.value>1?"#":null,next_page_url:C.value<n.value?"#":null,links:[]}));G([T,S,O,L],()=>{C.value=1},{deep:!0});const a=t=>{L.value=t,C.value=1},x=t=>{C.value=t};G(()=>M.ventas,t=>{Array.isArray(t)&&(_.value=[...t])},{deep:!0,immediate:!0}),G(()=>M.estadisticas,t=>{t&&typeof t=="object"&&console.log("Estadísticas del backend actualizadas:",t)},{deep:!0,immediate:!0}),G([T,O],()=>{C.value=1}),G(n,t=>{C.value>t&&t>0&&(C.value=t)});const y=D(()=>{if(M.estadisticas&&M.estadisticas.total>0)return{total:M.estadisticas.total||0,borrador:M.estadisticas.borrador||0,aprobados:M.estadisticas.aprobadas||0,pendientes:M.estadisticas.pendientes||0,cancelado:M.estadisticas.cancelada||0};const t={total:_.value.length,aprobados:0,pendientes:0,borrador:0,cancelado:0};return _.value.forEach(o=>{switch(String(o.estado||"").toLowerCase()){case"aprobado":case"aprobada":t.aprobados++;break;case"pendiente":t.pendientes++;break;case"borrador":t.borrador++;break;case"cancelado":case"cancelada":t.cancelado++;break}}),t}),$=()=>{T.value="",S.value="fecha-desc",O.value="",L.value=10,C.value=1,c.success("Filtros limpiados correctamente")},I=t=>{t&&typeof t=="string"&&(S.value=t,C.value=1)},Y=t=>{const o=parseFloat(t),d=Number.isFinite(o)?o:0;return new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(d)};function Z(t){if(!(t!=null&&t.id))throw new Error("ID de venta no válido");return!0}function ce(t){var o;if(!t.id)throw new Error("ID del documento no encontrado");if(!((o=t.cliente)!=null&&o.nombre))throw new Error("Datos del cliente no encontrados");if(!Array.isArray(t.productos)||!t.productos.length)throw new Error("Lista de productos no válida");if(!t.fecha)throw new Error("Fecha no especificada");return!0}const ue=t=>{try{Z(t),H(t)}catch(o){c.error(o.message)}},ne=t=>{var o;try{const d=t||((o=B.value)==null?void 0:o.id);if(!d)throw new Error("ID de venta no válido");Q.visit(`/ventas/${d}/edit`)}catch(d){c.error(d.message)}},ge=t=>{ne(t)},me=async t=>{try{const o={...t,fecha:t.fecha||t.created_at||new Date().toISOString()};ce(o),k.value=!0,c.success("Generando PDF..."),await Ve("Venta",o),c.success("PDF generado correctamente")}catch(o){console.error("Error al generar PDF:",o),c.error(`Error al generar el PDF: ${o.message}`)}finally{k.value=!1}},ve=t=>{try{if(!t)throw new Error("ID de venta no válido");z.value=t,P.value="confirm",f.value=!0}catch(o){c.error(o.message)}},pe=async()=>{var t,o,d,E;try{if(!z.value)throw new Error("No se seleccionó ninguna venta para cancelar");k.value=!0,c.success("Cancelando venta...");const{data:s}=await ee.post(`/ventas/${z.value}/cancel`);if(s!=null&&s.success){c.success(s.message||"Venta cancelada exitosamente");const l=_.value.findIndex(v=>v.id===z.value);l!==-1&&(_.value[l]={..._.value[l],estado:"cancelada",eliminado_por:(s==null?void 0:s.eliminado_por)||"Usuario actual",deleted_at:new Date().toISOString()}),W()}else throw new Error((s==null?void 0:s.error)||"Error al cancelar la venta")}catch(s){console.error("Error al cancelar:",s);let l="Error al cancelar la venta";(o=(t=s.response)==null?void 0:t.data)!=null&&o.error?l=s.response.data.error:(E=(d=s.response)==null?void 0:d.data)!=null&&E.message?l=s.response.data.message:s.message&&(l=s.message),c.error(l)}finally{k.value=!1}},fe=()=>{Q.visit("/ventas/create")},be=t=>{h.value=t,b.value="",i.value="",U.value=!0},J=()=>{U.value=!1,h.value=null,b.value="",i.value=""},xe=async()=>{var t,o,d,E;if(!b.value){c.error("Debe seleccionar un método de pago");return}try{k.value=!0,c.success("Procesando pago...");const{data:s}=await ee.post(`/ventas/${h.value.id}/marcar-pagado`,{metodo_pago:b.value,notas_pago:i.value});if(s!=null&&s.success){c.success(s.message||"Venta marcada como pagada exitosamente");const l=_.value.findIndex(v=>v.id===h.value.id);l!==-1&&(_.value[l]={..._.value[l],estado:"aprobada",pagado:!0,metodo_pago:b.value,fecha_pago:new Date().toISOString().split("T")[0],notas_pago:i.value}),J(),Q.visit("/ventas",{method:"get",replace:!0})}else throw new Error((s==null?void 0:s.error)||"Error al procesar el pago")}catch(s){console.error("Error al marcar como pagado:",s);let l="Error al procesar el pago";(o=(t=s.response)==null?void 0:t.data)!=null&&o.error?l=s.response.data.error:(E=(d=s.response)==null?void 0:d.data)!=null&&E.message?l=s.response.data.message:s.message&&(l=s.message),c.error(l)}finally{k.value=!1}},he=async t=>{var o,d,E,s;try{if(!confirm("¿Está seguro de que desea cancelar esta venta? Esta acción devolverá el pago y el inventario."))return;k.value=!0,c.success("Cancelando venta...");const{data:l}=await ee.post(`/ventas/${t}/cancel`);if(l!=null&&l.success)c.success(l.message||"Venta cancelada exitosamente"),Q.visit("/ventas",{method:"get",replace:!0});else throw new Error((l==null?void 0:l.error)||"Error al cancelar la venta")}catch(l){console.error("Error al cancelar venta:",l);let v="Error al cancelar la venta";(d=(o=l.response)==null?void 0:o.data)!=null&&d.error?v=l.response.data.error:(s=(E=l.response)==null?void 0:E.data)!=null&&s.message?v=l.response.data.message:l.message&&(v=l.message),c.error(v)}finally{k.value=!1}},ye=async t=>{var o;try{if(!((o=t.cliente)!=null&&o.email)){c.error("El cliente no tiene email configurado");return}console.log("=== ENVIANDO VENTA POR EMAIL ==="),console.log("Venta ID:",t.id),console.log("Cliente email:",t.cliente.email),B.value={...t,numero_venta:t.numero_venta||`V${String(t.id).padStart(3,"0")}`,email_destino:t.cliente.email},P.value="confirm-email",f.value=!0}catch(d){console.error("Error en enviarVentaPorEmail:",d),c.error("Error inesperado al preparar envío de venta")}},we=async()=>{var t,o,d,E;try{const s=B.value;if(!(s!=null&&s.email_destino)){c.error("Email de destino no válido");return}console.log("✅ Usuario confirmó envío de venta por email"),k.value=!0,W();const{data:l}=await ee.post(`/ventas/${s.id}/enviar-email`,{email_destino:s.email_destino});if(l!=null&&l.success){c.success(l.message||"Venta enviada por email correctamente");const v=_.value.findIndex(N=>N.id===s.id);v!==-1&&l.venta&&(_.value[v]={..._.value[v],email_enviado:l.venta.email_enviado,email_enviado_fecha:l.venta.email_enviado_fecha,estado:l.venta.estado})}else throw new Error((l==null?void 0:l.error)||"Error desconocido al enviar email")}catch(s){console.error("Error al enviar venta:",s);const l=((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.error)||((E=(d=s.response)==null?void 0:d.data)==null?void 0:E.message)||s.message;c.error("Error al enviar venta: "+l)}finally{k.value=!1}};return(t,o)=>(m(),g("div",null,[F(Ce($e),{title:"Ventas"}),e("div",Gt,[e("div",Yt,[F(lt,{total:y.value.total,borrador:y.value.borrador,aprobadas:y.value.aprobados,pendientes:y.value.pendientes,cancelada:y.value.cancelado,"search-term":T.value,"onUpdate:searchTerm":o[0]||(o[0]=d=>T.value=d),"sort-by":S.value,"onUpdate:sortBy":o[1]||(o[1]=d=>S.value=d),"filtro-estado":O.value,"onUpdate:filtroEstado":o[2]||(o[2]=d=>O.value=d),config:{module:"ventas",createButtonText:"Nueva Venta",searchPlaceholder:"Buscar por cliente, número..."},onLimpiarFiltros:$,onCrearNuevo:fe},null,8,["total","borrador","aprobadas","pendientes","cancelada","search-term","sort-by","filtro-estado"]),e("div",Zt,[F(Rt,{documentos:q.value,"search-term":T.value,"sort-by":S.value,onVerDetalles:ue,onEditar:ne,onEliminar:ve,onMarcarPagado:be,onCancelar:he,onEnviarEmail:ye,onImprimir:me,onSort:I},null,8,["documentos","search-term","sort-by"]),F(Pe,{"pagination-data":u.value,onPerPageChange:a,onPageChange:x},null,8,["pagination-data"])])]),F(Be,{show:f.value,mode:P.value,tipo:"ventas",selected:B.value||{},auditoria:oe.value,onClose:W,onConfirmDelete:pe,onConfirmEmail:we,onEditar:ge},null,8,["show","mode","selected","auditoria"]),U.value?(m(),g("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Ee(J,["self"])},[e("div",Jt,[e("div",{class:"flex items-center justify-between p-6 border-b border-gray-200"},[o[6]||(o[6]=e("h3",{class:"text-lg font-medium text-gray-900"},"Marcar como Pagado",-1)),e("button",{onClick:J,class:"text-gray-400 hover:text-gray-600 transition-colors"},o[5]||(o[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Qt,[h.value?(m(),g("div",eo,[e("div",to,[e("div",oo,[o[7]||(o[7]=e("span",{class:"text-sm font-medium text-gray-700"},"Venta:",-1)),e("span",ao,w(h.value.numero_venta),1)]),e("div",ro,[o[8]||(o[8]=e("span",{class:"text-sm font-medium text-gray-700"},"Total:",-1)),e("span",so,"$"+w(Y(h.value.total)),1)])]),e("div",null,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Método de Pago *",-1)),te(e("select",{"onUpdate:modelValue":o[3]||(o[3]=d=>b.value=d),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},o[9]||(o[9]=[re('<option value="" data-v-038e52c7>Seleccionar método...</option><option value="efectivo" data-v-038e52c7>Efectivo</option><option value="transferencia" data-v-038e52c7>Transferencia</option><option value="cheque" data-v-038e52c7>Cheque</option><option value="tarjeta" data-v-038e52c7>Tarjeta</option><option value="otros" data-v-038e52c7>Otros</option>',6)]),512),[[de,b.value]])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Notas (opcional)",-1)),te(e("textarea",{"onUpdate:modelValue":o[4]||(o[4]=d=>i.value=d),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Agregar notas sobre el pago..."},null,512),[[ie,i.value]])])])):j("",!0)]),e("div",no,[e("button",{onClick:J,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"}," Cancelar "),e("button",{onClick:xe,disabled:!b.value||k.value,class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[k.value?(m(),g("span",io,o[12]||(o[12]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),X(" Procesando... ")]))):(m(),g("span",co,"Confirmar Pago"))],8,lo)])])])):j("",!0),k.value?(m(),g("div",uo,o[13]||(o[13]=[e("div",{class:"bg-white p-6 rounded-lg shadow-lg"},[e("div",{class:"flex items-center space-x-3"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e("span",{class:"text-gray-700"},"Procesando...")])],-1)]))):j("",!0)])]))}}),ko=se(go,[["__scopeId","data-v-038e52c7"]]);export{ko as default};
