import{Q as A,p as U,r as P,c as C,w as q,i as d,o as i,g as _,f as e,u as y,Z as B,e as M,l as b,A as j,q as I,k as g,t as n,n as v,F as w,m as $,v as c,x as S,z as h,N as L}from"./vendor-d19pJyVS.js";import{A as O}from"./AppLayout-CcnrZQKI.js";import{N as X}from"./app-BcT2PLJy.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const Q={class:"pagos-create min-h-screen bg-gray-50"},Z={class:"max-w-4xl mx-auto px-6 py-8"},G={class:"mb-8"},J={class:"flex items-center justify-between"},K={class:"flex items-center space-x-3"},W={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Y={class:"lg:col-span-2"},ee={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},oe={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},te={class:"grid grid-cols-2 gap-4 text-sm"},se={class:"font-semibold text-blue-900 ml-2"},ae={class:"font-semibold text-blue-900 ml-2"},ne={class:"font-semibold text-blue-900 ml-2"},le={key:0,class:"bg-green-50 border border-green-200 rounded-lg p-4"},re={key:0,class:"grid grid-cols-2 gap-4 text-sm"},de={class:"font-semibold text-green-900 ml-2"},ie={class:"font-semibold text-green-900 ml-2"},ue={class:"font-semibold text-green-900 ml-2"},ge={class:"font-semibold text-green-900 ml-2"},me={class:"font-semibold text-orange-600 ml-2"},pe=["value"],ce={key:0,class:"mt-1 text-sm text-red-600"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be={for:"monto_pagado",class:"block text-sm font-medium text-gray-700 mb-2"},ve={key:0,class:"text-xs text-blue-600 font-normal"},xe={class:"relative"},_e=["max","placeholder"],ye={key:0,class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},we={key:0,class:"mt-1 text-sm text-red-600"},he={key:1,class:"mt-1 text-xs text-green-600"},ke={key:0,class:"mt-1 text-sm text-red-600"},Pe=["value"],Me={class:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200"},je=["disabled"],$e={key:0,class:"flex items-center"},Fe={key:1},Ne={class:"lg:col-span-1"},Ce={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden sticky top-8"},Se={class:"p-6"},Ve={class:"space-y-4"},Ee={class:"bg-gray-50 rounded-lg p-4"},De={class:"space-y-2 text-sm text-gray-600"},Re={class:"flex justify-between"},Te={class:"font-semibold"},ze={class:"flex justify-between"},Ae={class:"font-semibold"},Ue={class:"flex justify-between"},qe={class:"font-semibold"},Be={class:"flex justify-between"},Ie={class:"font-semibold"},Le={class:"bg-gray-50 rounded-lg p-4"},Oe={class:"space-y-2 text-sm text-gray-600"},Xe={class:"flex justify-between"},He={class:"font-semibold"},Qe={class:"flex justify-between"},Ze={class:"font-semibold text-green-600"},Ge={class:"flex justify-between"},Je={class:"font-semibold text-orange-600"},Ke={key:0,class:"bg-blue-50 rounded-lg p-4"},We={class:"space-y-2 text-sm text-blue-800"},Ye={class:"flex justify-between"},eo={class:"font-semibold"},oo={class:"flex justify-between"},to={class:"font-semibold"},so=Object.assign({layout:O},{__name:"Create",props:{prestamo:{type:Object,required:!0},pagos_pendientes:{type:Array,default:()=>[]}},setup(l){const f=l,p=new X({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),V=A();U(()=>{const s=V.props.flash;s!=null&&s.success&&p.success(s.success),s!=null&&s.error&&p.error(s.error)});const a=P({prestamo_id:f.prestamo.id,pago_id:null,monto_pagado:0,fecha_pago:new Date().toISOString().split("T")[0],metodo_pago:"efectivo",referencia:"",notas:""}),x=P(!1),r=P({}),E=()=>{if(r.value={},a.value.pago_id||(r.value.pago_id="Debe seleccionar un pago"),(!a.value.monto_pagado||a.value.monto_pagado<=0)&&(r.value.monto_pagado="El monto debe ser mayor a cero"),a.value.pago_id&&a.value.monto_pagado){const s=f.pagos_pendientes.find(o=>o.id==a.value.pago_id);if(s){const o=s.monto_programado-s.monto_pagado;a.value.monto_pagado>o&&(r.value.monto_pagado=`El monto no puede exceder el pendiente: $${u(o)}`)}}return a.value.fecha_pago||(r.value.fecha_pago="La fecha de pago es requerida"),Object.keys(r.value).length===0},D=()=>{if(!E()){p.error("Por favor corrija los errores del formulario");return}x.value=!0,L.post("/pagos",a.value,{onStart:()=>{p.success("Registrando pago...")},onSuccess:()=>{p.success("Pago registrado correctamente")},onError:s=>{console.error("Errores de validación:",s),p.error("Error al registrar el pago")},onFinish:()=>{x.value=!1}})},u=s=>{const o=parseFloat(s),m=Number.isFinite(o)?o:0;return new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(m)},k=s=>{if(!s)return"Fecha no disponible";try{const o=new Date(s).getTime();return Number.isNaN(o)?"Fecha inválida":new Date(o).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"Fecha inválida"}},R=C(()=>{if(!a.value.pago_id)return null;const s=f.pagos_pendientes.find(o=>o.id==a.value.pago_id);return s?s.monto_programado-s.monto_pagado:null}),T=C(()=>{if(!a.value.pago_id)return"0.00";const s=f.pagos_pendientes.find(o=>o.id==a.value.pago_id);if(s){const o=s.monto_programado-s.monto_pagado;return`Máximo: ${u(o)}`}return"0.00"}),z=[{value:"efectivo",label:"Efectivo"},{value:"transferencia",label:"Transferencia Bancaria"},{value:"tarjeta_debito",label:"Tarjeta de Débito"},{value:"tarjeta_credito",label:"Tarjeta de Crédito"},{value:"cheque",label:"Cheque"},{value:"otro",label:"Otro"}],F=s=>({pendiente:"Pendiente",pagado:"Pagado",atrasado:"Atrasado",parcial:"Pago Parcial"})[s]||s,N=s=>({pendiente:"bg-yellow-100 text-yellow-800",pagado:"bg-green-100 text-green-800",atrasado:"bg-red-100 text-red-800",parcial:"bg-orange-100 text-orange-800"})[s]||"bg-gray-100 text-gray-800";return q(()=>a.value.pago_id,(s,o)=>{if(console.log("Cambio en pago_id:",o,"->",s),s){const m=f.pagos_pendientes.find(t=>t.id==s);if(m){const t=m.monto_programado-m.monto_pagado;a.value.monto_pagado=t,console.log("Monto autocompletado:",t),p.success(`Monto autocompletado: $${u(t)}`)}}else a.value.monto_pagado=0;r.value.monto_pagado&&delete r.value.monto_pagado},{immediate:!1}),(s,o)=>{var m;return i(),d(w,null,[_(y(B),{title:"Registrar Pago de Préstamo"}),e("div",Q,[e("div",Z,[e("div",G,[e("div",J,[o[8]||(o[8]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Registrar Pago de Préstamo"),e("p",{class:"text-gray-600 mt-2"},"Registra el pago recibido de un préstamo")],-1)),e("div",K,[_(y(j),{href:`/prestamos/${l.prestamo.id}`,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},{default:M(()=>o[6]||(o[6]=[b(" 👁 Ver Préstamo ")])),_:1},8,["href"]),_(y(j),{href:"/pagos",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},{default:M(()=>o[7]||(o[7]=[b(" ← Volver a Pagos ")])),_:1})])])]),e("div",W,[e("div",Y,[e("div",ee,[o[32]||(o[32]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Información del Pago")],-1)),e("form",{onSubmit:I(D,["prevent"]),class:"p-6 space-y-6"},[e("div",oe,[o[13]||(o[13]=e("h3",{class:"text-sm font-medium text-blue-900 mb-2"},"Información del Préstamo",-1)),e("div",te,[e("div",null,[o[9]||(o[9]=e("span",{class:"text-blue-700"},"Cliente:",-1)),e("span",se,n((m=l.prestamo.cliente)==null?void 0:m.nombre_razon_social),1)]),e("div",null,[o[10]||(o[10]=e("span",{class:"text-blue-700"},"Monto del préstamo:",-1)),e("span",ae,"$"+n(u(l.prestamo.monto_prestado)),1)]),e("div",null,[o[11]||(o[11]=e("span",{class:"text-blue-700"},"Estado del préstamo:",-1)),e("span",{class:v(["font-semibold ml-2",N(l.prestamo.estado)])},n(F(l.prestamo.estado)),3)]),e("div",null,[o[12]||(o[12]=e("span",{class:"text-blue-700"},"Progreso:",-1)),e("span",ne,n(l.prestamo.pagos_realizados)+" / "+n(l.prestamo.numero_pagos)+" pagos",1)])])]),a.value.pago_id?(i(),d("div",le,[o[20]||(o[20]=e("h3",{class:"text-sm font-medium text-green-900 mb-2"},"Información del Pago Seleccionado",-1)),(i(!0),d(w,null,$(l.pagos_pendientes,t=>(i(),d("div",{key:t.id},[t.id==a.value.pago_id?(i(),d("div",re,[e("div",null,[o[14]||(o[14]=e("span",{class:"text-green-700"},"Número de pago:",-1)),e("span",de,"#"+n(t.numero_pago),1)]),e("div",null,[o[15]||(o[15]=e("span",{class:"text-green-700"},"Fecha programada:",-1)),e("span",ie,n(k(t.fecha_programada)),1)]),e("div",null,[o[16]||(o[16]=e("span",{class:"text-green-700"},"Monto programado:",-1)),e("span",ue,"$"+n(u(t.monto_programado)),1)]),e("div",null,[o[17]||(o[17]=e("span",{class:"text-green-700"},"Monto pagado actual:",-1)),e("span",ge,"$"+n(u(t.monto_pagado)),1)]),e("div",null,[o[18]||(o[18]=e("span",{class:"text-green-700"},"Estado actual:",-1)),e("span",{class:v(["font-semibold ml-2",N(t.estado)])},n(F(t.estado)),3)]),e("div",null,[o[19]||(o[19]=e("span",{class:"text-green-700"},"Monto pendiente:",-1)),e("span",me,"$"+n(u(t.monto_programado-t.monto_pagado)),1)])])):g("",!0)]))),128))])):g("",!0),e("div",null,[o[22]||(o[22]=e("label",{for:"pago_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Seleccionar Pago a Registrar * ",-1)),c(e("select",{id:"pago_id","onUpdate:modelValue":o[0]||(o[0]=t=>a.value.pago_id=t),class:v(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":r.value.pago_id}])},[o[21]||(o[21]=e("option",{value:""},"Seleccionar pago...",-1)),(i(!0),d(w,null,$(l.pagos_pendientes,t=>(i(),d("option",{key:t.id,value:t.id}," Pago #"+n(t.numero_pago)+" - $"+n(u(t.monto_programado))+" ("+n(k(t.fecha_programada))+") ",9,pe))),128))],2),[[S,a.value.pago_id]]),r.value.pago_id?(i(),d("p",ce,n(r.value.pago_id),1)):g("",!0)]),e("div",fe,[e("div",null,[e("label",be,[o[23]||(o[23]=b(" Monto Pagado * ")),a.value.pago_id?(i(),d("span",ve,"(Autocompletado automáticamente)")):g("",!0)]),e("div",xe,[o[25]||(o[25]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),c(e("input",{id:"monto_pagado","onUpdate:modelValue":o[1]||(o[1]=t=>a.value.monto_pagado=t),type:"number",step:"0.01",min:"0",max:R.value,placeholder:T.value,class:v(["block w-full pl-8 pr-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",[a.value.pago_id?"border-green-300 bg-green-50":"border-gray-300",r.value.monto_pagado&&"border-red-300"]])},null,10,_e),[[h,a.value.monto_pagado,void 0,{number:!0}]]),a.value.pago_id?(i(),d("div",ye,o[24]||(o[24]=[e("span",{class:"text-green-600 text-xs"},"✓",-1)]))):g("",!0)]),r.value.monto_pagado?(i(),d("p",we,n(r.value.monto_pagado),1)):g("",!0),a.value.pago_id&&!r.value.monto_pagado?(i(),d("p",he," ✓ Monto autocompletado con el pago pendiente ")):g("",!0)]),e("div",null,[o[26]||(o[26]=e("label",{for:"fecha_pago",class:"block text-sm font-medium text-gray-700 mb-2"}," Fecha de Pago * ",-1)),c(e("input",{id:"fecha_pago","onUpdate:modelValue":o[2]||(o[2]=t=>a.value.fecha_pago=t),type:"date",class:v(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":r.value.fecha_pago}])},null,2),[[h,a.value.fecha_pago]]),r.value.fecha_pago?(i(),d("p",ke,n(r.value.fecha_pago),1)):g("",!0)]),e("div",null,[o[27]||(o[27]=e("label",{for:"metodo_pago",class:"block text-sm font-medium text-gray-700 mb-2"}," Método de Pago ",-1)),c(e("select",{id:"metodo_pago","onUpdate:modelValue":o[3]||(o[3]=t=>a.value.metodo_pago=t),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[(i(),d(w,null,$(z,t=>e("option",{key:t.value,value:t.value},n(t.label),9,Pe)),64))],512),[[S,a.value.metodo_pago]])]),e("div",null,[o[28]||(o[28]=e("label",{for:"referencia",class:"block text-sm font-medium text-gray-700 mb-2"}," Referencia ",-1)),c(e("input",{id:"referencia","onUpdate:modelValue":o[4]||(o[4]=t=>a.value.referencia=t),type:"text",placeholder:"Número de referencia, folio, etc.",class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,a.value.referencia]])])]),e("div",null,[o[29]||(o[29]=e("label",{for:"notas",class:"block text-sm font-medium text-gray-700 mb-2"}," Notas Adicionales ",-1)),c(e("textarea",{id:"notas","onUpdate:modelValue":o[5]||(o[5]=t=>a.value.notas=t),rows:"3",placeholder:"Notas adicionales sobre el pago (opcional)",class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},null,512),[[h,a.value.notas]])]),e("div",Me,[_(y(j),{href:"/pagos",class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},{default:M(()=>o[30]||(o[30]=[b(" ❌ Cancelar ")])),_:1}),e("button",{type:"submit",disabled:x.value,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[x.value?(i(),d("span",$e,o[31]||(o[31]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),b(" Registrando... ")]))):(i(),d("span",Fe,"💳 Registrar Pago"))],8,je)])],32)])]),e("div",Ne,[e("div",Ce,[o[44]||(o[44]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"Información del Préstamo")],-1)),e("div",Se,[e("div",Ve,[e("div",Ee,[o[37]||(o[37]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Resumen del Préstamo",-1)),e("div",De,[e("div",Re,[o[33]||(o[33]=e("span",null,"Capital:",-1)),e("span",Te,"$"+n(u(l.prestamo.monto_prestado)),1)]),e("div",ze,[o[34]||(o[34]=e("span",null,"Tasa mensual:",-1)),e("span",Ae,n(l.prestamo.tasa_interes_mensual)+"%",1)]),e("div",Ue,[o[35]||(o[35]=e("span",null,"Pago mensual:",-1)),e("span",qe,"$"+n(u(l.prestamo.pago_periodico)),1)]),e("div",Be,[o[36]||(o[36]=e("span",null,"Total a pagar:",-1)),e("span",Ie,"$"+n(u(l.prestamo.monto_total_pagar)),1)])])]),e("div",Le,[o[41]||(o[41]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Progreso del Préstamo",-1)),e("div",Oe,[e("div",Xe,[o[38]||(o[38]=e("span",null,"Pagos realizados:",-1)),e("span",He,n(l.prestamo.pagos_realizados)+" / "+n(l.prestamo.numero_pagos),1)]),e("div",Qe,[o[39]||(o[39]=e("span",null,"Monto pagado:",-1)),e("span",Ze,"$"+n(u(l.prestamo.monto_pagado)),1)]),e("div",Ge,[o[40]||(o[40]=e("span",null,"Monto pendiente:",-1)),e("span",Je,"$"+n(u(l.prestamo.monto_pendiente)),1)])])]),l.pagos_pendientes.length>0?(i(),d("div",Ke,[o[43]||(o[43]=e("h4",{class:"text-sm font-medium text-blue-900 mb-3"},"Próximo Pago Pendiente",-1)),e("div",We,[e("div",Ye,[e("span",null,"Pago #"+n(l.pagos_pendientes[0].numero_pago),1),e("span",eo,"$"+n(u(l.pagos_pendientes[0].monto_programado)),1)]),e("div",oo,[o[42]||(o[42]=e("span",null,"Fecha programada:",-1)),e("span",to,n(k(l.pagos_pendientes[0].fecha_programada)),1)])])])):g("",!0)])])])])])])])],64)}}}),uo=H(so,[["__scopeId","data-v-4b9c4d7b"]]);export{uo as default};
