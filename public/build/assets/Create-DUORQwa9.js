import{Q as I,p as L,r as m,c as _,i as r,o as l,g as U,f as e,u as q,Z as D,l as C,q as O,k as g,s as A,v as i,x as b,F as f,m as S,t as n,y as V,z,n as M,N as x}from"./vendor-d19pJyVS.js";import{A as F}from"./AppLayout-CcnrZQKI.js";import{N as R}from"./app-BcT2PLJy.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const T={class:"min-h-screen bg-gray-50"},G={class:"max-w-4xl mx-auto px-6 py-8"},Q={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-8"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},J=["value"],K=["value"],W={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},X={class:"flex items-center justify-between"},Y={key:0,class:"flex items-center mt-1"},$={key:1,class:"text-lg font-bold text-blue-900 mt-1"},ee={class:"space-y-3"},te={class:"flex items-center"},oe={class:"flex items-center"},ae={key:1,class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},se={class:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"},re={class:"ml-2 font-medium"},le={key:0,class:"mt-3 p-3 bg-red-50 border border-red-200 rounded-md"},ne={class:"flex"},de={class:"ml-3"},ie={class:"mt-2 text-sm text-red-700"},ue={class:"flex justify-end gap-4 pt-6 border-t border-gray-200"},ce=["disabled"],ve=["disabled"],me={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},pe={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ge=Object.assign({layout:F},{__name:"Create",props:{productos:{type:Array,default:()=>[]},almacenes:{type:Array,default:()=>[]}},setup(y){const c=new R({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),h=I();L(()=>{const s=h.props.flash;s!=null&&s.success&&c.success(s.success),s!=null&&s.error&&c.error(s.error)});const o=m({producto_id:"",almacen_id:"",tipo:"incremento",cantidad_ajuste:"",motivo:"",observaciones:""}),u=m(!1),d=m(0),p=m(!1),v=_(()=>{const s=parseInt(d.value)||0,t=parseInt(o.value.cantidad_ajuste)||0;return o.value.tipo==="incremento"?s+t:Math.max(0,s-t)}),k=_(()=>o.value.producto_id&&o.value.almacen_id&&o.value.cantidad_ajuste>0&&o.value.motivo.trim()&&(o.value.tipo!=="decremento"||v.value>=0)),w=async()=>{if(!o.value.producto_id||!o.value.almacen_id){d.value=0;return}p.value=!0;try{const s=await fetch(route("productos.stock-detalle",o.value.producto_id));if(s.ok){const a=(await s.json()).stock_por_almacen.find(B=>B.almacen_id==o.value.almacen_id);d.value=a?a.cantidad:0}else d.value=0}catch(s){console.error("Error cargando stock:",s),d.value=0}finally{p.value=!1}},E=()=>{k.value&&(u.value=!0,x.post(route("ajustes-inventario.store"),o.value,{onSuccess:()=>{c.success("Ajuste de inventario realizado correctamente"),x.visit(route("ajustes-inventario.index"))},onError:s=>{console.error("Errores de validación:",s),c.error("Error al realizar el ajuste de inventario")},onFinish:()=>{u.value=!1}}))},j=()=>{x.visit(route("ajustes-inventario.index"))},N=()=>{o.value.producto_id&&o.value.almacen_id&&w()},P=()=>{o.value.producto_id&&o.value.almacen_id&&w()};return(s,t)=>(l(),r(f,null,[U(q(D),{title:"Crear Ajuste de Inventario"}),e("div",T,[e("div",G,[e("div",{class:"mb-8"},[e("div",{class:"flex items-center justify-between"},[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Crear Ajuste de Inventario"),e("p",{class:"text-gray-600 mt-1"},"Realiza ajustes manuales al stock de productos")],-1)),e("button",{onClick:j,class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"},t[7]||(t[7]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),C(" Cancelar ")]))])]),e("div",Q,[e("form",{onSubmit:O(E,["prevent"]),class:"space-y-6"},[e("div",Z,[e("div",null,[t[10]||(t[10]=e("label",{for:"producto_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Producto * ",-1)),i(e("select",{id:"producto_id","onUpdate:modelValue":t[0]||(t[0]=a=>o.value.producto_id=a),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",onChange:N},[t[9]||(t[9]=e("option",{value:""},"Seleccionar producto",-1)),(l(!0),r(f,null,S(y.productos,a=>(l(),r("option",{key:a.id,value:a.id},n(a.nombre)+" ("+n(a.codigo)+") ",9,J))),128))],544),[[b,o.value.producto_id]])]),e("div",null,[t[12]||(t[12]=e("label",{for:"almacen_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Almacén * ",-1)),i(e("select",{id:"almacen_id","onUpdate:modelValue":t[1]||(t[1]=a=>o.value.almacen_id=a),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",onChange:P},[t[11]||(t[11]=e("option",{value:""},"Seleccionar almacén",-1)),(l(!0),r(f,null,S(y.almacenes,a=>(l(),r("option",{key:a.id,value:a.id},n(a.nombre),9,K))),128))],544),[[b,o.value.almacen_id]])])]),o.value.producto_id&&o.value.almacen_id?(l(),r("div",W,[e("div",X,[e("div",null,[t[14]||(t[14]=e("h3",{class:"text-sm font-medium text-blue-800"},"Stock Actual",-1)),p.value?(l(),r("div",Y,t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"},null,-1),e("span",{class:"ml-2 text-sm text-blue-600"},"Cargando...",-1)]))):(l(),r("p",$,n(d.value)+" unidades",1))])])])):g("",!0),e("div",null,[t[17]||(t[17]=e("label",{for:"tipo",class:"block text-sm font-medium text-gray-700 mb-2"}," Tipo de Ajuste * ",-1)),e("div",ee,[e("div",te,[i(e("input",{id:"incremento","onUpdate:modelValue":t[2]||(t[2]=a=>o.value.tipo=a),type:"radio",value:"incremento",class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300"},null,512),[[V,o.value.tipo]]),t[15]||(t[15]=e("label",{for:"incremento",class:"ml-3 block text-sm font-medium text-gray-700"},[e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"}," Incremento "),e("span",{class:"ml-2"},"Aumentar el stock disponible")],-1))]),e("div",oe,[i(e("input",{id:"decremento","onUpdate:modelValue":t[3]||(t[3]=a=>o.value.tipo=a),type:"radio",value:"decremento",class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"},null,512),[[V,o.value.tipo]]),t[16]||(t[16]=e("label",{for:"decremento",class:"ml-3 block text-sm font-medium text-gray-700"},[e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"}," Decremento "),e("span",{class:"ml-2"},"Reducir el stock disponible")],-1))])])]),e("div",null,[t[18]||(t[18]=e("label",{for:"cantidad_ajuste",class:"block text-sm font-medium text-gray-700 mb-2"}," Cantidad a Ajustar * ",-1)),i(e("input",{id:"cantidad_ajuste","onUpdate:modelValue":t[4]||(t[4]=a=>o.value.cantidad_ajuste=a),type:"number",min:"1",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Ingresa la cantidad"},null,512),[[z,o.value.cantidad_ajuste,void 0,{number:!0}]])]),o.value.producto_id&&o.value.almacen_id&&o.value.cantidad_ajuste?(l(),r("div",ae,[t[24]||(t[24]=e("h3",{class:"text-sm font-medium text-gray-800 mb-3"},"Vista Previa del Ajuste",-1)),e("div",se,[e("div",null,[t[19]||(t[19]=e("span",{class:"text-gray-600"},"Stock Actual:",-1)),e("span",re,n(d.value),1)]),e("div",null,[t[20]||(t[20]=e("span",{class:"text-gray-600"},"Ajuste:",-1)),e("span",{class:M([o.value.tipo==="incremento"?"text-green-600":"text-red-600","ml-2 font-medium"])},n(o.value.tipo==="incremento"?"+":"-")+n(o.value.cantidad_ajuste),3)]),e("div",null,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Stock Final:",-1)),e("span",{class:M([v.value<0?"text-red-600":"text-blue-600","ml-2 font-bold"])},n(v.value),3)])]),o.value.tipo==="decremento"&&v.value<0?(l(),r("div",le,[e("div",ne,[t[23]||(t[23]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",de,[t[22]||(t[22]=e("h3",{class:"text-sm font-medium text-red-800"}," Stock insuficiente ",-1)),e("div",ie,[e("p",null,"Este ajuste resultaría en stock negativo. El stock actual es de "+n(d.value)+" unidades.",1)])])])])):g("",!0)])):g("",!0),e("div",null,[t[26]||(t[26]=e("label",{for:"motivo",class:"block text-sm font-medium text-gray-700 mb-2"}," Motivo del Ajuste * ",-1)),i(e("select",{id:"motivo","onUpdate:modelValue":t[5]||(t[5]=a=>o.value.motivo=a),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"},t[25]||(t[25]=[A('<option value="" data-v-e715423d>Seleccionar motivo</option><option value="Conteo físico" data-v-e715423d>Conteo físico</option><option value="Producto dañado" data-v-e715423d>Producto dañado</option><option value="Producto perdido" data-v-e715423d>Producto perdido</option><option value="Producto encontrado" data-v-e715423d>Producto encontrado</option><option value="Error de captura" data-v-e715423d>Error de captura</option><option value="Devolución" data-v-e715423d>Devolución</option><option value="Corrección de inventario" data-v-e715423d>Corrección de inventario</option><option value="Otro" data-v-e715423d>Otro</option>',9)]),512),[[b,o.value.motivo]])]),e("div",null,[t[27]||(t[27]=e("label",{for:"observaciones",class:"block text-sm font-medium text-gray-700 mb-2"}," Observaciones ",-1)),i(e("textarea",{id:"observaciones","onUpdate:modelValue":t[6]||(t[6]=a=>o.value.observaciones=a),rows:"3",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Observaciones adicionales (opcional)"},null,512),[[z,o.value.observaciones]])]),t[30]||(t[30]=A('<div class="bg-orange-50 border border-orange-200 rounded-lg p-4" data-v-e715423d><div class="flex" data-v-e715423d><div class="flex-shrink-0" data-v-e715423d><svg class="h-5 w-5 text-orange-400" fill="currentColor" viewBox="0 0 20 20" data-v-e715423d><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" data-v-e715423d></path></svg></div><div class="ml-3" data-v-e715423d><h3 class="text-sm font-medium text-orange-800" data-v-e715423d> Información importante </h3><div class="mt-2 text-sm text-orange-700" data-v-e715423d><ul class="list-disc pl-5 space-y-1" data-v-e715423d><li data-v-e715423d>Los ajustes afectan directamente el stock disponible</li><li data-v-e715423d>Se registra automáticamente en el historial de movimientos</li><li data-v-e715423d>El motivo es obligatorio para trazabilidad</li><li data-v-e715423d>Los decrementos no pueden resultar en stock negativo</li></ul></div></div></div></div>',1)),e("div",ue,[e("button",{type:"button",onClick:j,disabled:u.value,class:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 focus:ring-4 focus:ring-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,ce),e("button",{type:"submit",disabled:u.value||!k.value,class:"px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-700 text-white font-semibold rounded-lg hover:from-orange-700 hover:to-orange-800 focus:ring-4 focus:ring-orange-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[u.value?(l(),r("svg",me,t[28]||(t[28]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(l(),r("svg",pe,t[29]||(t[29]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"},null,-1)]))),C(" "+n(u.value?"Procesando...":"Realizar Ajuste"),1)],8,ve)])],32)])])])],64))}}),we=H(ge,[["__scopeId","data-v-e715423d"]]);export{we as default};
