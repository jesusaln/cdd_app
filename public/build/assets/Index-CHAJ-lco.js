import{B as _e,C as be,w as xe,i as l,o as n,f as e,l as q,t as g,v as fe,z as Ee,x as ke,s as Pe,c as k,r as L,R as Te,b as $e,k as b,J as Me,F as G,m as ye,M as Le,n as M,g as E,u as je,Z as De,N as ee}from"./vendor-d19pJyVS.js";import{N as Ne}from"./app-BcT2PLJy.js";import{g as Fe}from"./pdfGenerator-C15gTT3V.js";import{A as Be}from"./AppLayout-CcnrZQKI.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as Ie}from"./Modales-BBthfVFz.js";import"./utils-Dq7h7Pqt.js";import"./jspdf.es.min-BE3S9W4e.js";const Se={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},ze={class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-6 border-b border-gray-200/60"},Oe={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},Ve={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ae={class:"flex items-center justify-between"},He={class:"text-2xl font-bold text-gray-900"},We={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ge={class:"flex items-center justify-between"},Re={class:"text-2xl font-bold text-green-600"},Ue={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Xe={class:"flex items-center justify-between"},qe={class:"text-2xl font-bold text-red-600"},Ke={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ye={class:"flex items-center justify-between"},Ze={class:"text-2xl font-bold text-green-600"},Je={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Qe={class:"flex items-center justify-between"},et={class:"text-2xl font-bold text-purple-600"},tt={class:"px-6 py-4 bg-gray-50/50 border-b border-gray-200/60"},ot={class:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"},rt={class:"flex-1 max-w-md"},at={class:"relative"},st={class:"flex items-center space-x-3"},nt={__name:"ComprasHeader",props:_e({total:{type:Number,default:0},procesadas:{type:Number,default:0},canceladas:{type:Number,default:0},montoTotal:{type:Number,default:0},promedio:{type:Number,default:0}},{searchTerm:{type:String,default:""},searchTermModifiers:{},sortBy:{type:String,default:"created_at-desc"},sortByModifiers:{},filtroEstado:{type:String,default:""},filtroEstadoModifiers:{}}),emits:_e(["crear-nueva","search-change","filtro-estado-change","sort-change","limpiar-filtros"],["update:searchTerm","update:sortBy","update:filtroEstado"]),setup(c,{emit:f}){const d=f,x=be(c,"searchTerm"),y=be(c,"sortBy"),w=be(c,"filtroEstado"),P=U=>{const i=parseFloat(U),D=Number.isFinite(i)?i:0;return new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(D)},_=()=>d("crear-nueva"),j=()=>d("search-change",x.value),C=()=>d("filtro-estado-change",w.value),$=()=>d("sort-change",y.value),I=()=>d("limpiar-filtros");return xe([x,y,w],()=>{},{immediate:!0}),(U,i)=>(n(),l("div",Se,[e("div",ze,[e("div",{class:"flex items-center justify-between mb-6"},[i[4]||(i[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 tracking-tight"},"Compras"),e("p",{class:"text-sm text-gray-600 mt-1"},"Gestiona todas tus compras en un solo lugar")],-1)),e("button",{onClick:_,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"},i[3]||(i[3]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),q(" Nueva Compra ")]))]),e("div",Oe,[e("div",Ve,[e("div",Ae,[e("div",null,[i[5]||(i[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total",-1)),e("p",He,g(c.total),1)]),i[6]||(i[6]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))])]),e("div",We,[e("div",Ge,[e("div",null,[i[7]||(i[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Procesadas",-1)),e("p",Re,g(c.procesadas),1)]),i[8]||(i[8]=e("div",{class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Ue,[e("div",Xe,[e("div",null,[i[9]||(i[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Canceladas",-1)),e("p",qe,g(c.canceladas),1)]),i[10]||(i[10]=e("div",{class:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1))])]),e("div",Ke,[e("div",Ye,[e("div",null,[i[11]||(i[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Monto Total",-1)),e("p",Ze,"$"+g(P(c.montoTotal)),1)]),i[12]||(i[12]=e("div",{class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})])],-1))])]),e("div",Je,[e("div",Qe,[e("div",null,[i[13]||(i[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Promedio",-1)),e("p",et,"$"+g(P(c.promedio)),1)]),i[14]||(i[14]=e("div",{class:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1))])])])]),e("div",tt,[e("div",ot,[e("div",rt,[e("div",at,[i[15]||(i[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),fe(e("input",{"onUpdate:modelValue":i[0]||(i[0]=D=>x.value=D),type:"text",placeholder:"Buscar por proveedor, número de compra...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm",onInput:j},null,544),[[Ee,x.value]])])]),e("div",st,[fe(e("select",{"onUpdate:modelValue":i[1]||(i[1]=D=>w.value=D),onChange:C,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},i[16]||(i[16]=[e("option",{value:""},"Todos los Estados",-1),e("option",{value:"procesada"},"Procesadas",-1),e("option",{value:"cancelada"},"Canceladas",-1)]),544),[[ke,w.value]]),fe(e("select",{"onUpdate:modelValue":i[2]||(i[2]=D=>y.value=D),onChange:$,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},i[17]||(i[17]=[Pe('<option value="created_at-desc" data-v-8ad17256>Fecha (Más reciente)</option><option value="created_at-asc" data-v-8ad17256>Fecha (Más antiguo)</option><option value="total-desc" data-v-8ad17256>Monto (Mayor)</option><option value="total-asc" data-v-8ad17256>Monto (Menor)</option><option value="proveedor-asc" data-v-8ad17256>Proveedor (A-Z)</option><option value="proveedor-desc" data-v-8ad17256>Proveedor (Z-A)</option>',6)]),544),[[ke,y.value]]),e("button",{onClick:I,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},i[18]||(i[18]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),q(" Limpiar ")]))])])])]))}},lt=he(nt,[["__scopeId","data-v-8ad17256"]]),it={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},dt={class:"bg-gradient-to-r from-gray-50 to-gray-100/50 px-6 py-4 border-b border-gray-200/60"},ct={class:"flex items-center justify-between"},ut={class:"text-lg font-semibold text-gray-900 tracking-tight"},gt={class:"text-sm text-gray-600 bg-white/70 px-3 py-1 rounded-full border border-gray-200/50"},pt={class:"p-4 border-b border-gray-100"},mt={class:"flex items-center justify-between"},vt={class:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full font-medium"},bt={class:"max-h-72 overflow-y-auto px-4 pb-4 custom-scrollbar"},ft={key:0,class:"space-y-2 pt-2"},xt={class:"flex items-start justify-between"},yt={class:"flex-1 min-w-0 mr-3"},ht={class:"text-sm font-medium text-gray-900 truncate group-hover:text-gray-800"},wt={class:"flex items-center mt-1.5 space-x-2 text-xs"},_t={class:"text-gray-600 bg-white/60 px-2 py-0.5 rounded-md"},kt={class:"text-gray-600"},Ct={key:0,class:"text-xs text-gray-500 mt-1.5 line-clamp-2"},Et={class:"text-right flex-shrink-0"},Pt={class:"text-sm font-semibold text-gray-900"},Tt={key:1,class:"text-center py-8"},$t={class:"overflow-x-auto"},Mt={class:"min-w-full divide-y divide-gray-200/60"},Lt={class:"bg-gray-50/60"},jt={class:"flex items-center space-x-1"},Dt={class:"flex items-center space-x-1"},Nt={class:"flex items-center space-x-1"},Ft={class:"flex items-center space-x-1"},Bt={key:2,class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"},It={class:"flex items-center space-x-1"},St={class:"bg-white divide-y divide-gray-200/40"},zt={class:"px-6 py-4"},Ot={class:"flex flex-col space-y-0.5"},Vt={class:"text-sm font-medium text-gray-900"},At={class:"text-xs text-gray-500"},Ht={class:"px-6 py-4"},Wt={class:"flex flex-col space-y-0.5"},Gt={class:"text-sm font-medium text-gray-900 group-hover:text-gray-800"},Rt={key:0,class:"text-xs text-gray-500 truncate max-w-48"},Ut={key:0,class:"px-6 py-4"},Xt={class:"text-sm font-mono font-medium text-gray-700 bg-gray-100/60 px-2 py-1 rounded-md inline-block"},qt={key:1,class:"px-6 py-4"},Kt={class:"text-sm font-semibold text-gray-900"},Yt=["onMouseenter","onMousemove"],Zt={class:"font-medium"},Jt={class:"px-6 py-4"},Qt={key:0,class:"flex items-center"},eo={key:0,"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},to={key:1,"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"},oo={key:0,class:"ml-2 text-xs text-gray-500"},ro={class:"px-6 py-4"},ao={class:"flex items-center justify-end space-x-1"},so=["onClick"],no=["onClick"],lo=["onClick"],io=["onClick"],co=["onClick"],uo=["onClick"],go=["onClick"],po=["onClick"],mo=["onClick"],vo=["onClick"],bo={key:1},fo=["colspan"],xo={class:"flex flex-col items-center space-y-4"},yo={class:"space-y-1"},ho={class:"text-gray-700 font-medium"},wo={__name:"DocumentosTable",props:{documentos:{type:Array,default:()=>[]},tipo:{type:String,required:!0,validator:c=>["cotizaciones","pedidos","ventas","compras","ordenescompra"].includes(c)},searchTerm:{type:String,default:""},sortBy:{type:String,default:"fecha-desc"},filtroEstado:{type:String,default:""},mapeo:{type:Object,default:()=>({nombre:"nombre_razon_social",rfc:"rfc",activo:"activo",fecha:"created_at"})}},emits:["ver-detalles","editar","eliminar","duplicar","imprimir","sort","enviar-venta","enviar-pedido","marcar-pagado","enviar-compra","recibir-orden","cancelar-orden"],setup(c,{emit:f}){const d=c,x=f,y=k(()=>d.tipo==="compras"||d.tipo==="ordenescompra"),w=t=>t?t.productos||t.items||[]:[],P=L(!1),_=L(null),j=L({x:0,y:0});let C=null;const $=()=>typeof window>"u"?{w:1280,h:800}:{w:window.innerWidth,h:window.innerHeight},I=k(()=>{const{w:s,h:r}=$();let m=j.value.x+20,v=j.value.y-384/2;return m+320>s-16&&(m=j.value.x-320-20),m<16&&(m=16),v<16?v=16:v+384>r-16&&(v=r-384-16),{left:`${m}px`,top:`${v}px`,transform:P.value?"scale(1) translateY(0)":"scale(0.95) translateY(-10px)",opacity:P.value?"1":"0"}}),U=(t,o)=>{var a;(a=w(t))!=null&&a.length&&(clearTimeout(C),_.value=t,N(o),C=setTimeout(()=>{P.value=!0},500))},i=()=>{clearTimeout(C),C=setTimeout(()=>{P.value=!1,_.value=null},300)},D=()=>{clearTimeout(C)},N=t=>{j.value={x:t.clientX,y:t.clientY}},K=new Map,u=k(()=>{if(K.has(d.tipo))return K.get(d.tipo);const t={cotizaciones:{titulo:"Cotizaciones",mostrarCampoExtra:!0,campoExtra:{key:"numero_cotizacion",label:"N° Cotización"},acciones:{editar:!0,duplicar:!0,imprimir:!0,eliminar:!0},estados:{borrador:{label:"Borrador",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},pendiente:{label:"Pendiente",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},aprobada:{label:"Aprobada",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},rechazada:{label:"Rechazada",classes:"bg-red-100 text-red-700",color:"bg-red-400"},enviada:{label:"Enviada",classes:"bg-purple-100 text-purple-700",color:"bg-purple-400"},enviado_pedido:{label:"Enviado a Pedido",classes:"bg-orange-100 text-orange-700",color:"bg-orange-400"},convertida_pedido:{label:"Convertida a Pedido",classes:"bg-green-100 text-green-700",color:"bg-green-400"},enviado_pedido:{label:"Enviado a Pedido",classes:"bg-indigo-100 text-indigo-700",color:"bg-indigo-400"},cancelado:{label:"Cancelado",classes:"bg-red-100 text-red-700",color:"bg-red-400"},sin_estado:{label:"Sin Estado",classes:"bg-gray-100 text-gray-500",color:"bg-gray-400"}}},pedidos:{titulo:"Pedidos",mostrarCampoExtra:!0,campoExtra:{key:"numero_pedido",label:"N° Pedido"},acciones:{editar:!0,duplicar:!0,imprimir:!0,eliminar:!0},estados:{borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},confirmado:{label:"Confirmado",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},en_preparacion:{label:"En Preparación",classes:"bg-orange-100 text-orange-700",color:"bg-orange-400"},listo_entrega:{label:"Listo para Entrega",classes:"bg-purple-100 text-purple-700",color:"bg-purple-400"},entregado:{label:"Entregado",classes:"bg-green-100 text-green-700",color:"bg-green-400"},enviado_venta:{label:"Enviado a Venta",classes:"bg-indigo-100 text-indigo-700",color:"bg-indigo-400"},cancelado:{label:"Cancelado",classes:"bg-red-100 text-red-700",color:"bg-red-400"}}},ventas:{titulo:"Ventas",mostrarCampoExtra:!0,campoExtra:{key:"numero_venta",label:"N° Venta"},acciones:{editar:!0,duplicar:!0,imprimir:!0,eliminar:!0,marcar_pagado:!0},estados:{borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},aprobado:{label:"Aprobado",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},facturado:{label:"Facturado",classes:"bg-green-100 text-green-700",color:"bg-green-400"},pagado:{label:"Pagado",classes:"bg-emerald-100 text-emerald-700",color:"bg-emerald-400"},vencido:{label:"Vencido",classes:"bg-red-100 text-red-700",color:"bg-red-400"},anulado:{label:"Anulado",classes:"bg-gray-100 text-gray-500",color:"bg-gray-400"},cancelada:{label:"Cancelada",classes:"bg-red-100 text-red-700",color:"bg-red-400"}}},compras:{titulo:"Compras",mostrarCampoExtra:!0,campoExtra:{key:"numero_compra",label:"N° Compra"},acciones:{editar:!0,duplicar:!1,imprimir:!0,eliminar:!0},estados:{borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},confirmado:{label:"Confirmado",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},procesada:{label:"Procesada",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},en_preparacion:{label:"En Preparación",classes:"bg-orange-100 text-orange-700",color:"bg-orange-400"},listo_entrega:{label:"Listo para Entrega",classes:"bg-purple-100 text-purple-700",color:"bg-purple-400"},entregado:{label:"Entregado",classes:"bg-green-100 text-green-700",color:"bg-green-400"},cancelada:{label:"Cancelada",classes:"bg-red-100 text-red-700",color:"bg-red-400"}}},ordenescompra:{titulo:"Órdenes de Compra",mostrarCampoExtra:!0,campoExtra:{key:"numero_orden",label:"N° Orden"},acciones:{editar:!0,duplicar:!0,imprimir:!0,eliminar:!1},estados:{borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},enviado_a_proveedor:{label:"Enviado a Proveedor",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},convertida:{label:"Procesada",classes:"bg-green-100 text-green-700",color:"bg-green-400"},cancelada:{label:"Cancelada",classes:"bg-red-100 text-red-700",color:"bg-red-400"}}}},o=t[d.tipo]||t.cotizaciones;return K.set(d.tipo,o),o}),F=new Map,Y=t=>{if(!t)return"Fecha no disponible";const o=`fecha-${t}`;if(F.has(o))return F.get(o);try{const a=new Date(t).getTime();if(Number.isNaN(a))return"Fecha inválida";const p=new Date(a).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"});return F.set(o,p),p}catch{return"Fecha inválida"}},Z=t=>{if(!t)return"";const o=`hora-${t}`;if(F.has(o))return F.get(o);try{const a=new Date(t).getTime();if(Number.isNaN(a))return"";const p=new Date(a).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"});return F.set(o,p),p}catch{return""}},J=t=>{const o=parseFloat(t),a=Number.isFinite(o)?o:0,p=`moneda-${a}`;if(F.has(p))return F.get(p);const s=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a);return F.set(p,s),s},te=t=>{const o=parseFloat(t.precio??t.precio_venta??t.pv??0);return Number.isFinite(o)?o:0},B=t=>{var o;return((o=u.value.estados[t])==null?void 0:o.classes)||"bg-gray-100 text-gray-700"},X=t=>{var o;return((o=u.value.estados[t])==null?void 0:o.color)||"bg-gray-400"},oe=t=>{var o;return((o=u.value.estados[t])==null?void 0:o.label)||"Pendiente"},le=t=>({efectivo:"Efectivo",transferencia:"Transferencia",cheque:"Cheque",tarjeta:"Tarjeta",otros:"Otros"})[t]||t,Q=k(()=>{if(!Array.isArray(d.documentos))return console.warn("⚠️ Documentos is not an array:",d.documentos),[];let t=d.documentos.slice();if(d.searchTerm){const s=d.searchTerm.toLowerCase();t=t.filter(r=>{var m,v,S,z,O,V,A,H,h,W,we;if(y.value){const T=d.tipo==="ordenescompra"?r.items:r.productos;return(((m=r.proveedor)==null?void 0:m.nombre_razon_social)||"").toLowerCase().includes(s)||(T==null?void 0:T.some(Ce=>(Ce.nombre||"").toLowerCase().includes(s)))||(r.numero_compra||r.id||"").toString().toLowerCase().includes(s)}return d.tipo==="ordenescompra"?(((v=r.proveedor)==null?void 0:v.nombre_razon_social)||"").toLowerCase().includes(s)||((S=r.items)==null?void 0:S.some(T=>(T.nombre||"").toLowerCase().includes(s)))||(r.numero_orden||r.id||"").toString().toLowerCase().includes(s):d.tipo==="cotizaciones"?(((z=r.cliente)==null?void 0:z.nombre)||"").toLowerCase().includes(s)||((O=r.productos)==null?void 0:O.some(T=>(T.nombre||"").toLowerCase().includes(s)))||(r.numero||r.id||"").toString().toLowerCase().includes(s):d.tipo==="pedidos"?(((V=r.cliente)==null?void 0:V.nombre)||"").toLowerCase().includes(s)||((A=r.productos)==null?void 0:A.some(T=>(T.nombre||"").toLowerCase().includes(s)))||(r.numero_pedido||r.id||"").toString().toLowerCase().includes(s)||(r.estado==="enviado_venta"?"enviado a venta":"").toLowerCase().includes(s):d.tipo==="ventas"?(((H=r.cliente)==null?void 0:H.nombre)||"").toLowerCase().includes(s)||((h=r.productos)==null?void 0:h.some(T=>(T.nombre||"").toLowerCase().includes(s)))||(r.numero_venta||r.id||"").toString().toLowerCase().includes(s):(((W=r.cliente)==null?void 0:W.nombre_razon_social)||"").toLowerCase().includes(s)||((we=r.productos)==null?void 0:we.some(T=>(T.nombre||"").toLowerCase().includes(s)))||(r.numero_pedido||r.numero_factura||r.id||"").toString().toLowerCase().includes(s)})}d.filtroEstado&&(t=t.filter(s=>s.estado===d.filtroEstado));const[o,a]=d.sortBy.split("-"),p=s=>{const r=new Date(s).getTime();return Number.isNaN(r)?0:r};return t.sort((s,r)=>{var z,O,V,A,H,h;let m,v;switch(o){case"fecha":m=p(s.created_at||s.fecha),v=p(r.created_at||r.fecha);break;case"cliente":d.tipo==="pedidos"||d.tipo==="ventas"?(m=(((z=s.cliente)==null?void 0:z.nombre)||"").toLowerCase(),v=(((O=r.cliente)==null?void 0:O.nombre)||"").toLowerCase()):(m=(((V=s.cliente)==null?void 0:V.nombre_razon_social)||"").toLowerCase(),v=(((A=r.cliente)==null?void 0:A.nombre_razon_social)||"").toLowerCase());break;case"proveedor":m=(((H=s.proveedor)==null?void 0:H.nombre_razon_social)||"").toLowerCase(),v=(((h=r.proveedor)==null?void 0:h.nombre_razon_social)||"").toLowerCase();break;case"numero_orden":m=(s.numero_orden||s.id||"").toString().toLowerCase(),v=(r.numero_orden||r.id||"").toString().toLowerCase();break;case"numero_compra":m=(s.numero_compra||s.id||"").toString().toLowerCase(),v=(r.numero_compra||r.id||"").toString().toLowerCase();break;case"nombre":m=(s.nombre||s.titulo||"").toLowerCase(),v=(r.nombre||r.titulo||"").toLowerCase();break;case"precio":m=te(s),v=te(r);break;case"total":m=parseFloat(s.total),m=Number.isFinite(m)?m:0,v=parseFloat(r.total),v=Number.isFinite(v)?v:0;break;case"estado":m=s.estado||"",v=r.estado||"";break;default:m=(s==null?void 0:s[o])??"",v=(r==null?void 0:r[o])??""}const S=m<v?-1:m>v?1:0;return a==="desc"?-S:S})}),re=k(()=>{var t;return((t=d.documentos)==null?void 0:t.length)||0}),ie=t=>x("ver-detalles",t),de=t=>x("editar",t),ce=t=>x("eliminar",t),ue=t=>x("imprimir",t),ae=t=>x("enviar-venta",t),ge=t=>x("enviar-pedido",t),se=t=>x("marcar-pagado",t),pe=t=>x("enviar-compra",t),me=t=>x("recibir-orden",t),ve=t=>x("cancelar-orden",t),R=t=>{const a=(d.sortBy.startsWith(t)?d.sortBy:`${t}-desc`)===`${t}-desc`?`${t}-asc`:`${t}-desc`;x("sort",a)},ne=()=>{let t=4;return u.value.mostrarCampoExtra&&t++,u.value.mostrarTotal!==!1&&t++,u.value.mostrarProductos!==!1&&t++,t};return(t,o)=>{var p,s;const a=Te("font-awesome-icon");return n(),l("div",it,[e("div",dt,[e("div",ct,[e("h2",ut,g(u.value.titulo),1),e("div",gt,g(Q.value.length)+" de "+g(re.value)+" "+g(u.value.titulo.toLowerCase()),1)])]),(n(),$e(Le,{to:"body"},[P.value&&_.value?(n(),l("div",{key:0,class:"fixed z-[9999] bg-white rounded-xl shadow-xl border border-gray-200/50 backdrop-blur-sm w-80 max-h-96 pointer-events-auto transform transition-all duration-200 ease-out",style:Me(I.value),onMouseenter:D,onMouseleave:i},[e("div",pt,[e("div",mt,[o[5]||(o[5]=e("h3",{class:"text-sm font-semibold text-gray-900"},"Productos",-1)),e("span",vt,g(((p=w(_.value))==null?void 0:p.length)||0),1)])]),e("div",bt,[(s=w(_.value))!=null&&s.length?(n(),l("div",ft,[(n(!0),l(G,null,ye(w(_.value),(r,m)=>(n(),l("div",{key:m,class:"group p-3 bg-gray-50/70 rounded-lg hover:bg-gray-100/70 hover:shadow-sm transition-all duration-150"},[e("div",xt,[e("div",yt,[e("p",ht,g(r.nombre||"Sin nombre"),1),e("div",wt,[e("span",_t,g(r.cantidad||0)+" und ",1),o[6]||(o[6]=e("span",{class:"text-gray-400"},"•",-1)),e("span",kt," $"+g(J(r.precio||0)),1)]),r.descripcion?(n(),l("p",Ct,g(r.descripcion),1)):b("",!0)]),e("div",Et,[e("p",Pt," $"+g(J((r.cantidad||0)*(r.precio||0))),1)])])]))),128))])):(n(),l("div",Tt,o[7]||(o[7]=[e("div",{class:"w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m0 0V9a2 2 0 012-2h2m2 2v4"})])],-1),e("p",{class:"text-sm text-gray-500"},"Sin productos registrados",-1)])))])],36)):b("",!0)])),e("div",$t,[e("table",Mt,[e("thead",Lt,[e("tr",null,[e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:o[0]||(o[0]=r=>R("fecha"))},[e("div",jt,[o[9]||(o[9]=e("span",null,"Fecha",-1)),c.sortBy.startsWith("fecha")?(n(),l("svg",{key:0,class:M(["w-4 h-4 transition-transform duration-200",c.sortBy==="fecha-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},o[8]||(o[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):b("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:o[1]||(o[1]=r=>R(y.value?"proveedor":"cliente"))},[e("div",Dt,[e("span",null,g(y.value?"Proveedor":"Cliente"),1),c.sortBy.startsWith(y.value?"proveedor":"cliente")?(n(),l("svg",{key:0,class:M(["w-4 h-4 transition-transform duration-200",c.sortBy===`${y.value?"proveedor":"cliente"}-desc`?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},o[10]||(o[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):b("",!0)])]),u.value.mostrarCampoExtra?(n(),l("th",{key:0,class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:o[2]||(o[2]=r=>R(u.value.campoExtra.key))},[e("div",Nt,[e("span",null,g(u.value.campoExtra.label),1),c.sortBy.startsWith(u.value.campoExtra.key)?(n(),l("svg",{key:0,class:M(["w-4 h-4 transition-transform duration-200",c.sortBy===`${u.value.campoExtra.key}-desc`?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},o[11]||(o[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):b("",!0)])])):b("",!0),u.value.mostrarTotal!==!1?(n(),l("th",{key:1,class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:o[3]||(o[3]=r=>R("total"))},[e("div",Ft,[o[13]||(o[13]=e("span",null,"Total",-1)),c.sortBy.startsWith("total")?(n(),l("svg",{key:0,class:M(["w-4 h-4 transition-transform duration-200",c.sortBy==="total-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},o[12]||(o[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):b("",!0)])])):b("",!0),u.value.mostrarProductos!==!1?(n(),l("th",Bt," Productos ")):b("",!0),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:o[4]||(o[4]=r=>R("estado"))},[e("div",It,[e("span",null,g(d.tipo==="ventas"?"Estado de Pago":"Estado"),1),c.sortBy.startsWith("estado")?(n(),l("svg",{key:0,class:M(["w-4 h-4 transition-transform duration-200",c.sortBy==="estado-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},o[14]||(o[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):b("",!0)])]),o[15]||(o[15]=e("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ",-1))])]),e("tbody",St,[Q.value.length>0?(n(!0),l(G,{key:0},ye(Q.value,r=>{var m,v,S,z,O,V,A,H;return n(),l("tr",{key:r.id,class:M(["group hover:bg-gray-50/60 transition-all duration-150 hover:shadow-sm",r.estado==="cancelado"||r.estado==="cancelada"?"opacity-50":""])},[e("td",zt,[e("div",Ot,[e("div",Vt,g(Y(r.created_at||r.fecha)),1),e("div",At,g(Z(r.created_at||r.fecha)),1)])]),e("td",Ht,[e("div",Wt,[e("div",Gt,g(y.value?((m=r.proveedor)==null?void 0:m.nombre_razon_social)||"Sin proveedor":((v=r.cliente)==null?void 0:v.nombre)||"Sin cliente"),1),(y.value?(S=r.proveedor)!=null&&S.email:(z=r.cliente)!=null&&z.email)?(n(),l("div",Rt,g(y.value?(O=r.proveedor)==null?void 0:O.email:(V=r.cliente)==null?void 0:V.email),1)):b("",!0)])]),u.value.mostrarCampoExtra?(n(),l("td",Ut,[e("div",Xt,g(r[u.value.campoExtra.key]||"N/A"),1)])):b("",!0),u.value.mostrarTotal!==!1?(n(),l("td",qt,[e("div",Kt,[typeof r.total<"u"&&r.total!==null?(n(),l(G,{key:0},[q(" $"+g(J(r.total)),1)],64)):(n(),l(G,{key:1},[q("-")],64))])])):b("",!0),u.value.mostrarProductos!==!1?(n(),l("td",{key:2,class:"px-6 py-4 relative",onMouseenter:h=>{var W;return(W=w(r))!=null&&W.length?U(r,h):null},onMouseleave:i,onMousemove:h=>{var W;return(W=w(r))!=null&&W.length?N(h):null}},[e("div",{class:M(["flex items-center text-sm text-gray-600",(A=w(r))!=null&&A.length?"cursor-help hover:text-gray-800 transition-colors duration-150":"opacity-60"])},[o[16]||(o[16]=e("div",{class:"w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center mr-2 group-hover:bg-blue-100 transition-colors duration-150"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})])],-1)),e("span",Zt,g(((H=w(r))==null?void 0:H.length)||0),1),o[17]||(o[17]=e("span",{class:"text-gray-400 ml-1"},"items",-1))],2)],40,Yt)):b("",!0),e("td",Jt,[d.tipo==="ventas"?(n(),l("div",Qt,[e("span",{class:M([r.pagado?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700","inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium"])},[(n(),l("svg",{class:M([r.pagado?"text-green-500":"text-yellow-500","w-3 h-3 mr-1"]),fill:"currentColor",viewBox:"0 0 20 20"},[r.pagado?(n(),l("path",eo)):(n(),l("path",to))],2)),q(" "+g(r.pagado?"Pagado":"Pendiente de Pago"),1)],2),r.pagado&&r.metodo_pago?(n(),l("span",oo," ("+g(le(r.metodo_pago))+") ",1)):b("",!0)])):(n(),l("span",{key:1,class:M([B(r.estado),"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-150 hover:shadow-sm"])},[e("span",{class:M(["w-2 h-2 rounded-full mr-2 transition-all duration-150",X(r.estado)])},null,2),q(" "+g(oe(r.estado)),1)],2))]),e("td",ro,[e("div",ao,[e("button",{onClick:h=>ie(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Ver detalles"},[E(a,{icon:"eye",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,so),u.value.acciones.editar&&(r.estado==="borrador"||r.estado==="pendiente")?(n(),l("button",{key:0,onClick:h=>de(r.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-1",title:"Editar"},[E(a,{icon:"edit",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,no)):b("",!0),c.tipo==="cotizaciones"&&r.estado!=="cancelado"&&r.estado!=="enviado_pedido"?(n(),l("button",{key:1,onClick:h=>ge(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:ring-offset-1",title:"Enviar a Pedido"},[E(a,{icon:"paper-plane",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,lo)):b("",!0),c.tipo==="pedidos"&&r.estado!=="cancelado"?(n(),l("button",{key:2,onClick:h=>ae(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:ring-offset-1",title:"Enviar a Venta"},[E(a,{icon:"paper-plane",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,io)):b("",!0),u.value.acciones.imprimir&&r.estado!=="cancelado"&&r.estado!=="cancelada"&&c.tipo!=="cotizaciones"&&c.tipo!=="pedidos"&&c.tipo!=="ventas"&&c.tipo!=="ordenescompra"&&c.tipo!=="compras"?(n(),l("button",{key:3,onClick:h=>ue(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-purple-50 text-purple-600 hover:bg-purple-100 hover:text-purple-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:ring-offset-1",title:"Imprimir"},[E(a,{icon:"print",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,co)):b("",!0),c.tipo==="ventas"&&u.value.acciones.marcar_pagado&&!r.pagado&&r.estado!=="cancelado"?(n(),l("button",{key:4,onClick:h=>se(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:"Marcar como Pagado"},[E(a,{icon:"check-circle",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,uo)):b("",!0),c.tipo==="ordenescompra"&&r.estado==="pendiente"?(n(),l("button",{key:5,onClick:h=>pe(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Enviar orden al proveedor"},[E(a,{icon:"paper-plane",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,go)):b("",!0),c.tipo==="ordenescompra"&&r.estado==="enviado_a_proveedor"?(n(),l("button",{key:6,onClick:h=>me(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:"Recibir mercancía y crear registro de compra"},[E(a,{icon:"shopping-cart",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,po)):b("",!0),c.tipo==="ordenescompra"&&["pendiente","enviado_a_proveedor"].includes(r.estado)?(n(),l("button",{key:7,onClick:h=>ve(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-orange-50 text-orange-600 hover:bg-orange-100 hover:text-orange-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-1",title:"Cancelar Orden"},[E(a,{icon:"times-circle",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,mo)):b("",!0),u.value.acciones.eliminar&&r.estado!=="cancelado"&&r.estado!=="cancelada"?(n(),l("button",{key:8,onClick:h=>ce(r.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50 focus:ring-offset-1",title:"Eliminar"},[E(a,{icon:"trash",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,vo)):b("",!0)])])],2)}),128)):(n(),l("tr",bo,[e("td",{colspan:ne(),class:"px-6 py-16 text-center"},[e("div",xo,[o[19]||(o[19]=e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",yo,[e("p",ho,"No hay "+g(u.value.titulo.toLowerCase()),1),o[18]||(o[18]=e("p",{class:"text-sm text-gray-500"},"Los documentos aparecerán aquí cuando se creen",-1))])])],8,fo)]))])])])])}}},_o=he(wo,[["__scopeId","data-v-14311ad5"]]),ko={class:"compras-index min-h-screen bg-gray-50"},Co={class:"max-w-8xl mx-auto px-6 py-8"},Eo={class:"flex justify-between items-center mb-4 text-sm text-gray-600"},Po={class:"flex items-center space-x-2"},To=["value"],$o={class:"mt-6"},Mo={key:0,class:"flex justify-center items-center space-x-2 mt-6"},Lo=["disabled"],jo={class:"flex space-x-1"},Do=["onClick"],No=["disabled"],Fo={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Bo=Object.assign({layout:Be},{__name:"Index",props:{compras:{type:Object,default:()=>({data:[]})},stats:{type:Object,default:()=>({total:0,procesadas:0,canceladas:0})},filters:{type:Object,default:()=>({})},sorting:{type:Object,default:()=>({sort_by:"created_at",sort_direction:"desc",allowed_sorts:["created_at","total","estado"]})},pagination:{type:Object,default:()=>({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0})}},setup(c){var ne;const f=c,d=new Ne({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),x=L(!1),y=L(null),w=L("details"),P=L(null),_=L(!1),j=()=>{x.value=!1,y.value=null,P.value=null,w.value="details"},C=L(f.filters.search||""),$=L(`${f.sorting.sort_by}-${f.sorting.sort_direction}`),I=L(f.filters.estado||""),U=L([...((ne=f.compras)==null?void 0:ne.data)||[]]),i=k(()=>{const t=y.value;if(!t)return null;const o=t.metadata||{};return{creado_por:t.creado_por_nombre||t.created_by_user_name||o.creado_por||"N/A",actualizado_por:t.actualizado_por_nombre||t.updated_by_user_name||o.actualizado_por||"N/A",eliminado_por:t.eliminado_por_nombre||t.deleted_by_user_name||o.eliminado_por||null,creado_en:t.created_at||o.creado_en||null,actualizado_en:t.updated_at||o.actualizado_en||null,eliminado_en:t.deleted_at||o.eliminado_en||null}}),D=k(()=>{var t;return((t=f.compras)==null?void 0:t.data)||[]}),N=k(()=>f.pagination.current_page),K=k(()=>f.pagination.per_page),u=k(()=>f.pagination.last_page),F=k(()=>D.value),Y=k(()=>{const t=[],o=u.value,a=N.value;if(o<=7)for(let p=1;p<=o;p++)t.push(p);else if(a<=3)for(let p=1;p<=5;p++)t.push(p);else if(a>=o-2)for(let p=o-4;p<=o;p++)t.push(p);else for(let p=a-2;p<=a+2;p++)t.push(p);return t}),Z=t=>{t>=1&&t<=u.value&&B({page:t})},J=()=>{N.value<u.value&&B({page:N.value+1})},te=()=>{N.value>1&&B({page:N.value-1})},B=(t={})=>{const o={search:C.value,estado:I.value,sort_by:$.value.split("-")[0],sort_direction:$.value.split("-")[1],page:1,per_page:K.value,...t};ee.get("/compras",o,{preserveState:!0,replace:!0})};xe(()=>f.compras,t=>{t&&t.data&&Array.isArray(t.data)&&(U.value=[...t.data])},{deep:!0,immediate:!0}),xe([C,I,$],()=>{B()});const X=k(()=>({total:f.stats.total||0,procesadas:f.stats.procesadas||0,canceladas:f.stats.canceladas||0})),oe=k(()=>f.stats.monto_total||0),le=k(()=>{const t=X.value.total||1;return oe.value/t}),Q=()=>{C.value="",$.value="created_at-desc",I.value="",B({page:1}),d.success("Filtros limpiados correctamente")},re=t=>{t&&typeof t=="string"&&($.value=t,B({page:1}))};function ie(t){if(!(t!=null&&t.id))throw new Error("ID de compra no válido");return!0}function de(t){var o;if(!t.id)throw new Error("ID del documento no encontrado");if(!((o=t.cliente)!=null&&o.nombre_razon_social))throw new Error("Datos del cliente no encontrados");if(!Array.isArray(t.productos)||!t.productos.length)throw new Error("Lista de productos no válida");if(!t.fecha)throw new Error("Fecha no especificada");return!0}const ce=t=>{try{ie(t),y.value=t,w.value="details",x.value=!0}catch(o){d.error(o.message)}},ue=t=>{P.value=t,w.value="confirm",x.value=!0},ae=t=>{var o;try{const a=t||((o=y.value)==null?void 0:o.id);if(!a)throw new Error("ID de compra no válido");ee.visit(`/compras/${a}/edit`)}catch(a){d.error(a.message)}},ge=t=>{ae(t)},se=async t=>{try{const o={...t,cliente:t.proveedor,productos:t.productos,fecha:t.fecha||t.created_at||new Date().toISOString()};de(o),_.value=!0,d.success("Generando PDF..."),await Fe("Compra",o),d.success("PDF generado correctamente")}catch(o){console.error("Error al generar PDF:",o),d.error(`Error al generar el PDF: ${o.message}`)}finally{_.value=!1}},pe=()=>{y.value&&se(y.value)},me=t=>{try{if(!t)throw new Error("ID de compra no válido");ue(t)}catch(o){d.error(o.message)}},ve=async()=>{try{if(!P.value)throw new Error("No se seleccionó ninguna compra");_.value=!0,ee.post(`/compras/${P.value}/cancel`,{},{onStart:()=>{d.success("Cancelando compra...")},onSuccess:()=>{d.success("Compra cancelada exitosamente"),j(),setTimeout(()=>ee.reload(),100)},onError:t=>{console.error("Error al cancelar:",t),d.error("Error al cancelar la compra"),j()},onFinish:()=>{_.value=!1}})}catch(t){d.error(t.message),_.value=!1,j()}},R=()=>{ee.visit("/compras/create")};return(t,o)=>(n(),l(G,null,[E(je(De),{title:"Compras"}),e("div",ko,[e("div",Co,[E(lt,{total:X.value.total,procesadas:X.value.procesadas,canceladas:X.value.canceladas,"monto-total":oe.value,promedio:le.value,"search-term":C.value,"onUpdate:searchTerm":o[0]||(o[0]=a=>C.value=a),"sort-by":$.value,"onUpdate:sortBy":o[1]||(o[1]=a=>$.value=a),"filtro-estado":I.value,"onUpdate:filtroEstado":o[2]||(o[2]=a=>I.value=a),onCrearNueva:R,onSearchChange:B,onFiltroEstadoChange:B,onSortChange:re,onLimpiarFiltros:Q},null,8,["total","procesadas","canceladas","monto-total","promedio","search-term","sort-by","filtro-estado"]),e("div",Eo,[e("div",null," Mostrando "+g(f.pagination.from)+" - "+g(f.pagination.to)+" de "+g(f.pagination.total)+" compras ",1),e("div",Po,[o[7]||(o[7]=e("span",null,"Elementos por página:",-1)),e("select",{value:f.pagination.per_page,onChange:o[3]||(o[3]=a=>B({per_page:a.target.value,page:1})),class:"border border-gray-300 rounded px-2 py-1 text-sm"},o[6]||(o[6]=[e("option",{value:"10"},"10",-1),e("option",{value:"15"},"15",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1)]),40,To)])]),e("div",$o,[E(_o,{documentos:F.value,tipo:"compras","search-term":C.value,"sort-by":$.value,"filtro-estado":I.value,onVerDetalles:ce,onEditar:ae,onImprimir:se,onEliminar:me,onSort:re},null,8,["documentos","search-term","sort-by","filtro-estado"])]),u.value>1?(n(),l("div",Mo,[e("button",{onClick:te,disabled:N.value===1,class:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,Lo),e("div",jo,[!Y.value.includes(1)&&u.value>7?(n(),l(G,{key:0},[e("button",{onClick:o[4]||(o[4]=a=>Z(1)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," 1 "),o[8]||(o[8]=e("span",{class:"px-3 py-2 text-sm text-gray-500"},"...",-1))],64)):b("",!0),(n(!0),l(G,null,ye(Y.value,a=>(n(),l("button",{key:a,onClick:p=>Z(a),class:M(["px-3 py-2 text-sm font-medium border border-gray-300 rounded-md",a===N.value?"bg-blue-500 text-white border-blue-500":"text-gray-700 bg-white hover:bg-gray-50"])},g(a),11,Do))),128)),!Y.value.includes(u.value)&&u.value>7?(n(),l(G,{key:1},[o[9]||(o[9]=e("span",{class:"px-3 py-2 text-sm text-gray-500"},"...",-1)),e("button",{onClick:o[5]||(o[5]=a=>Z(u.value)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"},g(u.value),1)],64)):b("",!0)]),e("button",{onClick:J,disabled:N.value===u.value,class:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,No)])):b("",!0)]),E(Ie,{show:x.value,mode:w.value,tipo:"compras",selected:y.value||{},auditoria:i.value,onClose:j,onConfirmDelete:ve,onImprimir:pe,onEditar:ge},null,8,["show","mode","selected","auditoria"]),_.value?(n(),l("div",Fo,o[10]||(o[10]=[e("div",{class:"bg-white p-6 rounded-lg shadow-lg"},[e("div",{class:"flex items-center space-x-3"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e("span",{class:"text-gray-700"},"Procesando...")])],-1)]))):b("",!0)])],64))}}),Go=he(Bo,[["__scopeId","data-v-f87ab531"]]);export{Go as default};
