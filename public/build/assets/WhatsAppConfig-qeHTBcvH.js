import{Q as I,p as N,r as g,R as P,i as n,o as l,g as y,f as t,u as U,Z as T,e as q,l as h,q as D,k as p,v as d,E as F,z as m,n as c,t as u,x,F as v,m as k,N as z}from"./vendor-d19pJyVS.js";import{A as O}from"./AppLayout-CcnrZQKI.js";import{N as G}from"./app-BcT2PLJy.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const H={class:"whatsapp-config min-h-screen bg-gray-50"},L={class:"max-w-4xl mx-auto px-6 py-8"},X={class:"mb-8"},$={class:"flex items-center justify-between"},J={class:"grid grid-cols-1 gap-8"},K={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Q={class:"flex items-center"},Z={key:0,class:"space-y-6"},Y={class:"border-t border-gray-200 pt-6"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},te={key:0,class:"mt-1 text-sm text-red-600"},ae={key:0,class:"mt-1 text-sm text-red-600"},se={key:0,class:"mt-1 text-sm text-red-600"},oe=["value"],re={class:"border-t border-gray-200 pt-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"md:col-span-2"},ie={key:0,class:"mt-1 text-sm text-red-600"},pe={class:"md:col-span-2"},de={key:0,class:"mt-1 text-sm text-red-600"},ue={class:"flex space-x-2"},ce={key:0,class:"mt-1 text-sm text-red-600"},me=["value"],be={key:0,class:"mt-1 text-sm text-red-600"},_e={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},fe={class:"flex items-center justify-between pt-6 border-t border-gray-200"},ge=["disabled"],he={key:0,class:"flex items-center"},ve={key:1},we={class:"flex items-center space-x-3"},ye=["disabled"],xe={key:0,class:"flex items-center"},ke={key:1},Ce=Object.assign({layout:O},{__name:"WhatsAppConfig",props:{empresa:{type:Object,default:()=>({whatsapp_enabled:!1,whatsapp_business_account_id:"",whatsapp_phone_number_id:"",whatsapp_sender_phone:"",whatsapp_access_token:"",whatsapp_app_secret:"",whatsapp_webhook_verify_token:"",whatsapp_default_language:"es_MX",whatsapp_template_payment_reminder:""})}},setup(C){const A=C,i=new G({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),E=I();N(()=>{const r=E.props.flash;r!=null&&r.success&&i.success(r.success),r!=null&&r.error&&i.error(r.error)});const a=g({...A.empresa}),_=g(!1),f=g(!1),s=g({}),w=()=>(s.value={},a.value.whatsapp_enabled&&(a.value.whatsapp_business_account_id||(s.value.whatsapp_business_account_id="El ID de cuenta empresarial es requerido"),a.value.whatsapp_phone_number_id||(s.value.whatsapp_phone_number_id="El ID de número de teléfono es requerido"),a.value.whatsapp_sender_phone?V(a.value.whatsapp_sender_phone)||(s.value.whatsapp_sender_phone="El número debe estar en formato E.164 (ej: +52551234567)"):s.value.whatsapp_sender_phone="El número de teléfono es requerido",a.value.whatsapp_access_token||(s.value.whatsapp_access_token="El token de acceso es requerido"),a.value.whatsapp_app_secret||(s.value.whatsapp_app_secret="El secreto de la aplicación es requerido"),a.value.whatsapp_webhook_verify_token||(s.value.whatsapp_webhook_verify_token="El token de verificación del webhook es requerido"),a.value.whatsapp_template_payment_reminder||(s.value.whatsapp_template_payment_reminder="La plantilla de recordatorio de pago es requerida")),Object.keys(s.value).length===0),M=()=>{if(!w()){i.error("Por favor corrija los errores del formulario");return}_.value=!0,z.post("/empresa/configuracion",a.value,{onStart:()=>{i.success("Guardando configuración...")},onSuccess:()=>{i.success("Configuración guardada correctamente")},onError:r=>{console.error("Errores de validación:",r),i.error("Error al guardar la configuración")},onFinish:()=>{_.value=!1}})},S=async()=>{var r;if(!a.value.whatsapp_enabled){i.error("Debe habilitar WhatsApp primero");return}if(!w()){i.error("Corrija los errores antes de probar");return}f.value=!0;try{const e=await fetch("/admin/whatsapp/test",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({telefono:a.value.whatsapp_sender_phone,mensaje:"Mensaje de prueba - Configuración de WhatsApp funcionando correctamente"})}),b=await e.json();e.ok&&b.success?i.success("Configuración válida: "+b.message):i.error("Error en configuración: "+(b.message||"Error desconocido"))}catch(e){console.error("Error en prueba:",e),i.error("Error de conexión: "+e.message)}finally{f.value=!1}},V=r=>/^\+[1-9]\d{1,14}$/.test(r),j=()=>{const r=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);a.value.whatsapp_webhook_verify_token=r},B=[{value:"es_MX",label:"Español (México)"},{value:"en_US",label:"English (US)"}],W=[{value:"recordarorio_de_instalacion",label:"Recordatorio de Instalación"},{value:"saludo",label:"Mensaje de Bienvenida (Saludo)"},{value:"mensaje_de_bienvenida_climas_del_desierto",label:"Bienvenida Climas del Desierto"},{value:"hello_world",label:"Hello World (Prueba)"},{value:"payment_reminder",label:"Recordatorio de Pago (Nueva)"}];return(r,e)=>{const b=P("router-link");return l(),n(v,null,[y(U(T),{title:"Configuración de WhatsApp"}),t("div",H,[t("div",L,[t("div",X,[t("div",$,[e[11]||(e[11]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Configuración de WhatsApp Business"),t("p",{class:"text-gray-600 mt-2"},"Configure la integración con WhatsApp Business API para envío de recordatorios automáticos")],-1)),y(b,{to:r.route("empresa-configuracion.index"),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},{default:q(()=>e[10]||(e[10]=[h(" ← Volver a Configuración ")])),_:1},8,["to"])])]),t("div",J,[t("div",K,[e[35]||(e[35]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h2",{class:"text-lg font-semibold text-gray-900"},"Configuración de WhatsApp")],-1)),t("form",{onSubmit:D(M,["prevent"]),class:"p-6 space-y-6"},[t("div",null,[t("div",Q,[d(t("input",{id:"whatsapp_enabled","onUpdate:modelValue":e[0]||(e[0]=o=>a.value.whatsapp_enabled=o),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[F,a.value.whatsapp_enabled]]),e[12]||(e[12]=t("label",{for:"whatsapp_enabled",class:"ml-2 block text-sm font-medium text-gray-700"}," Habilitar WhatsApp Business ",-1))]),e[13]||(e[13]=t("p",{class:"mt-1 text-sm text-gray-500"}," Active esta opción para habilitar el envío automático de recordatorios por WhatsApp ",-1))]),a.value.whatsapp_enabled?(l(),n("div",Z,[t("div",Y,[e[21]||(e[21]=t("h3",{class:"text-md font-medium text-gray-900 mb-4"},"Configuración de la API",-1)),t("div",ee,[t("div",null,[e[14]||(e[14]=t("label",{for:"whatsapp_business_account_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Business Account ID * ",-1)),d(t("input",{id:"whatsapp_business_account_id","onUpdate:modelValue":e[1]||(e[1]=o=>a.value.whatsapp_business_account_id=o),type:"text",placeholder:"1234567890123456",class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":s.value.whatsapp_business_account_id}])},null,2),[[m,a.value.whatsapp_business_account_id]]),s.value.whatsapp_business_account_id?(l(),n("p",te,u(s.value.whatsapp_business_account_id),1)):p("",!0),e[15]||(e[15]=t("p",{class:"mt-1 text-xs text-gray-500"},"Obtenible en Facebook Business Manager",-1))]),t("div",null,[e[16]||(e[16]=t("label",{for:"whatsapp_phone_number_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Phone Number ID * ",-1)),d(t("input",{id:"whatsapp_phone_number_id","onUpdate:modelValue":e[2]||(e[2]=o=>a.value.whatsapp_phone_number_id=o),type:"text",placeholder:"123456789012345",class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":s.value.whatsapp_phone_number_id}])},null,2),[[m,a.value.whatsapp_phone_number_id]]),s.value.whatsapp_phone_number_id?(l(),n("p",ae,u(s.value.whatsapp_phone_number_id),1)):p("",!0),e[17]||(e[17]=t("p",{class:"mt-1 text-xs text-gray-500"},"ID del número de WhatsApp Business",-1))]),t("div",null,[e[18]||(e[18]=t("label",{for:"whatsapp_sender_phone",class:"block text-sm font-medium text-gray-700 mb-2"}," Número de Teléfono * ",-1)),d(t("input",{id:"whatsapp_sender_phone","onUpdate:modelValue":e[3]||(e[3]=o=>a.value.whatsapp_sender_phone=o),type:"text",placeholder:"+52551234567",class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":s.value.whatsapp_sender_phone}])},null,2),[[m,a.value.whatsapp_sender_phone]]),s.value.whatsapp_sender_phone?(l(),n("p",se,u(s.value.whatsapp_sender_phone),1)):p("",!0),e[19]||(e[19]=t("p",{class:"mt-1 text-xs text-gray-500"},"Formato E.164 con código de país",-1))]),t("div",null,[e[20]||(e[20]=t("label",{for:"whatsapp_default_language",class:"block text-sm font-medium text-gray-700 mb-2"}," Idioma por Defecto ",-1)),d(t("select",{id:"whatsapp_default_language","onUpdate:modelValue":e[4]||(e[4]=o=>a.value.whatsapp_default_language=o),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[(l(),n(v,null,k(B,o=>t("option",{key:o.value,value:o.value},u(o.label),9,oe)),64))],512),[[x,a.value.whatsapp_default_language]])])])]),t("div",re,[e[31]||(e[31]=t("h3",{class:"text-md font-medium text-gray-900 mb-4"},"Credenciales de Seguridad",-1)),t("div",ne,[t("div",le,[e[22]||(e[22]=t("label",{for:"whatsapp_access_token",class:"block text-sm font-medium text-gray-700 mb-2"}," Access Token * ",-1)),d(t("textarea",{id:"whatsapp_access_token","onUpdate:modelValue":e[5]||(e[5]=o=>a.value.whatsapp_access_token=o),rows:"3",placeholder:"EAAG...",class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",{"border-red-300":s.value.whatsapp_access_token}])},null,2),[[m,a.value.whatsapp_access_token]]),s.value.whatsapp_access_token?(l(),n("p",ie,u(s.value.whatsapp_access_token),1)):p("",!0),e[23]||(e[23]=t("p",{class:"mt-1 text-xs text-gray-500"},"Token de acceso permanente de Facebook",-1))]),t("div",pe,[e[24]||(e[24]=t("label",{for:"whatsapp_app_secret",class:"block text-sm font-medium text-gray-700 mb-2"}," App Secret * ",-1)),d(t("textarea",{id:"whatsapp_app_secret","onUpdate:modelValue":e[6]||(e[6]=o=>a.value.whatsapp_app_secret=o),rows:"3",placeholder:"abcd1234...",class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono text-sm",{"border-red-300":s.value.whatsapp_app_secret}])},null,2),[[m,a.value.whatsapp_app_secret]]),s.value.whatsapp_app_secret?(l(),n("p",de,u(s.value.whatsapp_app_secret),1)):p("",!0),e[25]||(e[25]=t("p",{class:"mt-1 text-xs text-gray-500"},"Secreto de la aplicación de Facebook",-1))]),t("div",null,[e[26]||(e[26]=t("label",{for:"whatsapp_webhook_verify_token",class:"block text-sm font-medium text-gray-700 mb-2"}," Token de Verificación Webhook * ",-1)),t("div",ue,[d(t("input",{id:"whatsapp_webhook_verify_token","onUpdate:modelValue":e[7]||(e[7]=o=>a.value.whatsapp_webhook_verify_token=o),type:"text",placeholder:"token123456",class:c(["flex-1 px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":s.value.whatsapp_webhook_verify_token}])},null,2),[[m,a.value.whatsapp_webhook_verify_token]]),t("button",{type:"button",onClick:j,class:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Generar ")]),s.value.whatsapp_webhook_verify_token?(l(),n("p",ce,u(s.value.whatsapp_webhook_verify_token),1)):p("",!0),e[27]||(e[27]=t("p",{class:"mt-1 text-xs text-gray-500"},"Token personalizado para verificar webhooks",-1))]),t("div",null,[e[29]||(e[29]=t("label",{for:"whatsapp_template_payment_reminder",class:"block text-sm font-medium text-gray-700 mb-2"}," Plantilla de Recordatorio * ",-1)),d(t("select",{id:"whatsapp_template_payment_reminder","onUpdate:modelValue":e[8]||(e[8]=o=>a.value.whatsapp_template_payment_reminder=o),class:c(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",{"border-red-300":s.value.whatsapp_template_payment_reminder}])},[e[28]||(e[28]=t("option",{value:""},"Seleccionar plantilla...",-1)),(l(),n(v,null,k(W,o=>t("option",{key:o.value,value:o.value},u(o.label),9,me)),64))],2),[[x,a.value.whatsapp_template_payment_reminder]]),s.value.whatsapp_template_payment_reminder?(l(),n("p",be,u(s.value.whatsapp_template_payment_reminder),1)):p("",!0),e[30]||(e[30]=t("p",{class:"mt-1 text-xs text-gray-500"},"Plantilla aprobada por Meta para recordatorios",-1))])])])])):p("",!0),a.value.whatsapp_enabled?(l(),n("div",_e,e[32]||(e[32]=[t("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Información Importante",-1),t("div",{class:"text-sm text-blue-800 space-y-1"},[t("p",null,"• Asegúrese de que las plantillas estén aprobadas en Meta Business"),t("p",null,"• El número de teléfono debe estar en formato E.164 (ej: +52551234567)"),t("p",null,[h("• Configure el webhook en Meta apuntando a: "),t("code",{class:"bg-blue-100 px-1 rounded"},"https://sudominio.com/api/webhooks/whatsapp")]),t("p",null,"• Use el mismo token de verificación en la configuración de Meta")],-1)]))):p("",!0),t("div",fe,[a.value.whatsapp_enabled?(l(),n("button",{key:0,type:"button",onClick:S,disabled:f.value,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[f.value?(l(),n("span",he,e[33]||(e[33]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" Probando... ")]))):(l(),n("span",ve,"🧪 Probar Configuración"))],8,ge)):p("",!0),t("div",we,[t("button",{type:"button",onClick:e[9]||(e[9]=o=>r.$inertia.get(r.route("empresa-configuracion.index"))),class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"}," ❌ Cancelar "),t("button",{type:"submit",disabled:_.value,class:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[_.value?(l(),n("span",xe,e[34]||(e[34]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),h(" Guardando... ")]))):(l(),n("span",ke,"💾 Guardar Configuración"))],8,ye)])])],32)])])])])],64)}}}),je=R(Ce,[["__scopeId","data-v-8f5fb693"]]);export{je as default};
