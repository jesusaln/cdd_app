import{B as ne,C as ee,w as Z,i as h,o as b,f as e,l as K,t as $,v as te,z as xe,x as se,s as ie,c as V,R as we,k as F,n as O,F as G,m as _e,g as L,r as N,u as ke,Z as Ce,N as W}from"./vendor-d19pJyVS.js";import{a as le}from"./utils-Dq7h7Pqt.js";import{N as Ee}from"./app-BcT2PLJy.js";import"./jspdf.es.min-BE3S9W4e.js";import{A as $e}from"./AppLayout-CcnrZQKI.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{M as ze}from"./Modales-BBthfVFz.js";import{_ as Be}from"./Pagination-B0Pz79Or.js";const Me={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},Ne={class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-6 border-b border-gray-200/60"},Fe={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},je={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ie={class:"flex items-center justify-between"},Se={class:"text-2xl font-bold text-gray-900"},Pe={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Le={class:"flex items-center justify-between"},De={class:"text-2xl font-bold text-green-600"},Te={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ae={class:"flex items-center justify-between"},Ve={class:"text-2xl font-bold text-yellow-600"},Oe={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Re={class:"flex items-center justify-between"},Ue={class:"text-2xl font-bold text-gray-600"},He={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},We={class:"flex items-center justify-between"},Ze={class:"text-2xl font-bold text-indigo-600"},Ke={class:"px-6 py-4 bg-gray-50/50 border-b border-gray-200/60"},Xe={class:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"},qe={class:"flex-1 max-w-md"},Ge={class:"relative"},Ye={class:"flex items-center space-x-3"},Je={__name:"CotizacionesHeader",props:ne({total:{type:Number,default:0},aprobadas:{type:Number,default:0},pendientes:{type:Number,default:0},borrador:{type:Number,default:0},enviado_pedido:{type:Number,default:0},cancelado:{type:Number,default:0}},{searchTerm:{type:String,default:""},searchTermModifiers:{},sortBy:{type:String,default:"fecha-desc"},sortByModifiers:{},filtroEstado:{type:String,default:""},filtroEstadoModifiers:{}}),emits:ne(["crear-nueva","search-change","filtro-estado-change","sort-change","limpiar-filtros"],["update:searchTerm","update:sortBy","update:filtroEstado"]),setup(m,{emit:R}){const i=R,y=ee(m,"searchTerm"),g=ee(m,"sortBy"),j=ee(m,"filtroEstado"),D=()=>i("crear-nueva"),x=()=>i("search-change",y.value),z=()=>i("filtro-estado-change",j.value),T=()=>i("sort-change",g.value),M=()=>i("limpiar-filtros");return Z([y,g,j],()=>{},{immediate:!0}),(I,n)=>(b(),h("div",Me,[e("div",Ne,[e("div",{class:"flex items-center justify-between mb-6"},[n[4]||(n[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 tracking-tight"},"Cotizaciones"),e("p",{class:"text-sm text-gray-600 mt-1"},"Gestiona todas tus cotizaciones en un solo lugar")],-1)),e("button",{onClick:D,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"},n[3]||(n[3]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),K(" Nueva Cotización ")]))]),e("div",Fe,[e("div",je,[e("div",Ie,[e("div",null,[n[5]||(n[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total",-1)),e("p",Se,$(m.total),1)]),n[6]||(n[6]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))])]),e("div",Pe,[e("div",Le,[e("div",null,[n[7]||(n[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Aprobadas",-1)),e("p",De,$(m.aprobadas),1)]),n[8]||(n[8]=e("div",{class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Te,[e("div",Ae,[e("div",null,[n[9]||(n[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Pendientes",-1)),e("p",Ve,$(m.pendientes),1)]),n[10]||(n[10]=e("div",{class:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",Oe,[e("div",Re,[e("div",null,[n[11]||(n[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Borradores",-1)),e("p",Ue,$(m.borrador),1)]),n[12]||(n[12]=e("div",{class:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])],-1))])]),e("div",He,[e("div",We,[e("div",null,[n[13]||(n[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Enviadas",-1)),e("p",Ze,$(m.enviado_pedido),1)]),n[14]||(n[14]=e("div",{class:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})])],-1))])])])]),e("div",Ke,[e("div",Xe,[e("div",qe,[e("div",Ge,[n[15]||(n[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),te(e("input",{"onUpdate:modelValue":n[0]||(n[0]=f=>y.value=f),type:"text",placeholder:"Buscar por cliente, número...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm",onInput:x},null,544),[[xe,y.value]])])]),e("div",Ye,[te(e("select",{"onUpdate:modelValue":n[1]||(n[1]=f=>j.value=f),onChange:z,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},n[16]||(n[16]=[ie('<option value="" data-v-92ea3309>Todos los estados</option><option value="borrador" data-v-92ea3309>Borrador</option><option value="pendiente" data-v-92ea3309>Pendiente</option><option value="aprobada" data-v-92ea3309>Aprobada</option><option value="rechazada" data-v-92ea3309>Rechazada</option><option value="enviada" data-v-92ea3309>Enviada</option><option value="enviado_pedido" data-v-92ea3309>Enviado a Pedido</option><option value="cancelado" data-v-92ea3309>Cancelado</option>',8)]),544),[[se,j.value]]),te(e("select",{"onUpdate:modelValue":n[2]||(n[2]=f=>g.value=f),onChange:T,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},n[17]||(n[17]=[ie('<option value="fecha-desc" data-v-92ea3309>Fecha (Más reciente)</option><option value="fecha-asc" data-v-92ea3309>Fecha (Más antiguo)</option><option value="cliente-asc" data-v-92ea3309>Cliente (A-Z)</option><option value="cliente-desc" data-v-92ea3309>Cliente (Z-A)</option><option value="total-desc" data-v-92ea3309>Total (Mayor)</option><option value="total-asc" data-v-92ea3309>Total (Menor)</option><option value="estado-asc" data-v-92ea3309>Estado (A-Z)</option><option value="estado-desc" data-v-92ea3309>Estado (Z-A)</option>',8)]),544),[[se,g.value]]),e("button",{onClick:M,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},n[18]||(n[18]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),K(" Limpiar ")]))])])])]))}},Qe=oe(Je,[["__scopeId","data-v-92ea3309"]]),et={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},tt={class:"bg-gradient-to-r from-gray-50 to-gray-100/50 px-6 py-4 border-b border-gray-200/60"},ot={class:"flex items-center justify-between"},rt={class:"text-sm text-gray-600 bg-white/70 px-3 py-1 rounded-full border border-gray-200/50"},at={class:"overflow-x-auto"},nt={class:"min-w-full divide-y divide-gray-200/60"},st={class:"bg-gray-50/60"},it={class:"flex items-center space-x-1"},lt={class:"flex items-center space-x-1"},dt={class:"flex items-center space-x-1"},ct={class:"flex items-center space-x-1"},ut={class:"flex items-center space-x-1"},vt={class:"bg-white divide-y divide-gray-200/40"},mt={class:"px-6 py-4"},pt={class:"flex flex-col space-y-0.5"},gt={class:"text-sm font-medium text-gray-900"},ft={class:"text-xs text-gray-500"},ht={class:"px-6 py-4"},bt={class:"flex flex-col space-y-0.5"},yt={class:"text-sm font-medium text-gray-900 group-hover:text-gray-800"},xt={key:0,class:"text-xs text-gray-500 truncate max-w-48"},wt={class:"px-6 py-4"},_t={class:"text-sm font-mono font-medium text-gray-700 bg-gray-100/60 px-2 py-1 rounded-md inline-block"},kt={class:"px-6 py-4"},Ct={class:"text-sm font-semibold text-gray-900"},Et={class:"px-6 py-4"},$t={class:"px-6 py-4"},zt={class:"flex items-center justify-end space-x-1"},Bt=["onClick"],Mt=["onClick"],Nt=["onClick"],Ft=["onClick","title"],jt=["onClick"],It=["onClick"],St={key:1},Pt={__name:"CotizacionesTable",props:{documentos:{type:Array,default:()=>[]},searchTerm:{type:String,default:""},sortBy:{type:String,default:"fecha-desc"}},emits:["ver-detalles","editar","eliminar","imprimir","sort","enviar-pedido","enviar-email"],setup(m,{emit:R}){const i=m,y=R,g={borrador:{label:"Borrador",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},pendiente:{label:"Pendiente",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},aprobada:{label:"Aprobada",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},rechazada:{label:"Rechazada",classes:"bg-red-100 text-red-700",color:"bg-red-400"},enviada:{label:"Enviada",classes:"bg-purple-100 text-purple-700",color:"bg-purple-400"},enviado_pedido:{label:"Enviado a Pedido",classes:"bg-orange-100 text-orange-700",color:"bg-orange-400"},convertida_pedido:{label:"Convertida a Pedido",classes:"bg-green-100 text-green-700",color:"bg-green-400"},cancelado:{label:"Cancelado",classes:"bg-red-100 text-red-700",color:"bg-red-400"},sin_estado:{label:"Sin Estado",classes:"bg-gray-100 text-gray-500",color:"bg-gray-400"}},j=s=>{var a;return((a=g[s])==null?void 0:a.classes)||"bg-gray-100 text-gray-700"},D=s=>{var a;return((a=g[s])==null?void 0:a.color)||"bg-gray-400"},x=s=>{var a;return((a=g[s])==null?void 0:a.label)||"Pendiente"},z=new Map,T=s=>{if(!s)return"Fecha no disponible";const a=`fecha-${s}`;if(z.has(a))return z.get(a);try{const p=new Date(s).getTime();if(Number.isNaN(p))return"Fecha inválida";const r=new Date(p).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"});return z.set(a,r),r}catch{return"Fecha inválida"}},M=s=>{if(!s)return"";const a=`hora-${s}`;if(z.has(a))return z.get(a);try{const p=new Date(s).getTime();if(Number.isNaN(p))return"";const r=new Date(p).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"});return z.set(a,r),r}catch{return""}},I=s=>{const a=parseFloat(s),p=Number.isFinite(a)?a:0,r=`moneda-${p}`;if(z.has(r))return z.get(r);const c=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(p);return z.set(r,c),c},n=V(()=>{if(!Array.isArray(i.documentos))return[];let s=i.documentos.slice();if(i.searchTerm){const r=i.searchTerm.toLowerCase();s=s.filter(c=>{var _;return(((_=c.cliente)==null?void 0:_.nombre)||"").toLowerCase().includes(r)||(c.numero_cotizacion||c.id||"").toString().toLowerCase().includes(r)||(c.estado||"").toLowerCase().includes(r)})}const[a,p]=i.sortBy.split("-");return s.sort((r,c)=>{var X,q;let _,k;switch(a){case"fecha":_=new Date(r.created_at||r.fecha||0).getTime(),k=new Date(c.created_at||c.fecha||0).getTime();break;case"cliente":_=(((X=r.cliente)==null?void 0:X.nombre)||"").toLowerCase(),k=(((q=c.cliente)==null?void 0:q.nombre)||"").toLowerCase();break;case"numero_cotizacion":_=(r.numero_cotizacion||r.id||"").toString().toLowerCase(),k=(c.numero_cotizacion||c.id||"").toString().toLowerCase();break;case"total":_=parseFloat(r.total||0),k=parseFloat(c.total||0);break;case"estado":_=(r.estado||"").toLowerCase(),k=(c.estado||"").toLowerCase();break;default:_=(r[a]||"").toLowerCase(),k=(c[a]||"").toLowerCase()}const P=_<k?-1:_>k?1:0;return p==="desc"?-P:P})}),f=V(()=>{var s;return((s=i.documentos)==null?void 0:s.length)||0}),Y=s=>y("ver-detalles",s),H=s=>y("editar",s),w=s=>y("eliminar",s),S=s=>y("imprimir",s),J=s=>y("enviar-pedido",s),Q=s=>y("enviar-email",s),A=s=>{const p=(i.sortBy.startsWith(s)?i.sortBy:`${s}-desc`)===`${s}-desc`?`${s}-asc`:`${s}-desc`;y("sort",p)};return(s,a)=>{const p=we("font-awesome-icon");return b(),h("div",et,[e("div",tt,[e("div",ot,[a[5]||(a[5]=e("h2",{class:"text-lg font-semibold text-gray-900 tracking-tight"},"Cotizaciones",-1)),e("div",rt,$(n.value.length)+" de "+$(f.value)+" cotizaciones ",1)])]),e("div",at,[e("table",nt,[e("thead",st,[e("tr",null,[e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:a[0]||(a[0]=r=>A("fecha"))},[e("div",it,[a[7]||(a[7]=e("span",null,"Fecha",-1)),m.sortBy.startsWith("fecha")?(b(),h("svg",{key:0,class:O(["w-4 h-4 transition-transform duration-200",m.sortBy==="fecha-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[6]||(a[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):F("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:a[1]||(a[1]=r=>A("cliente"))},[e("div",lt,[a[9]||(a[9]=e("span",null,"Cliente",-1)),m.sortBy.startsWith("cliente")?(b(),h("svg",{key:0,class:O(["w-4 h-4 transition-transform duration-200",m.sortBy==="cliente-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[8]||(a[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):F("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:a[2]||(a[2]=r=>A("numero_cotizacion"))},[e("div",dt,[a[11]||(a[11]=e("span",null,"N° Cotización",-1)),m.sortBy.startsWith("numero_cotizacion")?(b(),h("svg",{key:0,class:O(["w-4 h-4 transition-transform duration-200",m.sortBy==="numero_cotizacion-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[10]||(a[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):F("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:a[3]||(a[3]=r=>A("total"))},[e("div",ct,[a[13]||(a[13]=e("span",null,"Total",-1)),m.sortBy.startsWith("total")?(b(),h("svg",{key:0,class:O(["w-4 h-4 transition-transform duration-200",m.sortBy==="total-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[12]||(a[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):F("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:a[4]||(a[4]=r=>A("estado"))},[e("div",ut,[a[15]||(a[15]=e("span",null,"Estado",-1)),m.sortBy.startsWith("estado")?(b(),h("svg",{key:0,class:O(["w-4 h-4 transition-transform duration-200",m.sortBy==="estado-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},a[14]||(a[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):F("",!0)])]),a[16]||(a[16]=e("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ",-1))])]),e("tbody",vt,[n.value.length>0?(b(!0),h(G,{key:0},_e(n.value,r=>{var c,_,k;return b(),h("tr",{key:r.id,class:O(["group hover:bg-gray-50/60 transition-all duration-150 hover:shadow-sm",r.estado==="cancelado"?"opacity-50":""])},[e("td",mt,[e("div",pt,[e("div",gt,$(T(r.created_at||r.fecha)),1),e("div",ft,$(M(r.created_at||r.fecha)),1)])]),e("td",ht,[e("div",bt,[e("div",yt,$(((c=r.cliente)==null?void 0:c.nombre)||"Sin cliente"),1),(_=r.cliente)!=null&&_.email?(b(),h("div",xt,$(r.cliente.email),1)):F("",!0)])]),e("td",wt,[e("div",_t,$(r.numero_cotizacion_display||r.numero_cotizacion||r.id||"N/A"),1)]),e("td",kt,[e("div",Ct,[typeof r.total<"u"&&r.total!==null?(b(),h(G,{key:0},[K(" $"+$(I(r.total)),1)],64)):(b(),h(G,{key:1},[K("-")],64))])]),e("td",Et,[e("span",{class:O([j(r.estado),"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-150 hover:shadow-sm"])},[e("span",{class:O(["w-2 h-2 rounded-full mr-2 transition-all duration-150",D(r.estado)])},null,2),K(" "+$(x(r.estado)),1)],2)]),e("td",$t,[e("div",zt,[e("button",{onClick:P=>Y(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Ver detalles"},[L(p,{icon:"eye",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Bt),r.estado!=="cancelado"?(b(),h("button",{key:0,onClick:P=>H(r.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-1",title:"Editar"},[L(p,{icon:"edit",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Mt)):F("",!0),r.estado!=="cancelado"&&r.estado!=="enviado_pedido"?(b(),h("button",{key:1,onClick:P=>J(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-indigo-50 text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:ring-offset-1",title:"Enviar a Pedido"},[L(p,{icon:"paper-plane",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,Nt)):F("",!0),r.estado!=="cancelado"&&((k=r.cliente)!=null&&k.email)?(b(),h("button",{key:2,onClick:P=>Q(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:r.email_enviado?"Reenviar por Email":"Enviar por Email"},[L(p,{icon:r.email_enviado?"envelope-open":"envelope",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"},null,8,["icon"])],8,Ft)):F("",!0),r.estado!=="cancelado"?(b(),h("button",{key:3,onClick:P=>S(r),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-purple-50 text-purple-600 hover:bg-purple-100 hover:text-purple-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:ring-offset-1",title:"Imprimir"},[L(p,{icon:"print",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,jt)):F("",!0),r.estado!=="cancelado"&&r.estado!=="cancelada"?(b(),h("button",{key:4,onClick:P=>w(r.id),class:"group/btn relative inline-flex items-center justify-center w-9 h-9 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50 focus:ring-offset-1",title:"Eliminar"},[L(p,{icon:"trash",class:"w-4 h-4 transition-transform duration-200 group-hover/btn:scale-110"})],8,It)):F("",!0)])])],2)}),128)):(b(),h("tr",St,a[17]||(a[17]=[e("td",{colspan:6,class:"px-6 py-16 text-center"},[e("div",{class:"flex flex-col items-center space-y-4"},[e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("div",{class:"space-y-1"},[e("p",{class:"text-gray-700 font-medium"},"No hay cotizaciones"),e("p",{class:"text-sm text-gray-500"},"Las cotizaciones aparecerán aquí cuando se creen")])])],-1)])))])])])])}}},Lt=oe(Pt,[["__scopeId","data-v-92ff0a1b"]]),Dt={class:"cotizaciones-index min-h-screen bg-gray-50"},Tt={class:"max-w-8xl mx-auto px-6 py-8"},At={class:"mt-6"},Vt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ot=Object.assign({layout:$e},{__name:"Index",props:{cotizaciones:{type:Array,default:()=>[]}},setup(m){const R=m,i=new Ee({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),y=N(!1),g=N(null),j=N("details"),D=N(null),x=N(!1),z=t=>{g.value=t||null,j.value="details",y.value=!0},T=()=>{y.value=!1,g.value=null,D.value=null},M=N(""),I=N("fecha-desc"),n=N(""),f=N([...R.cotizaciones]),Y=V(()=>{const t=g.value;if(!t)return null;const o=t.metadata||{};return{creado_por:t.creado_por_nombre||t.created_by_user_name||o.creado_por||"N/A",actualizado_por:t.actualizado_por_nombre||t.updated_by_user_name||o.actualizado_por||"N/A",eliminado_por:t.eliminado_por_nombre||t.deleted_by_user_name||o.eliminado_por||null,creado_en:t.created_at||o.creado_en||null,actualizado_en:t.updated_at||o.actualizado_en||null,eliminado_en:t.deleted_at||o.eliminado_en||null}}),H=V(()=>{let t=[...f.value];if(M.value.trim()){const o=M.value.toLowerCase().trim();t=t.filter(l=>{var v,E,B;const C=((E=(v=l.cliente)==null?void 0:v.nombre)==null?void 0:E.toLowerCase())||"",d=String(l.numero_cotizacion||l.id||"").toLowerCase(),u=((B=l.estado)==null?void 0:B.toLowerCase())||"";return C.includes(o)||d.includes(o)||u.includes(o)})}if(n.value&&(t=t.filter(o=>o.estado===n.value)),I.value){const[o,l]=I.value.split("-"),C=l==="desc";t.sort((d,u)=>{var B,U;let v,E;switch(o){case"fecha":v=new Date(d.fecha||d.created_at||0).getTime(),E=new Date(u.fecha||u.created_at||0).getTime();break;case"cliente":v=((B=d.cliente)==null?void 0:B.nombre)||"",E=((U=u.cliente)==null?void 0:U.nombre)||"";break;case"total":v=parseFloat(d.total||0),E=parseFloat(u.total||0);break;case"estado":v=d.estado||"",E=u.estado||"";break;default:v=d[o]||"",E=u[o]||""}return v<E?C?1:-1:v>E?C?-1:1:0})}return t}),w=N(1),S=N(10),J=t=>{if(!t)return t;const o=t.match(/COT-(\d{4}-)?(\d{8}-)?(\d+)$/);return o?`COT-${o[3].padStart(5,"0")}`:t},Q=V(()=>{const t=(w.value-1)*S.value,o=t+S.value;return H.value.slice(t,o).map(l=>({...l,numero_cotizacion_display:J(l.numero_cotizacion)}))}),A=V(()=>Math.ceil(H.value.length/S.value)),s=V(()=>H.value.length),a=V(()=>({current_page:w.value,last_page:A.value,per_page:S.value,from:s.value>0?(w.value-1)*S.value+1:0,to:Math.min(w.value*S.value,s.value),total:s.value,prev_page_url:w.value>1?"#":null,next_page_url:w.value<A.value?"#":null,links:[]}));Z([M,I,n,S],()=>{w.value=1},{deep:!0});const p=t=>{S.value=t,w.value=1},r=t=>{w.value=t};Z(()=>R.cotizaciones,t=>{Array.isArray(t)&&(f.value=[...t])},{deep:!0,immediate:!0}),Z([M,n],()=>{w.value=1}),Z(A,t=>{w.value>t&&t>0&&(w.value=t)});const c=V(()=>{const t=f.value;return{total:t.length,aprobadas:t.filter(o=>["aprobado","aprobada"].includes(String(o.estado||"").toLowerCase())).length,pendientes:t.filter(o=>o.estado==="pendiente").length,borrador:t.filter(o=>o.estado==="borrador").length,enviado_pedido:t.filter(o=>o.estado==="enviado_pedido").length,cancelado:t.filter(o=>o.estado==="cancelado").length}}),_=()=>{M.value="",I.value="fecha-desc",n.value="",S.value=10,w.value=1,i.success("Filtros limpiados correctamente")},k=t=>{I.value=t||"fecha-desc",w.value=1};function P(t){if(!(t!=null&&t.id))throw new Error("ID de cotización no válido");return!0}function X(t){var o;if(!(t!=null&&t.id))throw new Error("ID de cotización no válido");if(!((o=t.cliente)!=null&&o.nombre))throw new Error("Datos del cliente no encontrados");if(!Array.isArray(t.productos)||!t.productos.length)throw new Error("Lista de productos no válida");if(!t.fecha&&!t.created_at)throw new Error("Fecha no especificada");return!0}const q=t=>{try{P(t),z(t)}catch(o){i.error(o.message)}},re=t=>{var o;try{const l=t||((o=g.value)==null?void 0:o.id);if(!l)throw new Error("ID de cotización no válido");W.visit(`/cotizaciones/${l}/edit`)}catch(l){i.error(l.message)}},de=t=>{re(t)},ce=async()=>{try{const t=g.value;if(!(t!=null&&t.id))throw new Error("Cotización no válida");x.value=!0,T(),W.post(`/cotizaciones/${t.id}/duplicate`,{},{onStart:()=>{i.success("Duplicando cotización...")},onSuccess:()=>{i.success("Cotización duplicada exitosamente")},onError:o=>{console.error("Error al duplicar:",o),i.error("Error al duplicar la cotización")},onFinish:()=>{x.value=!1}})}catch(t){i.error(t.message),x.value=!1}},ue=async t=>{try{if(console.log("=== IMPRIMIENDO COTIZACIÓN ==="),console.log("Cotización recibida:",t),console.log("ID:",t==null?void 0:t.id),console.log("Número:",t==null?void 0:t.numero_cotizacion),P(t),!(t!=null&&t.id))throw new Error("ID de cotización no válido");x.value=!0,i.success("Generando PDF...");const o=`/cotizaciones/${t.id}/pdf`,l=`cotizacion-${t.numero_cotizacion||t.id}.pdf`;console.log("URL del PDF:",o),console.log("Nombre del archivo:",l);try{if(!window.open(o,"_blank"))throw new Error("El navegador bloqueó la ventana emergente");i.success("PDF generado correctamente")}catch(C){console.warn("Error con window.open, intentando método alternativo:",C);const d=document.createElement("a");d.href=o,d.download=l,d.target="_blank",d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),i.success("PDF generado correctamente")},100)}}catch(o){console.error("Error al generar PDF:",o),i.error(`Error al generar el PDF: ${o.message}`),o.response&&(console.error("Error de respuesta:",o.response),i.error(`Error del servidor: ${o.response.status} - ${o.response.statusText}`))}finally{x.value=!1}},ve=()=>{g.value&&ue(g.value)},me=t=>{try{if(!t)throw new Error("ID de cotización no válido");D.value=t,j.value="confirm",y.value=!0}catch(o){i.error(o.message)}},pe=async()=>{try{if(!D.value)throw new Error("No se seleccionó ninguna cotización");x.value=!0,W.post(`/cotizaciones/${D.value}/cancel`,{},{onStart:()=>{i.success("Cancelando cotización...")},onSuccess:t=>{var l;i.success("Cotización cancelada exitosamente");const o=f.value.findIndex(C=>C.id===D.value);o!==-1&&(f.value[o]={...f.value[o],estado:"cancelado",eliminado_por:((l=t==null?void 0:t.data)==null?void 0:l.eliminado_por)||"Usuario actual",deleted_at:new Date().toISOString()}),T()},onError:t=>{console.error("Error al cancelar:",t),i.error("Error al cancelar la cotización")},onFinish:()=>{x.value=!1}})}catch(t){i.error(t.message),x.value=!1}};N(!1);const ae=async(t,{redirectTo:o="index"}={})=>{var l,C,d,u;try{const v=t!=null&&t.id?t:g.value;X(v);const E={...v,fecha:v.fecha||v.created_at||new Date().toISOString()};x.value=!0,i.success("Enviando cotización a pedido...");const{data:B}=await le.post(`/cotizaciones/${E.id}/enviar-pedido`,{forzarReenvio:!!(t!=null&&t.forzarReenvio)});if(!(B!=null&&B.success))throw new Error((B==null?void 0:B.error)||"No se pudo enviar a pedido");const U=f.value.findIndex(ye=>ye.id===E.id);U!==-1&&(f.value[U]={...f.value[U],estado:"enviado_pedido"}),T(),i.success(B.message||"Cotización enviada a pedido exitosamente"),W.visit(route?route("pedidos.index"):"/pedidos")}catch(v){console.error(v),i.error(((C=(l=v.response)==null?void 0:l.data)==null?void 0:C.error)||((u=(d=v.response)==null?void 0:d.data)==null?void 0:u.message)||v.message||"Error al enviar a pedido")}finally{x.value=!1}},ge=()=>{i.warning("Esta acción no está disponible desde Cotizaciones.")},fe=async t=>{var o;try{if(!((o=t.cliente)!=null&&o.email)){i.error("El cliente no tiene email configurado");return}console.log("=== ENVIANDO COTIZACIÓN POR EMAIL ==="),console.log("Cotización ID:",t.id),console.log("Cliente email:",t.cliente.email),g.value={...t,numero_cotizacion:t.numero_cotizacion||`C${String(t.id).padStart(3,"0")}`,email_destino:t.cliente.email},j.value="confirm-email",y.value=!0}catch(l){console.error("Error en enviarCotizacionPorEmail:",l),i.error("Error inesperado al preparar envío de cotización")}},he=async()=>{var t,o,l,C;try{const d=g.value;if(!(d!=null&&d.email_destino)){i.error("Email de destino no válido");return}console.log("✅ Usuario confirmó envío de cotización por email"),x.value=!0,T();const{data:u}=await le.post(`/cotizaciones/${d.id}/enviar-email`,{email_destino:d.email_destino});if(u!=null&&u.success){i.success(u.message||"Cotización enviada por email correctamente");const v=f.value.findIndex(E=>E.id===d.id);v!==-1&&u.cotizacion&&(f.value[v]={...f.value[v],email_enviado:u.cotizacion.email_enviado,email_enviado_fecha:u.cotizacion.email_enviado_fecha,estado:u.cotizacion.estado})}else throw new Error((u==null?void 0:u.error)||"Error desconocido al enviar email")}catch(d){console.error("Error al enviar cotización:",d);const u=((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.error)||((C=(l=d.response)==null?void 0:l.data)==null?void 0:C.message)||d.message;i.error("Error al enviar cotización: "+u)}finally{x.value=!1}},be=()=>{W.visit("/cotizaciones/create")};return(t,o)=>(b(),h(G,null,[L(ke(Ce),{title:"Cotizaciones"}),e("div",Dt,[e("div",Tt,[L(Qe,{total:c.value.total,aprobadas:c.value.aprobadas,pendientes:c.value.pendientes,borrador:c.value.borrador,enviado_pedido:c.value.enviado_pedido,cancelado:c.value.cancelado,"search-term":M.value,"onUpdate:searchTerm":o[0]||(o[0]=l=>M.value=l),"sort-by":I.value,"onUpdate:sortBy":o[1]||(o[1]=l=>I.value=l),"filtro-estado":n.value,"onUpdate:filtroEstado":o[2]||(o[2]=l=>n.value=l),onCrearNueva:be,onSearchChange:k,onFiltroEstadoChange:k,onSortChange:k,onLimpiarFiltros:_},null,8,["total","aprobadas","pendientes","borrador","enviado_pedido","cancelado","search-term","sort-by","filtro-estado"]),e("div",At,[L(Lt,{documentos:Q.value,"search-term":M.value,"sort-by":I.value,onVerDetalles:q,onEditar:re,onEliminar:me,onEnviarPedido:ae,onEnviarEmail:fe,onSort:k},null,8,["documentos","search-term","sort-by"]),L(Be,{"pagination-data":a.value,onPerPageChange:p,onPageChange:r},null,8,["pagination-data"])])]),L(ze,{show:y.value,mode:j.value,tipo:"cotizaciones",selected:g.value||{},auditoria:Y.value,onClose:T,onConfirmDelete:pe,onConfirmDuplicate:ce,onConfirmEmail:he,onImprimir:ve,onEditar:de,onEnviarPedido:ae,onEnviarAVenta:ge},null,8,["show","mode","selected","auditoria"]),x.value?(b(),h("div",Vt,o[3]||(o[3]=[e("div",{class:"bg-white p-6 rounded-lg shadow-lg"},[e("div",{class:"flex items-center space-x-3"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e("span",{class:"text-gray-700"},"Procesando...")])],-1)]))):F("",!0)])],64))}}),Gt=oe(Ot,[["__scopeId","data-v-5dda6c3f"]]);export{Gt as default};
