import{Q as R,p as Q,r as b,w as X,i,o as d,g as h,f as e,u as w,Z as H,l as f,k as m,n as k,t as a,e as N,A as z,q as J,v as x,z as C,x as E,F as A,m as S,N as q}from"./vendor-d19pJyVS.js";import{A as K}from"./AppLayout-CcnrZQKI.js";import{N as Z}from"./app-BcT2PLJy.js";import{_ as G}from"./BuscarCliente-t4xPlwkv.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const Y={class:"prestamos-edit min-h-screen bg-gray-50"},ee={class:"max-w-4xl mx-auto px-6 py-8"},te={class:"mb-8"},oe={class:"flex items-center justify-between"},se={class:"text-gray-600 mt-2"},ae={key:0,class:"text-orange-600 font-medium"},re={class:"flex items-center space-x-3"},ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},le={class:"lg:col-span-2"},ie={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},de={key:0,class:"mt-1 text-sm text-red-600"},ue={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ce={class:"grid grid-cols-2 gap-4 text-sm"},me={class:"font-semibold text-blue-900 ml-2"},pe={class:"font-semibold text-blue-900 ml-2"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={for:"monto_prestado",class:"block text-sm font-medium text-gray-700 mb-2"},be={key:0,class:"text-orange-600 text-xs"},ve={class:"relative"},xe=["disabled"],_e={key:0,class:"mt-1 text-sm text-red-600"},ye={for:"tasa_interes",class:"block text-sm font-medium text-gray-700 mb-2"},he={key:0,class:"text-orange-600 text-xs"},we={class:"relative"},ke=["disabled"],Ce={key:0,class:"mt-1 text-sm text-red-600"},Pe={for:"numero_pagos",class:"block text-sm font-medium text-gray-700 mb-2"},je={key:0,class:"text-orange-600 text-xs"},Ne=["disabled"],ze=["value"],Ae={key:0,class:"mt-1 text-sm text-red-600"},Ee={for:"frecuencia_pago",class:"block text-sm font-medium text-gray-700 mb-2"},Se={key:0,class:"text-orange-600 text-xs"},qe=["disabled"],Fe=["value"],$e={key:0,class:"mt-1 text-sm text-red-600"},Ve={class:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200"},Me=["disabled"],Te={key:0,class:"flex items-center"},Be={key:1},De={class:"lg:col-span-1"},Ie={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden sticky top-8"},Ue={class:"px-6 py-4 border-b border-gray-200"},Le={class:"text-lg font-semibold text-gray-900"},Oe={class:"text-sm text-gray-600 mt-1"},Re={class:"p-6"},Qe={key:0,class:"text-center py-8"},Xe={key:1},He={class:"space-y-4"},Je={class:"flex justify-between items-center py-3 border-b border-gray-100"},Ke={class:"text-sm font-medium text-gray-700"},Ze={class:"text-lg font-bold text-green-600"},Ge={class:"flex justify-between items-center py-3 border-b border-gray-100"},We={class:"text-lg font-semibold text-blue-600"},Ye={class:"flex justify-between items-center py-3 border-b-2 border-gray-200"},et={class:"text-xl font-bold text-gray-900"},tt={key:2,class:"space-y-4"},ot={class:"flex justify-between items-center py-3 border-b border-gray-100"},st={class:"text-sm font-medium text-gray-700"},at={class:"text-lg font-bold text-green-600"},rt={class:"flex justify-between items-center py-3 border-b border-gray-100"},nt={class:"text-lg font-semibold text-blue-600"},lt={class:"flex justify-between items-center py-3 border-b-2 border-gray-200"},it={class:"text-xl font-bold text-gray-900"},dt={class:"bg-gray-50 rounded-lg p-4 mt-4"},ut={class:"space-y-2 text-sm text-gray-600"},ct={class:"flex justify-between"},mt={class:"flex justify-between"},pt={class:"flex justify-between"},gt={class:"mt-3 pt-3 border-t border-gray-200"},ft={class:"space-y-1 text-xs text-gray-500"},bt={class:"flex justify-between"},vt={class:"flex justify-between"},xt=Object.assign({layout:K},{__name:"Edit",props:{prestamo:{type:Object,required:!0},clientes:{type:Array,default:()=>[]}},setup(l){const p=l,v=new Z({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),F=R();Q(()=>{const s=F.props.flash;if(s!=null&&s.success&&v.success(s.success),s!=null&&s.error&&v.error(s.error),p.prestamo.puede_ser_editado||v.error("Este pr√©stamo no puede ser editado porque ya tiene pagos registrados"),p.prestamo.cliente_id){const t=p.clientes.find(c=>c.id===p.prestamo.cliente_id);_.value=t||null}});const o=b({...p.prestamo}),P=b(!1),j=b(!1),u=b(p.puede_editar),_=b(null),$=s=>{_.value=s,o.value.cliente_id=s?s.id:null,s&&r.value.cliente_id&&delete r.value.cliente_id},V=s=>{q.visit("/clientes/create",{data:{nombre_razon_social:s}})},y=b({pago_periodico:p.prestamo.pago_periodico||0,interes_total:p.prestamo.monto_interes_total||0,total_pagar:p.prestamo.monto_total_pagar||0}),M=async()=>{var s;if(u.value){if(!o.value.monto_prestado||!o.value.numero_pagos||o.value.tasa_interes===void 0){y.value={pago_periodico:0,interes_total:0,total_pagar:0};return}j.value=!0;try{const t=await fetch("/prestamos/calcular-pagos",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content")},body:JSON.stringify({monto_prestado:o.value.monto_prestado,tasa_interes:o.value.tasa_interes,numero_pagos:o.value.numero_pagos,frecuencia_pago:o.value.frecuencia_pago})});if(t.ok){const c=await t.json();c.success&&(y.value=c.calculos)}}catch(t){console.error("Error calculando pagos:",t)}finally{j.value=!1}}};X([()=>o.value.monto_prestado,()=>o.value.tasa_interes,()=>o.value.numero_pagos],()=>{u.value&&M()});const r=b({}),T=b(null),B=()=>(r.value={},_.value||(r.value.cliente_id="Debe seleccionar un cliente"),(!o.value.monto_prestado||o.value.monto_prestado<=0)&&(r.value.monto_prestado="El monto debe ser mayor a cero"),(o.value.tasa_interes<0||o.value.tasa_interes>100)&&(r.value.tasa_interes="La tasa de inter√©s debe estar entre 0% y 100%"),(!o.value.numero_pagos||o.value.numero_pagos<1)&&(r.value.numero_pagos="El n√∫mero de pagos debe ser mayor a cero"),o.value.fecha_inicio||(r.value.fecha_inicio="La fecha de inicio es requerida"),Object.keys(r.value).length===0),D=()=>{if(!B()){v.error("Por favor corrija los errores del formulario");return}P.value=!0;const s={cliente_id:o.value.cliente_id,monto_prestado:o.value.monto_prestado,tasa_interes_mensual:o.value.tasa_interes_mensual,numero_pagos:o.value.numero_pagos,frecuencia_pago:o.value.frecuencia_pago,fecha_inicio:o.value.fecha_inicio,fecha_primer_pago:o.value.fecha_primer_pago,descripcion:o.value.descripcion,notas:o.value.notas};q.put(`/prestamos/${p.prestamo.id}`,s,{onStart:()=>{v.success("Actualizando pr√©stamo...")},onSuccess:()=>{v.success("Pr√©stamo actualizado correctamente");const t=clientes.find(c=>c.id===o.value.cliente_id);_.value=t||null},onError:t=>{console.error("Errores de validaci√≥n:",t),v.error("Error al actualizar el pr√©stamo")},onFinish:()=>{P.value=!1}})},g=s=>{const t=parseFloat(s),c=Number.isFinite(t)?t:0;return new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(c)},I=[{value:"semanal",label:"Semanal"},{value:"quincenal",label:"Quincenal"},{value:"mensual",label:"Mensual"}],U=Array.from({length:60},(s,t)=>({value:t+1,label:`${t+1} pago${t>0?"s":""}`})),L=s=>({activo:"Activo",completado:"Completado",cancelado:"Cancelado"})[s]||s,O=s=>({activo:"bg-green-100 text-green-800",completado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800";return(s,t)=>{var c;return d(),i(A,null,[h(w(H),{title:"Editar Pr√©stamo"}),e("div",Y,[e("div",ee,[e("div",te,[e("div",oe,[e("div",null,[t[8]||(t[8]=e("h1",{class:"text-3xl font-bold text-gray-900 tracking-tight"},"Editar Pr√©stamo",-1)),e("p",se,[t[7]||(t[7]=f(" Modifique la informaci√≥n del pr√©stamo ")),u.value?m("",!0):(d(),i("span",ae," (Algunos campos est√°n bloqueados porque ya tiene pagos registrados) "))])]),e("div",re,[e("span",{class:k(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",O(l.prestamo.estado)])},a(L(l.prestamo.estado)),3),h(w(z),{href:`/prestamos/${l.prestamo.id}`,class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},{default:N(()=>t[9]||(t[9]=[f(" üëÅ Ver Detalles ")])),_:1},8,["href"]),h(w(z),{href:"/prestamos",class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},{default:N(()=>t[10]||(t[10]=[f(" ‚Üê Volver a Pr√©stamos ")])),_:1})])])]),e("div",ne,[e("div",le,[e("div",ie,[t[25]||(t[25]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h2",{class:"text-lg font-semibold text-gray-900"},"Informaci√≥n del Pr√©stamo")],-1)),e("form",{onSubmit:J(D,["prevent"]),class:"p-6 space-y-6"},[e("div",null,[h(G,{ref_key:"buscarClienteRef",ref:T,clientes:l.clientes,"cliente-seleccionado":_.value,"label-busqueda":"Seleccionar Cliente","placeholder-busqueda":"Buscar cliente por nombre, RFC o email...",requerido:!0,"mostrar-opcion-nuevo-cliente":!0,"mostrar-estado-cliente":!0,"mostrar-info-comercial":!0,"titulo-cliente-seleccionado":"Cliente Seleccionado para Pr√©stamo","mensaje-vacio":"Selecciona un cliente para el pr√©stamo","submensaje-vacio":"Busca y selecciona un cliente existente o crea uno nuevo",onClienteSeleccionado:$,onCrearNuevoCliente:V},null,8,["clientes","cliente-seleccionado"]),r.value.cliente_id?(d(),i("p",de,a(r.value.cliente_id),1)):m("",!0)]),l.prestamo.pagos_realizados>0?(d(),i("div",ue,[t[13]||(t[13]=e("h3",{class:"text-sm font-medium text-blue-900 mb-2"},"Progreso del Pr√©stamo",-1)),e("div",ce,[e("div",null,[t[11]||(t[11]=e("span",{class:"text-blue-700"},"Pagos realizados:",-1)),e("span",me,a(l.prestamo.pagos_realizados)+" / "+a(l.prestamo.numero_pagos),1)]),e("div",null,[t[12]||(t[12]=e("span",{class:"text-blue-700"},"Monto pagado:",-1)),e("span",pe,"$"+a(g(l.prestamo.monto_pagado)),1)])])])):m("",!0),e("div",ge,[e("div",null,[e("label",fe,[t[14]||(t[14]=f(" Monto a Prestar * ")),u.value?m("",!0):(d(),i("span",be,"(Bloqueado)"))]),e("div",ve,[t[15]||(t[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"$")],-1)),x(e("input",{id:"monto_prestado","onUpdate:modelValue":t[0]||(t[0]=n=>o.value.monto_prestado=n),type:"number",step:"0.01",min:"0",placeholder:"0.00",disabled:!u.value,class:k(["block w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed",{"border-red-300":r.value.monto_prestado}])},null,10,xe),[[C,o.value.monto_prestado,void 0,{number:!0}]])]),r.value.monto_prestado?(d(),i("p",_e,a(r.value.monto_prestado),1)):m("",!0)]),e("div",null,[e("label",ye,[t[16]||(t[16]=f(" Tasa de Inter√©s (%) * ")),u.value?m("",!0):(d(),i("span",he,"(Bloqueado)"))]),e("div",we,[x(e("input",{id:"tasa_interes","onUpdate:modelValue":t[1]||(t[1]=n=>o.value.tasa_interes=n),type:"number",step:"0.01",min:"0",max:"100",placeholder:"0.00",disabled:!u.value,class:k(["block w-full pr-8 pl-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed",{"border-red-300":r.value.tasa_interes}])},null,10,ke),[[C,o.value.tasa_interes,void 0,{number:!0}]]),t[17]||(t[17]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 sm:text-sm"},"%")],-1))]),r.value.tasa_interes?(d(),i("p",Ce,a(r.value.tasa_interes),1)):m("",!0)]),e("div",null,[e("label",Pe,[t[18]||(t[18]=f(" N√∫mero de Pagos * ")),u.value?m("",!0):(d(),i("span",je,"(Bloqueado)"))]),x(e("select",{id:"numero_pagos","onUpdate:modelValue":t[2]||(t[2]=n=>o.value.numero_pagos=n),disabled:!u.value,class:k(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed",{"border-red-300":r.value.numero_pagos}])},[(d(!0),i(A,null,S(w(U),n=>(d(),i("option",{key:n.value,value:n.value},a(n.label),9,ze))),128))],10,Ne),[[E,o.value.numero_pagos]]),r.value.numero_pagos?(d(),i("p",Ae,a(r.value.numero_pagos),1)):m("",!0)]),e("div",null,[e("label",Ee,[t[19]||(t[19]=f(" Frecuencia de Pago * ")),u.value?m("",!0):(d(),i("span",Se,"(Bloqueado)"))]),x(e("select",{id:"frecuencia_pago","onUpdate:modelValue":t[3]||(t[3]=n=>o.value.frecuencia_pago=n),disabled:!u.value,class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500 disabled:bg-gray-100 disabled:cursor-not-allowed"},[(d(),i(A,null,S(I,n=>e("option",{key:n.value,value:n.value},a(n.label),9,Fe)),64))],8,qe),[[E,o.value.frecuencia_pago]])]),e("div",null,[t[20]||(t[20]=e("label",{for:"fecha_inicio",class:"block text-sm font-medium text-gray-700 mb-2"}," Fecha de Inicio * ",-1)),x(e("input",{id:"fecha_inicio","onUpdate:modelValue":t[4]||(t[4]=n=>o.value.fecha_inicio=n),type:"date",class:k(["block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",{"border-red-300":r.value.fecha_inicio}])},null,2),[[C,o.value.fecha_inicio]]),r.value.fecha_inicio?(d(),i("p",$e,a(r.value.fecha_inicio),1)):m("",!0)])]),e("div",null,[t[21]||(t[21]=e("label",{for:"descripcion",class:"block text-sm font-medium text-gray-700 mb-2"}," Descripci√≥n ",-1)),x(e("textarea",{id:"descripcion","onUpdate:modelValue":t[5]||(t[5]=n=>o.value.descripcion=n),rows:"3",placeholder:"Descripci√≥n del pr√©stamo (opcional)",class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"},null,512),[[C,o.value.descripcion]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"notas",class:"block text-sm font-medium text-gray-700 mb-2"}," Notas Adicionales ",-1)),x(e("textarea",{id:"notas","onUpdate:modelValue":t[6]||(t[6]=n=>o.value.notas=n),rows:"3",placeholder:"Notas adicionales (opcional)",class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"},null,512),[[C,o.value.notas]])]),e("div",Ve,[h(w(z),{href:`/prestamos/${l.prestamo.id}`,class:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},{default:N(()=>t[23]||(t[23]=[f(" ‚ùå Cancelar ")])),_:1},8,["href"]),e("button",{type:"submit",disabled:P.value,class:"px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},[P.value?(d(),i("span",Te,t[24]||(t[24]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),f(" Actualizando... ")]))):(d(),i("span",Be,"Actualizar Pr√©stamo"))],8,Me)])],32)])]),e("div",De,[e("div",Ie,[e("div",Ue,[e("h3",Le,a(u.value?"C√°lculo de Pagos":"Informaci√≥n Actual"),1),e("p",Oe,a(u.value?"Se actualiza autom√°ticamente":"Valores actuales del pr√©stamo"),1)]),e("div",Re,[u.value&&j.value?(d(),i("div",Qe,t[26]||(t[26]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"},null,-1),e("p",{class:"text-sm text-gray-600 mt-2"},"Calculando...",-1)]))):u.value&&o.value.monto_prestado>0&&o.value.numero_pagos>0?(d(),i("div",Xe,[e("div",He,[e("div",Je,[e("span",Ke,"Pago "+a(o.value.frecuencia_pago)+":",1),e("span",Ze," $"+a(g(y.value.pago_periodico)),1)]),e("div",Ge,[t[27]||(t[27]=e("span",{class:"text-sm font-medium text-gray-700"},"Inter√©s Total:",-1)),e("span",We," $"+a(g(y.value.interes_total)),1)]),e("div",Ye,[t[28]||(t[28]=e("span",{class:"text-sm font-medium text-gray-700"},"Total a Pagar:",-1)),e("span",et," $"+a(g(y.value.total_pagar)),1)])])])):(d(),i("div",tt,[e("div",ot,[e("span",st,"Pago "+a((c=l.prestamo.frecuencia_texto)==null?void 0:c.toLowerCase())+":",1),e("span",at," $"+a(g(l.prestamo.pago_periodico)),1)]),e("div",rt,[t[29]||(t[29]=e("span",{class:"text-sm font-medium text-gray-700"},"Inter√©s Total:",-1)),e("span",nt," $"+a(g(l.prestamo.monto_interes_total)),1)]),e("div",lt,[t[30]||(t[30]=e("span",{class:"text-sm font-medium text-gray-700"},"Total a Pagar:",-1)),e("span",it," $"+a(g(l.prestamo.monto_total_pagar)),1)]),e("div",dt,[t[38]||(t[38]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Estado del Pr√©stamo",-1)),e("div",ut,[e("div",ct,[t[31]||(t[31]=e("span",null,"Pagos realizados:",-1)),e("span",null,a(l.prestamo.pagos_realizados)+" / "+a(l.prestamo.numero_pagos),1)]),e("div",mt,[t[32]||(t[32]=e("span",null,"Monto pagado:",-1)),e("span",null,"$"+a(g(l.prestamo.monto_pagado)),1)]),e("div",pt,[t[33]||(t[33]=e("span",null,"Monto pendiente:",-1)),e("span",null,"$"+a(g(l.prestamo.monto_pendiente)),1)])]),e("div",gt,[t[37]||(t[37]=e("div",{class:"text-xs text-gray-500 mb-2"},[e("strong",null,"Configuraci√≥n original:")],-1)),e("div",ft,[e("div",bt,[t[34]||(t[34]=e("span",null,"Tasa anual:",-1)),e("span",null,a(l.prestamo.tasa_interes)+"%",1)]),e("div",vt,[t[35]||(t[35]=e("span",null,"Frecuencia:",-1)),e("span",null,a(l.prestamo.frecuencia_texto),1)]),t[36]||(t[36]=e("div",{class:"flex justify-between"},[e("span",null,"Tipo de c√°lculo:"),e("span",null,"Amortizaci√≥n francesa")],-1))])])])]))])])])])])])],64)}}}),Pt=W(xt,[["__scopeId","data-v-d01ee6c2"]]);export{Pt as default};
