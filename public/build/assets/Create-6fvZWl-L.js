import{Q as T,r as f,c as v,w as N,i as r,o as n,g as q,f as a,u as L,Z as O,k as m,l as u,q as U,s as V,v as b,x,F as _,m as k,t as s,z as F,N as w}from"./vendor-d19pJyVS.js";import{A as H}from"./AppLayout-CcnrZQKI.js";import{N as I}from"./app-BcT2PLJy.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const Q={class:"min-h-screen bg-gray-50"},R={class:"max-w-4xl mx-auto px-6 py-8"},Z={class:"bg-white rounded-xl shadow-sm border border-gray-200 p-8"},G=["value"],J=["value"],K={key:0,class:"mt-1 text-sm text-gray-600"},W=["value"],X={key:0,class:"mt-1 text-sm text-gray-600"},Y=["max"],$={key:0,class:"mt-1 text-sm text-gray-500"},ee={class:"flex justify-end gap-4 pt-6 border-t border-gray-200"},te=["disabled"],ae=["disabled"],oe={key:0,class:"animate-spin -ml-1 mr-3 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},le={key:1,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},re={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ne={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},ie={class:"mb-4"},se={key:0,class:"text-sm text-gray-600 mt-2"},de={class:"flex justify-end gap-3"},ue=Object.assign({layout:H},{__name:"Create",props:{productos:{type:Array,default:()=>[]},almacenes:{type:Array,default:()=>[]},inventarios:{type:Array,default:()=>[]}},setup(h){const y=new I({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]});T();const i=h,t=f({producto_id:"",almacen_origen_id:"",almacen_destino_id:"",cantidad:1}),c=f(!1),g=f(!1),d=f(null);v(()=>t.value.almacen_origen_id?i.productos.filter(l=>l.id==t.value.producto_id?!0:i.inventarios.some(e=>e.producto_id==l.id&&e.almacen_id==t.value.almacen_origen_id&&e.cantidad>0)):i.productos);const z=v(()=>t.value.producto_id?i.almacenes.filter(l=>i.inventarios.some(e=>e.producto_id==t.value.producto_id&&e.almacen_id==l.id&&e.cantidad>0)):i.almacenes),M=v(()=>i.almacenes.filter(l=>l.id!=t.value.almacen_origen_id)),p=v(()=>{if(!t.value.producto_id||!t.value.almacen_origen_id)return 0;const l=i.inventarios.find(e=>e.producto_id==t.value.producto_id&&e.almacen_id==t.value.almacen_origen_id);return l?l.cantidad:0}),S=v(()=>{if(!t.value.producto_id||!t.value.almacen_destino_id)return 0;const l=i.inventarios.find(e=>e.producto_id==t.value.producto_id&&e.almacen_id==t.value.almacen_destino_id);return l?l.cantidad:0}),A=v(()=>S.value+t.value.cantidad);N(()=>t.value.almacen_origen_id,()=>{if(t.value.almacen_origen_id&&t.value.producto_id&&p.value===0){const e=i.inventarios.filter(o=>o.producto_id==t.value.producto_id&&o.cantidad>0).sort((o,D)=>D.cantidad-o.cantidad);e.length>0&&(d.value=i.almacenes.find(o=>o.id==e[0].almacen_id)),g.value=!0,t.value.almacen_origen_id="";return}t.value.almacen_destino_id===t.value.almacen_origen_id&&(t.value.almacen_destino_id="")}),N(()=>t.value.almacen_destino_id,()=>{t.value.almacen_destino_id===t.value.almacen_origen_id&&(t.value.almacen_destino_id="")});const E=()=>{if(t.value.cantidad>p.value){y.error("La cantidad excede el stock disponible en el almacén origen");return}c.value=!0,w.post(route("traspasos.store"),t.value,{onSuccess:()=>{y.success("Traspaso realizado correctamente"),w.visit(route("traspasos.index"))},onError:l=>{console.error("Errores de validación:",l),y.error("Error al realizar el traspaso")},onFinish:()=>{c.value=!1}})},C=()=>{w.visit(route("traspasos.index"))},j=()=>{d.value&&(t.value.almacen_origen_id=d.value.id),g.value=!1,d.value=null},B=()=>{g.value=!1,d.value=null};return(l,e)=>(n(),r(_,null,[q(L(O),{title:"Nuevo Traspaso"}),a("div",Q,[a("div",R,[a("div",{class:"mb-8"},[a("div",{class:"flex items-center justify-between"},[e[5]||(e[5]=a("div",null,[a("h1",{class:"text-3xl font-bold text-gray-900"},"Nuevo Traspaso"),a("p",{class:"text-gray-600 mt-1"},"Transfiere productos entre almacenes")],-1)),a("button",{onClick:C,class:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"},e[4]||(e[4]=[a("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),u(" Cancelar ")]))])]),a("div",Z,[a("form",{onSubmit:U(E,["prevent"]),class:"space-y-6"},[a("div",null,[e[7]||(e[7]=a("label",{for:"producto_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Producto * ",-1)),b(a("select",{id:"producto_id","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.producto_id=o),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"},[e[6]||(e[6]=a("option",{value:""},"Seleccionar producto",-1)),(n(!0),r(_,null,k(h.productos,o=>(n(),r("option",{key:o.id,value:o.id},s(o.nombre),9,G))),128))],512),[[x,t.value.producto_id]])]),a("div",null,[e[10]||(e[10]=a("label",{for:"almacen_origen_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Almacén Origen * ",-1)),b(a("select",{id:"almacen_origen_id","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.almacen_origen_id=o),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"},[e[8]||(e[8]=a("option",{value:""},"Seleccionar almacén origen",-1)),(n(!0),r(_,null,k(z.value,o=>(n(),r("option",{key:o.id,value:o.id},s(o.nombre),9,J))),128))],512),[[x,t.value.almacen_origen_id]]),t.value.almacen_origen_id&&t.value.producto_id?(n(),r("p",K,[e[9]||(e[9]=u(" Stock actual en origen: ")),a("strong",null,s(p.value),1)])):m("",!0)]),a("div",null,[e[14]||(e[14]=a("label",{for:"almacen_destino_id",class:"block text-sm font-medium text-gray-700 mb-2"}," Almacén Destino * ",-1)),b(a("select",{id:"almacen_destino_id","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.almacen_destino_id=o),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"},[e[11]||(e[11]=a("option",{value:""},"Seleccionar almacén destino",-1)),(n(!0),r(_,null,k(M.value,o=>(n(),r("option",{key:o.id,value:o.id},s(o.nombre),9,W))),128))],512),[[x,t.value.almacen_destino_id]]),t.value.almacen_destino_id&&t.value.producto_id?(n(),r("div",X,[a("p",null,[e[12]||(e[12]=u("Stock actual en destino: ")),a("strong",null,s(S.value),1)]),a("p",null,[e[13]||(e[13]=u("Stock después del traspaso: ")),a("strong",null,s(A.value),1)])])):m("",!0)]),a("div",null,[e[16]||(e[16]=a("label",{for:"cantidad",class:"block text-sm font-medium text-gray-700 mb-2"}," Cantidad * ",-1)),b(a("input",{id:"cantidad","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.cantidad=o),type:"number",min:"1",max:p.value,required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"Cantidad a transferir"},null,8,Y),[[F,t.value.cantidad,void 0,{number:!0}]]),t.value.producto_id&&t.value.almacen_origen_id?(n(),r("p",$,[e[15]||(e[15]=u(" Stock disponible en origen: ")),a("strong",null,s(p.value),1)])):m("",!0)]),e[19]||(e[19]=V('<div class="bg-blue-50 border border-blue-200 rounded-lg p-4" data-v-7f5ee058><div class="flex" data-v-7f5ee058><div class="flex-shrink-0" data-v-7f5ee058><svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20" data-v-7f5ee058><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-7f5ee058></path></svg></div><div class="ml-3" data-v-7f5ee058><h3 class="text-sm font-medium text-blue-800" data-v-7f5ee058> Información importante </h3><div class="mt-2 text-sm text-blue-700" data-v-7f5ee058><ul class="list-disc pl-5 space-y-1" data-v-7f5ee058><li data-v-7f5ee058>Verifica que el producto tenga stock suficiente en el almacén origen</li><li data-v-7f5ee058>El almacén destino debe ser diferente al origen</li><li data-v-7f5ee058>Esta acción no se puede deshacer</li></ul></div></div></div></div>',1)),a("div",ee,[a("button",{type:"button",onClick:C,disabled:c.value,class:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 focus:ring-4 focus:ring-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"}," Cancelar ",8,te),a("button",{type:"submit",disabled:c.value||!t.value.producto_id||!t.value.almacen_origen_id||!t.value.almacen_destino_id||t.value.cantidad<1,class:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 focus:ring-4 focus:ring-blue-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"},[c.value?(n(),r("svg",oe,e[17]||(e[17]=[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(n(),r("svg",le,e[18]||(e[18]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"},null,-1)]))),u(" "+s(c.value?"Procesando...":"Realizar Traspaso"),1)],8,ae)])],32)])]),g.value?(n(),r("div",re,[a("div",ne,[e[23]||(e[23]=V('<div class="flex items-center mb-4" data-v-7f5ee058><div class="flex-shrink-0" data-v-7f5ee058><svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7f5ee058><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" data-v-7f5ee058></path></svg></div><h3 class="ml-3 text-lg font-medium text-gray-900" data-v-7f5ee058>Sin Stock Disponible</h3></div>',1)),a("div",ie,[e[22]||(e[22]=a("p",{class:"text-sm text-gray-600"}," El almacén seleccionado no tiene stock del producto elegido. ",-1)),d.value?(n(),r("p",se,[e[20]||(e[20]=u(" Sugerencia: El almacén ")),a("strong",null,s(d.value.nombre),1),e[21]||(e[21]=u(" tiene el mayor stock disponible. "))])):m("",!0)]),a("div",de,[a("button",{onClick:B,class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"}," Elegir Otro "),d.value?(n(),r("button",{key:0,onClick:j,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Usar Sugerido ")):m("",!0)])])])):m("",!0)])],64))}}),fe=P(ue,[["__scopeId","data-v-7f5ee058"]]);export{fe as default};
