import{r as c,T as te,c as ae,p as re,O as se,i as A,o as B,g as f,f as r,u as n,Z as ne,q as ie,l as k,v as _,z as F,x as N,s as le,F as L,m as ue,t as de,N as ce}from"./vendor-d19pJyVS.js";import{a as pe}from"./utils-Dq7h7Pqt.js";import{N as ve}from"./app-BcT2PLJy.js";import{A as fe}from"./AppLayout-CcnrZQKI.js";import{_ as me,a as ge,b as be}from"./BotonesAccion-DYwTTkJE.js";import{_ as _e}from"./BuscarCliente-t4xPlwkv.js";import{_ as ye,E as we}from"./EquiposSeleccionados-VVuQfIlX.js";import{_ as xe}from"./VistaPreviaModal-CAwANwka.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"ventas-create min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 p-6"},Se={class:"max-w-6xl mx-auto"},qe={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"},Ce={class:"p-6"},Fe={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"},Ne={class:"p-6"},Ee={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"},Pe={class:"p-6"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ve=["value"],De={class:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden"},Me={class:"p-6"},je=Object.assign({layout:fe},{__name:"Create",props:{clientes:Array,equipos:{type:Array,default:()=>[]}},setup(T){const E=new ve({duration:5e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10B981",icon:{className:"notyf__icon--success",tagName:"i",text:"✓"}},{type:"error",background:"#EF4444",icon:{className:"notyf__icon--error",tagName:"i",text:"✗"}},{type:"info",background:"#3B82F6",icon:{className:"notyf__icon--info",tagName:"i",text:"ℹ"}}]}),i=(o,e="success")=>{E.open({type:e,message:o})},x=T,S=c([...x.clientes]),t=te({cliente_id:"",subtotal:0,descuento_items:0,iva:0,total:0,equipos:[],fecha_inicio:new Date().toISOString().split("T")[0],duracion_meses:12,deposito_garantia:"",dia_pago:1,forma_pago:"transferencia",observaciones:""}),U=c(null),z=c(null),s=c([]),u=c({}),p=c({}),v=c({}),d=c(null),q=c(!1),h=c(!0),y=c(!1),O=(o,e)=>{try{localStorage.setItem(o,JSON.stringify(e))}catch(a){console.warn("No se pudo guardar en localStorage:",a)}},R=o=>{try{const e=localStorage.getItem(o);return e?JSON.parse(e):null}catch(e){return console.warn("No se pudo cargar desde localStorage:",e),null}},P=o=>{try{localStorage.removeItem(o)}catch(e){console.warn("No se pudo eliminar de localStorage:",e)}},H=()=>{d.value&&s.value.length>0?q.value=!0:i("Selecciona un cliente y al menos un equipo","error")},G=()=>{h.value=!1},$=o=>{var e;if(!o){d.value=null,t.cliente_id="",b(),i("Selección de cliente limpiada","info");return}((e=d.value)==null?void 0:e.id)!==o.id&&(d.value=o,t.cliente_id=o.id,b(),i(`Cliente seleccionado: ${o.nombre_razon_social}`))},Q=async o=>{try{const a=(await pe.post(route("clientes.store"),{nombre_razon_social:o})).data;S.value.some(l=>l.id===a.id)||S.value.push(a),$(a),i(`Cliente creado: ${a.nombre_razon_social}`)}catch(e){console.error("Error al crear cliente:",e),i("No se pudo crear el cliente","error")}},J=o=>{if(!o||typeof o.id>"u"){i("Equipo inválido","error");return}const e={id:o.id,tipo:"equipo"};if(!s.value.some(l=>l.id===o.id&&l.tipo==="equipo")){s.value.push(e);const l=`equipo-${o.id}`;u.value[l]=1;let w=typeof o.precio_renta_mensual=="number"?o.precio_renta_mensual:0;p.value[l]=w,v.value[l]=0,g(),b(),i(`Equipo añadido: ${o.nombre||o.descripcion||"Equipo"}`)}},Z=o=>{if(!o||typeof o.id>"u"||!o.tipo)return;const e=`${o.tipo}-${o.id}`;s.value=s.value.filter(a=>!(a.id===o.id&&a.tipo===a.tipo)),delete u.value[e],delete p.value[e],delete v.value[e],g(),b(),i(`Equipo eliminado: ${o.nombre||o.descripcion||"Equipo"}`,"info")},K=()=>{var o;d.value=null,t.cliente_id="",s.value=[],u.value={},p.value={},v.value={},t.fecha_inicio=new Date().toISOString().split("T")[0],t.duracion_meses=12,t.deposito_garantia="",t.dia_pago=1,t.forma_pago="transferencia",t.observaciones="",localStorage.removeItem(`renta_edit_${(o=x.renta)==null?void 0:o.id}`),E.success("Formulario limpiado correctamente")},W=(o,e)=>{const a=parseFloat(e);isNaN(a)||a<0||(u.value[o]=a,g(),b())},X=(o,e)=>{const a=parseFloat(e);isNaN(a)||a<0||a>100||(v.value[o]=a,g(),b())},m=ae(()=>{let o=0,e=0;s.value.forEach(D=>{const C=`${D.tipo}-${D.id}`,M=parseFloat(u.value[C])||0,j=parseFloat(p.value[C])||0,oe=parseFloat(v.value[C])||0;if(M>0&&j>=0){const I=M*j;e+=I*(oe/100),o+=I}});const a=Math.max(0,o-e),l=a*.16,w=a+l;return{subtotal:parseFloat(o.toFixed(2)),descuentoItems:parseFloat(e.toFixed(2)),subtotalConDescuentos:parseFloat(a.toFixed(2)),iva:parseFloat(l.toFixed(2)),total:parseFloat(w.toFixed(2))}}),g=()=>{t.subtotal=m.value.subtotal,t.descuento_items=m.value.descuentoItems,t.iva=m.value.iva,t.total=m.value.total},Y=()=>{if(!t.cliente_id)return i("Selecciona un cliente","error"),!1;if(s.value.length===0)return i("Agrega al menos un equipo","error"),!1;if(!t.fecha_inicio)return i("Selecciona una fecha de inicio","error"),!1;for(const o of s.value){const e=`${o.tipo}-${o.id}`,a=parseFloat(v.value[e])||0,l=parseFloat(u.value[e])||0,w=parseFloat(p.value[e])||0;if(a<0||a>100)return i("Los descuentos deben estar entre 0% y 100%.","error"),!1;if(l<=0)return i("Las cantidades deben ser mayores a 0","error"),!1;if(w<0)return i("Los precios no pueden ser negativos","error"),!1}return!0},ee=()=>{if(!Y())return;t.equipos=s.value.map(e=>{const a=`${e.tipo}-${e.id}`;return{equipo_id:e.id,precio_mensual:parseFloat(p.value[a])||0}}),g();const o={cliente_id:t.cliente_id,equipos:t.equipos,fecha_inicio:t.fecha_inicio,duracion_meses:t.duracion_meses,precio_mensual:t.subtotal,deposito_garantia:t.deposito_garantia||0,dia_pago:t.dia_pago,forma_pago:t.forma_pago,observaciones:t.observaciones,tiene_prorroga:!1};y.value=!0,ce.post(route("rentas.store"),o,{onSuccess:()=>{P("rentaEnProgreso"),s.value=[],u.value={},p.value={},v.value={},d.value=null,t.reset(),y.value=!1,i("Renta creada con éxito")},onError:e=>{console.error("Errores de validación:",e);const a=Object.values(e)[0];Array.isArray(a)?i(a[0],"error"):i("Hubo errores de validación","error"),y.value=!1}})},V=o=>{(t.cliente_id||s.value.length>0)&&(o.preventDefault(),o.returnValue="Tienes cambios sin guardar. ¿Estás seguro de que quieres salir?")},b=()=>{const o={cliente_id:t.cliente_id,cliente:d.value,selectedProducts:s.value,quantities:u.value,prices:p.value,discounts:v.value,fecha_inicio:t.fecha_inicio,duracion_meses:t.duracion_meses,deposito_garantia:t.deposito_garantia,dia_pago:t.dia_pago,forma_pago:t.forma_pago,observaciones:t.observaciones};O("rentaEnProgreso",o)};return re(()=>{const o=R("rentaEnProgreso");if(o&&typeof o=="object")try{t.cliente_id=o.cliente_id||"",d.value=o.cliente||null,s.value=Array.isArray(o.selectedProducts)?o.selectedProducts:[],u.value=o.quantities||{},p.value=o.prices||{},v.value=o.discounts||{},t.fecha_inicio=o.fecha_inicio||new Date().toISOString().split("T")[0],t.duracion_meses=o.duracion_meses||12,t.deposito_garantia=o.deposito_garantia||"",t.dia_pago=o.dia_pago||1,t.forma_pago=o.forma_pago||"transferencia",t.observaciones=o.observaciones||"",g()}catch(e){console.warn("Error al cargar datos guardados:",e),P("rentaEnProgreso")}window.addEventListener("beforeunload",V)}),se(()=>{window.removeEventListener("beforeunload",V)}),(o,e)=>(B(),A(L,null,[f(n(ne),{title:"Crear Renta"}),r("div",ke,[r("div",Se,[f(me,{title:"Nueva Renta",description:"Crea una nueva renta de equipos para tus clientes","can-preview":d.value&&s.value.length>0,"back-url":o.route("rentas.index"),"show-shortcuts":h.value,onPreview:H,onCloseShortcuts:G},null,8,["can-preview","back-url","show-shortcuts"]),r("form",{onSubmit:ie(ee,["prevent"]),class:"space-y-8"},[r("div",qe,[e[10]||(e[10]=r("div",{class:"bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4"},[r("h2",{class:"text-lg font-semibold text-white flex items-center"},[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})]),k(" Información del Cliente ")])],-1)),r("div",Ce,[f(_e,{ref_key:"buscarClienteRef",ref:U,clientes:S.value,"cliente-seleccionado":d.value,onClienteSeleccionado:$,onCrearNuevoCliente:Q},null,8,["clientes","cliente-seleccionado"])])]),r("div",Fe,[e[11]||(e[11]=r("div",{class:"bg-gradient-to-r from-green-500 to-green-600 px-6 py-4"},[r("h2",{class:"text-lg font-semibold text-white flex items-center"},[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})]),k(" Equipos para Rentar ")])],-1)),r("div",Ne,[f(ye,{ref_key:"buscarProductoRef",ref:z,equipos:x.equipos,onAgregarProducto:J},null,8,["equipos"]),f(we,{selectedProducts:s.value,equipos:x.equipos,quantities:u.value,prices:p.value,discounts:v.value,onEliminarProducto:Z,onUpdateQuantity:W,onUpdateDiscount:X},null,8,["selectedProducts","equipos","quantities","prices","discounts"])])]),r("div",Ee,[e[19]||(e[19]=r("div",{class:"bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4"},[r("h2",{class:"text-lg font-semibold text-white flex items-center"},[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),k(" Configuración del Contrato ")])],-1)),r("div",Pe,[r("div",$e,[r("div",null,[e[12]||(e[12]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Inicio",-1)),_(r("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>n(t).fecha_inicio=a),type:"date",class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[F,n(t).fecha_inicio]])]),r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Duración (meses)",-1)),_(r("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>n(t).duracion_meses=a),class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[13]||(e[13]=[le('<option value="6" data-v-fb2d2e6f>6 meses</option><option value="12" data-v-fb2d2e6f>12 meses</option><option value="18" data-v-fb2d2e6f>18 meses</option><option value="24" data-v-fb2d2e6f>24 meses</option><option value="36" data-v-fb2d2e6f>36 meses</option>',5)]),512),[[N,n(t).duracion_meses]])]),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Día de Pago",-1)),_(r("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>n(t).dia_pago=a),class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},[(B(),A(L,null,ue(28,a=>r("option",{key:a,value:a},"Día "+de(a),9,Ve)),64))],512),[[N,n(t).dia_pago]])]),r("div",null,[e[17]||(e[17]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Forma de Pago",-1)),_(r("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>n(t).forma_pago=a),class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},e[16]||(e[16]=[r("option",{value:"transferencia"},"Transferencia Bancaria",-1),r("option",{value:"efectivo"},"Efectivo",-1),r("option",{value:"tarjeta"},"Tarjeta de Crédito",-1),r("option",{value:"cheque"},"Cheque",-1)]),512),[[N,n(t).forma_pago]])]),r("div",null,[e[18]||(e[18]=r("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Depósito de Garantía",-1)),_(r("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>n(t).deposito_garantia=a),type:"number",step:"0.01",placeholder:"0.00",class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[F,n(t).deposito_garantia]])])])])]),r("div",De,[e[20]||(e[20]=r("div",{class:"bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4"},[r("h2",{class:"text-lg font-semibold text-white flex items-center"},[r("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),k(" Notas Adicionales ")])],-1)),r("div",Me,[_(r("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>n(t).observaciones=a),class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-vertical",rows:"4",placeholder:"Agrega notas adicionales, términos y condiciones, o información relevante para la renta..."},null,512),[[F,n(t).observaciones]])])]),f(ge,{"show-margin-calculator":!1,"margin-data":{costoTotal:0,precioVenta:0,ganancia:0,margenPorcentaje:0},totals:m.value,"item-count":s.value.length,"total-quantity":Object.values(u.value).reduce((a,l)=>a+(l||0),0),"deposito-garantia":n(t).deposito_garantia,"onUpdate:descuentoGeneral":e[6]||(e[6]=a=>n(t).descuento_general=a)},null,8,["totals","item-count","total-quantity","deposito-garantia"]),f(be,{"back-url":o.route("rentas.index"),"is-processing":y.value,"can-submit":n(t).cliente_id&&s.value.length>0,"button-text":y.value?"Guardando...":"Crear Renta",onLimpiar:K},null,8,["back-url","is-processing","can-submit","button-text"])],32),r("button",{onClick:e[7]||(e[7]=a=>h.value=!h.value),class:"fixed bottom-4 left-4 bg-gray-600 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 transition-colors duration-200",title:"Mostrar atajos de teclado"},e[21]||(e[21]=[r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)]))])]),f(xe,{show:q.value,type:"renta",cliente:d.value,items:s.value,totals:m.value,notas:n(t).observaciones,"deposito-garantia":n(t).deposito_garantia,onClose:e[8]||(e[8]=a=>q.value=!1),onPrint:e[9]||(e[9]=()=>o.window.print())},null,8,["show","cliente","items","totals","notas","deposito-garantia"])],64))}}),He=he(je,[["__scopeId","data-v-fb2d2e6f"]]);export{He as default};
