import{B as Ee,C as re,w as te,i,o as l,f as e,l as w,t as d,v as ae,z as ot,x as Te,s as $e,r as b,c as H,p as st,O as rt,g as V,b as Pe,u as R,Z as at,e as je,U as nt,k as c,n as T,F as z,m as ee,q as Me,P as lt,I as it,J as dt,M as ut,N as L}from"./vendor-d19pJyVS.js";import{a as ct}from"./utils-Dq7h7Pqt.js";import{N as pt,F as Y}from"./app-BcT2PLJy.js";import"./jspdf.es.min-BE3S9W4e.js";import{A as vt}from"./AppLayout-CcnrZQKI.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const mt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},gt={class:"bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-6 border-b border-gray-200/60"},ft={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},xt={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},yt={class:"flex items-center justify-between"},bt={class:"text-2xl font-bold text-gray-900"},ht={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},_t={class:"flex items-center justify-between"},wt={class:"text-2xl font-bold text-yellow-600"},kt={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Ct={class:"flex items-center justify-between"},Et={class:"text-2xl font-bold text-blue-600"},Tt={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},$t={class:"flex items-center justify-between"},Pt={class:"text-2xl font-bold text-green-600"},jt={class:"bg-white/70 rounded-lg p-4 border border-gray-200/50"},Mt={class:"flex items-center justify-between"},Ot={class:"text-2xl font-bold text-red-600"},It={class:"px-6 py-4 bg-gray-50/50 border-b border-gray-200/60"},Nt={class:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"},Ft={class:"flex-1 max-w-md"},Dt={class:"relative"},Lt={class:"flex items-center space-x-3"},Bt={__name:"OrdenesCompraHeader",props:Ee({total:{type:Number,default:0},pendientes:{type:Number,default:0},enviadas_a_proveedor:{type:Number,default:0},procesadas:{type:Number,default:0},canceladas:{type:Number,default:0}},{searchTerm:{type:String,default:""},searchTermModifiers:{},sortBy:{type:String,default:"created_at-desc"},sortByModifiers:{},filtroEstado:{type:String,default:""},filtroEstadoModifiers:{}}),emits:Ee(["crear-nueva","search-change","filtro-estado-change","sort-change","limpiar-filtros"],["update:searchTerm","update:sortBy","update:filtroEstado"]),setup(O,{emit:p}){const x=p,k=re(O,"searchTerm"),a=re(O,"sortBy"),$=re(O,"filtroEstado"),B=()=>x("crear-nueva"),P=()=>x("search-change",k.value),C=()=>x("filtro-estado-change",$.value),m=()=>x("sort-change",a.value),E=()=>x("limpiar-filtros");return te([k,a,$],()=>{},{immediate:!0}),(j,u)=>(l(),i("div",mt,[e("div",gt,[e("div",{class:"flex items-center justify-between mb-6"},[u[4]||(u[4]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 tracking-tight"},"Órdenes de Compra"),e("p",{class:"text-sm text-gray-600 mt-1"},"Gestiona todas tus órdenes de compra en un solo lugar")],-1)),e("button",{onClick:B,class:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200"},u[3]||(u[3]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),w(" Nueva Orden de Compra ")]))]),e("div",ft,[e("div",xt,[e("div",yt,[e("div",null,[u[5]||(u[5]=e("p",{class:"text-sm font-medium text-gray-600"},"Total",-1)),e("p",bt,d(O.total),1)]),u[6]||(u[6]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))])]),e("div",ht,[e("div",_t,[e("div",null,[u[7]||(u[7]=e("p",{class:"text-sm font-medium text-gray-600"},"Pendientes",-1)),e("p",wt,d(O.pendientes),1)]),u[8]||(u[8]=e("div",{class:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",kt,[e("div",Ct,[e("div",null,[u[9]||(u[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Enviadas a Proveedor",-1)),e("p",Et,d(O.enviadas_a_proveedor),1)]),u[10]||(u[10]=e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})])],-1))])]),e("div",Tt,[e("div",$t,[e("div",null,[u[11]||(u[11]=e("p",{class:"text-sm font-medium text-gray-600"},"Procesadas",-1)),e("p",Pt,d(O.procesadas),1)]),u[12]||(u[12]=e("div",{class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),e("div",jt,[e("div",Mt,[e("div",null,[u[13]||(u[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Canceladas",-1)),e("p",Ot,d(O.canceladas),1)]),u[14]||(u[14]=e("div",{class:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1))])])])]),e("div",It,[e("div",Nt,[e("div",Ft,[e("div",Dt,[u[15]||(u[15]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),ae(e("input",{"onUpdate:modelValue":u[0]||(u[0]=S=>k.value=S),type:"text",placeholder:"Buscar por proveedor, número de orden...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm",onInput:P},null,544),[[ot,k.value]])])]),e("div",Lt,[ae(e("select",{"onUpdate:modelValue":u[1]||(u[1]=S=>$.value=S),onChange:C,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},u[16]||(u[16]=[$e('<option value="" data-v-2377568d>Todos los Estados</option><option value="pendiente" data-v-2377568d>Pendientes</option><option value="enviado_a_proveedor" data-v-2377568d>Enviadas a Proveedor</option><option value="procesada" data-v-2377568d>Procesadas</option><option value="cancelada" data-v-2377568d>Canceladas</option>',5)]),544),[[Te,$.value]]),ae(e("select",{"onUpdate:modelValue":u[2]||(u[2]=S=>a.value=S),onChange:m,class:"block w-48 pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white"},u[17]||(u[17]=[$e('<option value="created_at-desc" data-v-2377568d>Fecha (Más reciente)</option><option value="created_at-asc" data-v-2377568d>Fecha (Más antiguo)</option><option value="total-desc" data-v-2377568d>Monto (Mayor)</option><option value="total-asc" data-v-2377568d>Monto (Menor)</option><option value="proveedor-asc" data-v-2377568d>Proveedor (A-Z)</option><option value="proveedor-desc" data-v-2377568d>Proveedor (Z-A)</option>',6)]),544),[[Te,a.value]]),e("button",{onClick:E,class:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"},u[18]||(u[18]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),w(" Limpiar ")]))])])])]))}},St=Oe(Bt,[["__scopeId","data-v-2377568d"]]),At={class:"ordenes-compra-index min-h-screen bg-gray-50"},zt={class:"max-w-8xl mx-auto px-6 py-8"},Vt={class:"flex justify-between items-center mb-4 text-sm text-gray-600"},Ht={class:"flex items-center space-x-2"},Wt=["value"],Rt={class:"mt-6"},Gt={class:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"},qt={class:"bg-gradient-to-r from-gray-50 to-gray-100/50 px-6 py-4 border-b border-gray-200/60"},Ut={class:"flex items-center justify-between"},Kt={class:"text-sm text-gray-600 bg-white/70 px-3 py-1 rounded-full border border-gray-200/50"},Xt={class:"overflow-x-auto"},Yt={class:"min-w-full divide-y divide-gray-200/60"},Zt={class:"bg-gray-50/60"},Jt={class:"flex items-center space-x-1"},Qt={class:"flex items-center space-x-1"},eo={class:"flex items-center space-x-1"},to={class:"flex items-center space-x-1"},oo={class:"flex items-center space-x-1"},so={class:"bg-white divide-y divide-gray-200/40"},ro={class:"px-6 py-4"},ao={class:"flex flex-col space-y-0.5"},no={class:"text-sm font-medium text-gray-900"},lo={class:"text-xs text-gray-500"},io={class:"px-6 py-4"},uo={class:"flex flex-col space-y-0.5"},co={class:"text-sm font-medium text-gray-900 group-hover:text-gray-800"},po={key:0,class:"text-xs text-gray-500 truncate max-w-48"},vo={class:"px-6 py-4"},mo={class:"text-sm font-mono font-medium text-gray-700 bg-gray-100/60 px-2 py-1 rounded-md inline-block"},go={class:"px-6 py-4"},fo={class:"text-sm font-semibold text-gray-900"},xo=["onMouseenter","onMousemove"],yo={class:"font-medium"},bo={class:"px-6 py-4"},ho={class:"px-6 py-4"},_o={class:"flex items-center justify-end space-x-2"},wo=["onClick"],ko=["onClick"],Co=["onClick","title"],Eo=["onClick"],To=["onClick"],$o={key:1},Po={key:0,class:"flex justify-center items-center space-x-2 mt-6"},jo=["disabled"],Mo={class:"flex space-x-1"},Oo=["onClick"],Io=["disabled"],No=["onKeydown"],Fo={key:0,class:"text-center"},Do={key:1,class:"space-y-4"},Lo={class:"text-lg font-medium mb-1 flex items-center gap-2"},Bo={key:0,class:"text-sm text-gray-500"},So={key:0,class:"mt-2 p-4 bg-gray-50 rounded-lg border border-gray-200"},Ao={class:"grid md:grid-cols-3 gap-3 text-sm"},zo={class:"font-medium text-gray-900"},Vo={class:"text-gray-500"},Ho={class:"font-medium text-gray-900"},Wo={class:"text-gray-500"},Ro={key:0},Go={class:"font-medium text-gray-900"},qo={class:"text-gray-500"},Uo={key:1,class:"space-y-4"},Ko={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Xo={class:"text-sm text-gray-600"},Yo={key:0,class:"text-sm text-gray-600"},Zo={key:1,class:"text-sm text-gray-600"},Jo={class:"text-sm text-gray-600"},Qo={class:"text-sm text-gray-600"},es={key:0,class:"text-sm text-gray-600"},ts={key:1,class:"text-sm text-gray-600"},os={class:"text-sm text-gray-600"},ss={key:0,class:"mt-4"},rs={class:"overflow-x-auto"},as={class:"min-w-full divide-y divide-gray-200"},ns={class:"bg-white divide-y divide-gray-200"},ls={class:"px-4 py-2 text-sm text-gray-900"},is={class:"px-4 py-2 text-sm text-gray-600"},ds={class:"px-4 py-2 text-sm text-gray-600"},us={class:"px-4 py-2 text-sm text-gray-600"},cs={key:1,class:"text-sm text-gray-600"},ps={key:2,class:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200"},vs={class:"space-y-2 text-sm"},ms={class:"flex justify-between"},gs={class:"font-medium"},fs={key:0,class:"flex justify-between"},xs={class:"font-medium text-red-600"},ys={key:1,class:"flex justify-between"},bs={class:"font-medium text-red-600"},hs={class:"flex justify-between"},_s={class:"font-medium"},ws={class:"flex justify-between border-t border-gray-300 pt-2"},ks={class:"text-gray-900 font-bold"},Cs={key:2,class:"text-sm text-gray-600"},Es={class:"flex flex-wrap justify-end gap-2 mt-6"},Ts={class:"p-4 border-b border-gray-100"},$s={class:"flex items-center justify-between"},Ps={class:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full font-medium"},js={class:"max-h-72 overflow-y-auto px-4 pb-4 custom-scrollbar"},Ms={key:0,class:"space-y-2 pt-2"},Os={class:"flex items-start justify-between"},Is={class:"flex-1 min-w-0 mr-3"},Ns={class:"text-sm font-medium text-gray-900 truncate group-hover:text-gray-800"},Fs={class:"flex items-center mt-1.5 space-x-2 text-xs"},Ds={class:"text-gray-600 bg-white/60 px-2 py-0.5 rounded-md"},Ls={class:"text-gray-600"},Bs={key:0,class:"text-xs text-gray-500 mt-1.5 line-clamp-2"},Ss={class:"text-right flex-shrink-0"},As={class:"text-sm font-semibold text-gray-900"},zs={key:1,class:"text-center py-8"},Vs={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Hs=Object.assign({layout:vt},{__name:"Index",props:{ordenesCompra:{type:Object,default:()=>({data:[]})},pagination:{type:Object,default:()=>({})},stats:{type:Object,default:()=>({})}},setup(O){var be;const p=O,x=new pt({duration:4e3,position:{x:"right",y:"top"},types:[{type:"success",background:"#10b981",icon:!1},{type:"error",background:"#ef4444",icon:!1},{type:"warning",background:"#f59e0b",icon:!1}]}),k=b(!1),a=b(null),$=b("details"),B=b(null),P=b(!1);b(null),b(!1);const C=b(""),m=b("fecha-desc"),E=b(""),j=b([...((be=p.ordenesCompra)==null?void 0:be.data)||[]]),u=H(()=>{const o=a.value;if(!o)return null;const t=o.metadata||{};return{creado_por:o.creado_por_nombre||o.created_by_user_name||t.creado_por||"N/A",actualizado_por:o.actualizado_por_nombre||o.updated_by_user_name||t.actualizado_por||"N/A",eliminado_por:o.eliminado_por_nombre||o.deleted_by_user_name||t.eliminado_por||null,creado_en:o.created_at||t.creado_en||null,actualizado_en:o.updated_at||t.actualizado_en||null,eliminado_en:o.deleted_at||t.eliminado_en||null}}),S=H(()=>{const o=[],t=p.pagination.last_page||1,r=p.pagination.current_page||1;if(t<=7)for(let n=1;n<=t;n++)o.push(n);else if(r<=3)for(let n=1;n<=5;n++)o.push(n);else if(r>=t-2)for(let n=t-4;n<=t;n++)o.push(n);else for(let n=r-2;n<=r+2;n++)o.push(n);return o}),G=o=>{const t={page:o,search:C.value,estado:E.value,sort_by:m.value.split("-")[0],sort_direction:m.value.split("-")[1]||"desc"};L.visit("/ordenescompra",{data:t})},Ie=()=>{p.pagination.current_page<p.pagination.last_page&&G(p.pagination.current_page+1)},Ne=()=>{p.pagination.current_page>1&&G(p.pagination.current_page-1)};te(()=>p.ordenesCompra,o=>{o&&o.data&&Array.isArray(o.data)&&(j.value=[...o.data])},{deep:!0,immediate:!0}),te(()=>p.stats,o=>{o&&(console.log("🔄 Estadísticas actualizadas:",o),console.log("📊 Total:",o.total),console.log("⏳ Pendientes:",o.pendientes),console.log("✈️ Enviadas:",o.enviadas_a_proveedor),console.log("✅ Procesadas:",o.procesadas),console.log("❌ Canceladas:",o.canceladas))},{deep:!0,immediate:!0});const I=H(()=>{const o=p.stats||{};return console.log("📊 Estadísticas recibidas del backend:",o),console.log("📈 Procesadas recibidas del backend:",o.procesadas),{total:o.total||0,pendientes:o.pendientes||0,enviadas_a_proveedor:o.enviadas_a_proveedor||0,procesadas:o.procesadas||0,canceladas:o.canceladas||0}}),Fe=()=>{C.value="",m.value="fecha-desc",E.value="",L.visit("/ordenescompra"),x.success("Filtros limpiados correctamente")},ne=o=>{if(o&&typeof o=="string"){m.value=o;const t={sort_by:o.split("-")[0],sort_direction:o.split("-")[1]||"desc",search:C.value,estado:E.value};L.visit("/ordenescompra",{data:t})}},De=o=>{const r={per_page:o.target.value,search:C.value,estado:E.value,sort_by:m.value.split("-")[0],sort_direction:m.value.split("-")[1]||"desc"};L.visit("/ordenescompra",{data:r})},Le=()=>{const o={search:C.value,estado:E.value,sort_by:m.value.split("-")[0],sort_direction:m.value.split("-")[1]||"desc"};L.visit("/ordenescompra",{data:o})},Be=()=>{const o={search:C.value,estado:E.value,sort_by:m.value.split("-")[0],sort_direction:m.value.split("-")[1]||"desc"};L.visit("/ordenescompra",{data:o})};function Se(o){if(!(o!=null&&o.id))throw new Error("ID de orden no válido");return!0}function le(o){var r;if(!(o!=null&&o.id))throw new Error("ID de orden no válido");if(!((r=o.proveedor)!=null&&r.nombre_razon_social))throw new Error("Datos del proveedor no encontrados");const t=o.productos||o.items||[];if(!Array.isArray(t)||!t.length)throw new Error("Lista de productos no válida");if(!o.fecha_orden&&!o.created_at)throw new Error("Fecha no especificada");return!0}const Ae=(o,t)=>{var n;const r=j.value.findIndex(s=>s.id===o);r!==-1&&(j.value[r]={...j.value[r],estado:t}),((n=a.value)==null?void 0:n.id)===o&&(a.value={...a.value,estado:t})},ze=o=>{try{Se(o),a.value=o,$.value="details",k.value=!0}catch(t){x.error(t.message)}},ie=o=>{var t;try{const r=o||((t=a.value)==null?void 0:t.id);if(!r)throw new Error("ID de orden no válido");L.visit(`/ordenescompra/${r}/edit`)}catch(r){x.error(r.message)}},Ve=o=>{ie(o)},de=o=>{try{if(!o)throw new Error("ID de orden no válido");B.value=o,$.value="confirm",k.value=!0}catch(t){x.error(t.message)}},He=async()=>{try{if(!B.value)throw new Error("No se seleccionó ninguna orden");P.value=!0,L.post(`/ordenescompra/${B.value}/cancel`,{},{onStart:()=>{x.success("Cancelando orden...")},onSuccess:o=>{var r;x.success("Orden cancelada exitosamente");const t=j.value.findIndex(n=>n.id===B.value);t!==-1&&(j.value[t]={...j.value[t],estado:"cancelada",eliminado_por:((r=o==null?void 0:o.data)==null?void 0:r.eliminado_por)||"Usuario actual",deleted_at:new Date().toISOString()}),k.value=!1,B.value=null},onError:o=>{console.error("Error al cancelar:",o),x.error("Error al cancelar la orden")},onFinish:()=>{P.value=!1}})}catch(o){x.error(o.message),P.value=!1}},ue=o=>{try{const t=o!=null&&o.id?o:a.value;le(t),P.value=!0,L.post(`/ordenescompra/${t.id}/enviar-compra`,{},{preserveScroll:!0,onSuccess:r=>{var v;const n=((v=r==null?void 0:r.props)==null?void 0:v.flash)||{};if(n.error){x.error(n.error);return}const s=n.success||"Orden enviada al proveedor";x.success(s),Ae(t.id,"enviado_a_proveedor"),k.value=!1},onError:r=>{const n=Object.values(r||{})[0];x.error(n||"Error al enviar la orden a compra")},onFinish:()=>{P.value=!1}})}catch(t){console.error(t),x.error(t.message||"Error al enviar la orden a compra"),P.value=!1}};b(!1);const ce=async o=>{var t,r,n,s,v,g,h;try{const f=o!=null&&o.id?o:a.value;if(le(f),console.log("🔍 Debug enviarEmailOrden:",{doc_id:f.id,proveedor:f.proveedor,email:(t=f.proveedor)==null?void 0:t.email,estado:f.estado}),!((r=f.proveedor)!=null&&r.email)){x.error("El proveedor no tiene email configurado");return}P.value=!0,x.success(`Enviando orden #${f.numero_orden||f.id} por email...`);const{data:y}=await ct.post(`/ordenescompra/${f.id}/enviar-email`,{},{headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(!(y!=null&&y.success))throw new Error((y==null?void 0:y.error)||"No se pudo enviar el email");const _=j.value.findIndex(F=>F.id===f.id);_!==-1&&(j.value[_]={...j.value[_],email_enviado:!0,email_enviado_fecha:new Date().toISOString()}),((n=a.value)==null?void 0:n.id)===f.id&&(a.value={...a.value,email_enviado:!0,email_enviado_fecha:new Date().toISOString()}),x.success(y.message||"Orden enviada por email exitosamente")}catch(f){console.error(f);const y=((v=(s=f.response)==null?void 0:s.data)==null?void 0:v.error)||((h=(g=f.response)==null?void 0:g.data)==null?void 0:h.message)||f.message||"Error al enviar email";x.error(y)}finally{P.value=!1}},We=()=>{L.visit("/ordenescompra/create")};H(()=>!!C.value||!!E.value);const Re=()=>{C.value="",m.value="fecha-desc",E.value="",Fe()};H(()=>{const o=I.value.total||1,t=I.value.procesadas||0;return console.log("🔢 Cálculo de porcentajes:",{total:o,procesadasValue:t,porcentaje:Math.round(t/o*100)}),{pendientes:{label:"Pendientes",icon:"clock",color:"yellow",description:"Órdenes pendientes",porcentaje:Math.round((I.value.pendientes||0)/o*100)},enviadas_a_proveedor:{label:"Enviadas a Proveedor",icon:"paper-plane",color:"blue",description:"Órdenes enviadas a proveedor",porcentaje:Math.round((I.value.enviadas_a_proveedor||0)/o*100)},procesadas:{label:"Procesadas",icon:"check-circle",color:"green",description:"Órdenes procesadas",porcentaje:Math.round(t/o*100)},canceladas:{label:"Canceladas",icon:"x-circle",color:"red",description:"Órdenes canceladas",porcentaje:Math.round((I.value.canceladas||0)/o*100)}}});const q=b(!1),W=b(null),Z=b({x:0,y:0});let U=null;const N=o=>{if(!o)return[];const t=o.productos||o.items||[];return Array.isArray(t)?t.length?t.filter(r=>r&&(r.nombre||r.descripcion)&&(r.cantidad>0||r.cantidad!==null)):[]:[]},Ge=(o,t)=>{var r;(r=N(o))!=null&&r.length&&(clearTimeout(U),W.value=o,ve(t),U=setTimeout(()=>{q.value=!0},500))},pe=()=>{clearTimeout(U),U=setTimeout(()=>{q.value=!1,W.value=null},300)},qe=()=>{clearTimeout(U)},ve=o=>{Z.value={x:o.clientX,y:o.clientY}},Ue=H(()=>{const{w:s,h:v}=Ke();let g=Z.value.x+20,h=Z.value.y-384/2;return g+320>s-16&&(g=Z.value.x-320-20),g<16&&(g=16),h<16?h=16:h+384>v-16&&(h=v-384-16),{left:`${g}px`,top:`${h}px`,transform:q.value?"scale(1) translateY(0)":"scale(0.95) translateY(-10px)",opacity:q.value?"1":"0"}}),Ke=()=>typeof window>"u"?{w:1280,h:800}:{w:window.innerWidth,h:window.innerHeight},A=new Map,K=o=>{if(!o)return"Fecha no disponible";const t=`fecha-${o}`;if(A.has(t))return A.get(t);try{const r=new Date(o).getTime();if(Number.isNaN(r))return"Fecha inválida";const n=new Date(r).toLocaleDateString("es-MX",{day:"2-digit",month:"2-digit",year:"numeric"});return A.set(t,n),n}catch{return"Fecha inválida"}},Xe=o=>{if(!o)return"";const t=`hora-${o}`;if(A.has(t))return A.get(t);try{const r=new Date(o).getTime();if(Number.isNaN(r))return"";const n=new Date(r).toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"});return A.set(t,n),n}catch{return""}},M=o=>{const t=parseFloat(o),r=Number.isFinite(t)?t:0,n=`moneda-${r}`;if(A.has(n))return A.get(n);const s=new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(r);return A.set(n,s),s},oe={borrador:{label:"Borrador",classes:"bg-gray-100 text-gray-700",color:"bg-gray-400"},pendiente:{label:"Pendiente",classes:"bg-yellow-100 text-yellow-700",color:"bg-yellow-400"},enviado_a_proveedor:{label:"Enviado a Proveedor",classes:"bg-blue-100 text-blue-700",color:"bg-blue-400"},convertida:{label:"Procesada",classes:"bg-green-100 text-green-700",color:"bg-green-400"},cancelada:{label:"Cancelada",classes:"bg-red-100 text-red-700",color:"bg-red-400"}},me=o=>{var t;return((t=oe[o])==null?void 0:t.classes)||"bg-gray-100 text-gray-700"},ge=o=>{var t;return((t=oe[o])==null?void 0:t.color)||"bg-gray-400"},J=o=>{var t;return((t=oe[o])==null?void 0:t.label)||"Pendiente"},Ye={searchFields:["proveedor.nombre_razon_social","items.nombre","numero_orden","id"]},se=H(()=>{if(!Array.isArray(p.ordenesCompra.data))return console.warn("⚠️ Órdenes de compra no es un array:",p.ordenesCompra.data),[];let o=p.ordenesCompra.data.slice();if(C.value){const t=C.value.toLowerCase().trim();o=o.filter(r=>Ye.searchFields.some(n=>(n.split(".").reduce((v,g)=>v==null?void 0:v[g],r)||"").toString().toLowerCase().includes(t)))}if(E.value&&(o=o.filter(t=>t.estado===E.value)),m.value){const[t,r]=m.value.split("-");o.sort((n,s)=>{var f,y;let v,g;switch(t){case"fecha":v=new Date(n.created_at||n.fecha).getTime()||0,g=new Date(s.created_at||s.fecha).getTime()||0;break;case"proveedor":v=(((f=n.proveedor)==null?void 0:f.nombre_razon_social)||"").toLowerCase(),g=(((y=s.proveedor)==null?void 0:y.nombre_razon_social)||"").toLowerCase();break;case"numero_orden":v=(n.numero_orden||n.id||"").toString().toLowerCase(),g=(s.numero_orden||s.id||"").toString().toLowerCase();break;case"total":v=parseFloat(n.total)||0,g=parseFloat(s.total)||0;break;case"estado":v=J(n.estado).toLowerCase(),g=J(s.estado).toLowerCase();break;default:v=(n[t]||"").toString().toLowerCase(),g=(s[t]||"").toString().toLowerCase()}const h=v<g?-1:v>g?1:0;return r==="desc"?-h:h})}return o}),X=o=>{const r=(m.value.startsWith(o)?m.value:`${o}-desc`)===`${o}-desc`?`${o}-asc`:`${o}-desc`;ne(r)},fe=b(null);b(!1),b(!1);const Ze=()=>{var o;try{(o=fe.value)==null||o.focus()}catch{}};te(()=>k,o=>{o&&setTimeout(Ze,0)});const xe=o=>{o.key==="Escape"&&k.value&&Q()};st(()=>window.addEventListener("keydown",xe)),rt(()=>window.removeEventListener("keydown",xe));const Je=()=>{k.value=!1,a.value=null,B.value=null},Qe=()=>{He()},Q=()=>{k.value=!1,a.value=null,B.value=null},et=o=>Number.isFinite(parseFloat(o)),ye=o=>{if(!o)return 0;const t=parseFloat(o.precio??o.precio_venta??o.pv??0);return Number.isFinite(t)?t:0};return(o,t)=>{var r,n;return l(),i(z,null,[V(R(at),{title:"Órdenes de Compra"}),(l(),Pe(nt("style"),null,{default:je(()=>t[13]||(t[13]=[w(" @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css'); ")])),_:1})),e("div",At,[e("div",zt,[V(St,{total:I.value.total,pendientes:I.value.pendientes,enviadas_a_proveedor:I.value.enviadas_a_proveedor,procesadas:I.value.procesadas,canceladas:I.value.canceladas,"search-term":C.value,"onUpdate:searchTerm":t[0]||(t[0]=s=>C.value=s),"sort-by":m.value,"onUpdate:sortBy":t[1]||(t[1]=s=>m.value=s),"filtro-estado":E.value,"onUpdate:filtroEstado":t[2]||(t[2]=s=>E.value=s),onCrearNueva:We,onSearchChange:Le,onFiltroEstadoChange:Be,onSortChange:ne,onLimpiarFiltros:Re},null,8,["total","pendientes","enviadas_a_proveedor","procesadas","canceladas","search-term","sort-by","filtro-estado"]),e("div",Vt,[e("div",null," Mostrando "+d(p.pagination.from||0)+" - "+d(p.pagination.to||0)+" de "+d(p.pagination.total||0)+" órdenes ",1),e("div",Ht,[t[15]||(t[15]=e("span",null,"Elementos por página:",-1)),e("select",{value:p.pagination.per_page||10,onChange:De,class:"border border-gray-300 rounded px-2 py-1 text-sm"},t[14]||(t[14]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),40,Wt)])]),e("div",Rt,[e("div",Gt,[e("div",qt,[e("div",Ut,[t[16]||(t[16]=e("h2",{class:"text-lg font-semibold text-gray-900 tracking-tight"},"Órdenes de Compra",-1)),e("div",Kt,d(se.value.length)+" de "+d(p.pagination.total||0)+" órdenes de compra ",1)])]),e("div",Xt,[e("table",Yt,[e("thead",Zt,[e("tr",null,[e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:t[3]||(t[3]=s=>X("fecha"))},[e("div",Jt,[t[18]||(t[18]=e("span",null,"Fecha",-1)),m.value.startsWith("fecha")?(l(),i("svg",{key:0,class:T(["w-4 h-4 transition-transform duration-200",m.value==="fecha-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[17]||(t[17]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):c("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:t[4]||(t[4]=s=>X("proveedor"))},[e("div",Qt,[t[20]||(t[20]=e("span",null,"Proveedor",-1)),m.value.startsWith("proveedor")?(l(),i("svg",{key:0,class:T(["w-4 h-4 transition-transform duration-200",m.value==="proveedor-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[19]||(t[19]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):c("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:t[5]||(t[5]=s=>X("numero_orden"))},[e("div",eo,[t[22]||(t[22]=e("span",null,"N° Orden",-1)),m.value.startsWith("numero_orden")?(l(),i("svg",{key:0,class:T(["w-4 h-4 transition-transform duration-200",m.value==="numero_orden-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):c("",!0)])]),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:t[6]||(t[6]=s=>X("total"))},[e("div",to,[t[24]||(t[24]=e("span",null,"Total",-1)),m.value.startsWith("total")?(l(),i("svg",{key:0,class:T(["w-4 h-4 transition-transform duration-200",m.value==="total-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[23]||(t[23]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):c("",!0)])]),t[27]||(t[27]=e("th",{class:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Productos ",-1)),e("th",{class:"group px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100/60 transition-colors duration-150",onClick:t[7]||(t[7]=s=>X("estado"))},[e("div",oo,[t[26]||(t[26]=e("span",null,"Estado",-1)),m.value.startsWith("estado")?(l(),i("svg",{key:0,class:T(["w-4 h-4 transition-transform duration-200",m.value==="estado-desc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[25]||(t[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2)):c("",!0)])]),t[28]||(t[28]=e("th",{class:"px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Acciones ",-1))])]),e("tbody",so,[se.value.length>0?(l(!0),i(z,{key:0},ee(se.value,s=>{var v,g,h,f,y;return l(),i("tr",{key:s.id,class:T(["group hover:bg-gray-50/60 transition-all duration-150 hover:shadow-sm",s.estado==="cancelada"?"opacity-50":""])},[e("td",ro,[e("div",ao,[e("div",no,d(K(s.created_at||s.fecha)),1),e("div",lo,d(Xe(s.created_at||s.fecha)),1)])]),e("td",io,[e("div",uo,[e("div",co,d(((v=s.proveedor)==null?void 0:v.nombre_razon_social)||"Sin proveedor"),1),(g=s.proveedor)!=null&&g.email?(l(),i("div",po,d((h=s.proveedor)==null?void 0:h.email),1)):c("",!0)])]),e("td",vo,[e("div",mo,d(s.numero_orden||"N/A"),1)]),e("td",go,[e("div",fo,[typeof s.total<"u"&&s.total!==null?(l(),i(z,{key:0},[w(" $"+d(M(s.total)),1)],64)):(l(),i(z,{key:1},[w("-")],64))])]),e("td",{class:"px-6 py-4 relative",onMouseenter:_=>{var F;return(F=N(s))!=null&&F.length?Ge(s,_):null},onMouseleave:pe,onMousemove:_=>{var F;return(F=N(s))!=null&&F.length?ve(_):null}},[e("div",{class:T(["flex items-center text-sm text-gray-600",(f=N(s))!=null&&f.length?"cursor-help hover:text-gray-800 transition-colors duration-150":"opacity-60"])},[t[29]||(t[29]=e("div",{class:"w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center mr-2 group-hover:bg-blue-100 transition-colors duration-150"},[e("svg",{class:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})])],-1)),e("span",yo,d(((y=N(s))==null?void 0:y.length)||0),1),t[30]||(t[30]=e("span",{class:"text-gray-400 ml-1"},"items",-1))],2)],40,xo),e("td",bo,[e("span",{class:T([me(s.estado),"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-150 hover:shadow-sm"])},[e("span",{class:T(["w-2 h-2 rounded-full mr-2 transition-all duration-150",ge(s.estado)])},null,2),w(" "+d(J(s.estado)),1)],2)]),e("td",ho,[e("div",_o,[e("button",{onClick:_=>ze(s),class:"group/btn relative inline-flex items-center justify-center w-8 h-8 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Ver detalles"},[V(R(Y),{icon:"eye",class:"w-3.5 h-3.5 transition-transform duration-200 group-hover/btn:scale-110"})],8,wo),s.estado==="borrador"||s.estado==="pendiente"?(l(),i("button",{key:0,onClick:_=>ie(s.id),class:"group/btn relative inline-flex items-center justify-center w-8 h-8 rounded-lg bg-amber-50 text-amber-600 hover:bg-amber-100 hover:text-amber-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-amber-500/50 focus:ring-offset-1",title:"Editar orden"},[V(R(Y),{icon:"edit",class:"w-3.5 h-3.5 transition-transform duration-200 group-hover/btn:scale-110"})],8,ko)):c("",!0),s.proveedor&&s.proveedor.email&&s.proveedor.email.trim()!==""?(l(),i("button",{key:1,onClick:_=>ce(s),class:"group/btn relative inline-flex items-center justify-center w-8 h-8 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 hover:text-green-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:ring-offset-1",title:s.email_enviado?"Reenviar por Email":"Enviar por Email"},[V(R(Y),{icon:s.email_enviado?"envelope-open":"envelope",class:"w-3.5 h-3.5 transition-transform duration-200 group-hover/btn:scale-110"},null,8,["icon"])],8,Co)):c("",!0),c("",!0),s.estado==="pendiente"?(l(),i("button",{key:3,onClick:_=>ue(s),class:"group/btn relative inline-flex items-center justify-center w-8 h-8 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 hover:text-blue-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:ring-offset-1",title:"Enviar orden al proveedor"},[V(R(Y),{icon:"paper-plane",class:"w-3.5 h-3.5 transition-transform duration-200 group-hover/btn:scale-110"})],8,Eo)):c("",!0),["pendiente","enviado_a_proveedor"].includes(s.estado)?(l(),i("button",{key:4,onClick:_=>de(s.id),class:"group/btn relative inline-flex items-center justify-center w-8 h-8 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-700 hover:shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-500/50 focus:ring-offset-1",title:"Cancelar orden"},[V(R(Y),{icon:"times-circle",class:"w-3.5 h-3.5 transition-transform duration-200 group-hover/btn:scale-110"})],8,To)):c("",!0)])])],2)}),128)):(l(),i("tr",$o,t[31]||(t[31]=[e("td",{colspan:7,class:"px-6 py-16 text-center"},[e("div",{class:"flex flex-col items-center space-y-4"},[e("div",{class:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),e("div",{class:"space-y-1"},[e("p",{class:"text-gray-700 font-medium"},"No hay órdenes de compra"),e("p",{class:"text-sm text-gray-500"},"Los documentos aparecerán aquí cuando se creen")])])],-1)])))])])])])]),p.pagination.last_page>1?(l(),i("div",Po,[e("button",{onClick:Ne,disabled:p.pagination.current_page===1,class:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Anterior ",8,jo),e("div",Mo,[!S.value.includes(1)&&p.pagination.last_page>7?(l(),i(z,{key:0},[e("button",{onClick:t[8]||(t[8]=s=>G(1)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," 1 "),t[32]||(t[32]=e("span",{class:"px-3 py-2 text-sm text-gray-500"},"...",-1))],64)):c("",!0),(l(!0),i(z,null,ee(S.value,s=>(l(),i("button",{key:s,onClick:v=>G(s),class:T(["px-3 py-2 text-sm font-medium border border-gray-300 rounded-md",s===p.pagination.current_page?"bg-blue-500 text-white border-blue-500":"text-gray-700 bg-white hover:bg-gray-50"])},d(s),11,Oo))),128)),!S.value.includes(p.pagination.last_page)&&p.pagination.last_page>7?(l(),i(z,{key:1},[t[33]||(t[33]=e("span",{class:"px-3 py-2 text-sm text-gray-500"},"...",-1)),e("button",{onClick:t[9]||(t[9]=s=>G(p.pagination.last_page)),class:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"},d(p.pagination.last_page),1)],64)):c("",!0)]),e("button",{onClick:Ie,disabled:p.pagination.current_page===p.pagination.last_page,class:"px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Siguiente ",8,Io)])):c("",!0)]),V(it,{name:"modal"},{default:je(()=>{var s,v,g,h,f,y,_,F,he,_e,we,ke,Ce;return[k.value?(l(),i("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:Me(Q,["self"])},[e("div",{class:T([{"max-w-md":$.value==="confirm"||$.value==="confirm-duplicate","max-w-4xl":$.value==="details"},"bg-white rounded-lg shadow-xl w-full max-h-[90vh] overflow-y-auto p-6 outline-none"]),role:"dialog","aria-modal":"true","aria-label":"Modal de Orden de Compra",tabindex:"-1",ref_key:"modalRef",ref:fe,onKeydown:lt(Me(Q,["prevent"]),["esc"])},[$.value==="confirm"?(l(),i("div",Fo,[t[34]||(t[34]=e("div",{class:"w-12 h-12 mx-auto bg-red-100 rounded-full flex items-center justify-center mb-4"},[e("svg",{class:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),t[35]||(t[35]=e("h3",{class:"text-lg font-medium mb-2"}," ¿Eliminar orden de compra? ",-1)),t[36]||(t[36]=e("p",{class:"text-gray-600 mb-6"}," Esta acción no se puede deshacer. ",-1)),e("div",{class:"flex gap-3"},[e("button",{onClick:Je,class:"flex-1 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"}," Cancelar "),e("button",{onClick:Qe,class:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Eliminar ")])])):$.value==="details"?(l(),i("div",Do,[e("h3",Lo,[t[37]||(t[37]=w(" Detalles de Orden de Compra ")),(s=a.value)!=null&&s.id?(l(),i("span",Bo,"#"+d(a.value.id),1)):c("",!0)]),u.value?(l(),i("div",So,[t[41]||(t[41]=e("h4",{class:"text-sm font-semibold text-gray-800 mb-3"},"Auditoría",-1)),e("div",Ao,[e("div",null,[t[38]||(t[38]=e("span",{class:"text-gray-500"},"Creado por:",-1)),e("div",zo,d(u.value.creado_por||"—"),1),e("div",Vo,d(K(u.value.creado_en)||"—"),1)]),e("div",null,[t[39]||(t[39]=e("span",{class:"text-gray-500"},"Actualizado por:",-1)),e("div",Ho,d(u.value.actualizado_por||"—"),1),e("div",Wo,d(K(u.value.actualizado_en)||"—"),1)]),u.value.eliminado_en?(l(),i("div",Ro,[t[40]||(t[40]=e("span",{class:"text-gray-500"},"Eliminado por:",-1)),e("div",Go,d(u.value.eliminado_por||"—"),1),e("div",qo,d(K(u.value.eliminado_en)||"—"),1)])):c("",!0)])])):c("",!0),a.value?(l(),i("div",Uo,[e("div",Ko,[e("div",null,[e("p",Xo,[t[42]||(t[42]=e("strong",null,"Proveedor:",-1)),w(" "+d(((v=a.value.proveedor)==null?void 0:v.nombre_razon_social)||"Sin proveedor"),1)]),(g=a.value.proveedor)!=null&&g.email?(l(),i("p",Yo,[t[43]||(t[43]=e("strong",null,"Email:",-1)),w(" "+d(a.value.proveedor.email),1)])):c("",!0),(h=a.value.proveedor)!=null&&h.telefono?(l(),i("p",Zo,[t[44]||(t[44]=e("strong",null,"Teléfono:",-1)),w(" "+d(a.value.proveedor.telefono),1)])):c("",!0),e("p",Jo,[t[45]||(t[45]=e("strong",null,"Fecha de creación:",-1)),w(" "+d(K(a.value.created_at)),1)]),e("p",Qo,[t[46]||(t[46]=e("strong",null,"Estado:",-1)),e("span",{class:T([me(a.value.estado),"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"])},[e("span",{class:T(["w-1.5 h-1.5 rounded-full mr-1.5",ge(a.value.estado)])},null,2),w(" "+d(J(a.value.estado)),1)],2)])]),e("div",null,[a.value.numero_orden?(l(),i("p",es,[t[47]||(t[47]=e("strong",null,"N° Orden:",-1)),w(" "+d(a.value.numero_orden),1)])):c("",!0),et(a.value.total)?(l(),i("p",ts,[t[48]||(t[48]=e("strong",null,"Total:",-1)),w(" $"+d(M(a.value.total)),1)])):c("",!0),e("p",os,[t[49]||(t[49]=e("strong",null,"Productos:",-1)),w(" "+d(((f=a.value.productos)==null?void 0:f.length)||0)+" items ",1)])])]),(y=N(a.value))!=null&&y.length?(l(),i("div",ss,[t[51]||(t[51]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Productos",-1)),e("div",rs,[e("table",as,[t[50]||(t[50]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Nombre "),e("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Cantidad "),e("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Precio "),e("th",{class:"px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"}," Subtotal ")])],-1)),e("tbody",ns,[(l(!0),i(z,null,ee(N(a.value),(D,tt)=>(l(),i("tr",{key:D.id||`${D.nombre}-${tt}`},[e("td",ls,d(D.nombre||"Sin nombre"),1),e("td",is,d(D.cantidad||0),1),e("td",ds," $"+d(M(ye(D))),1),e("td",us," $"+d(M((D.cantidad||0)*ye(D))),1)]))),128))])])])])):(l(),i("p",cs,"No hay productos asociados.")),(_=a.value.productos)!=null&&_.length?(l(),i("div",ps,[t[57]||(t[57]=e("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Resumen de Orden de Compra",-1)),e("div",vs,[e("div",ms,[t[52]||(t[52]=e("span",{class:"text-gray-600"},"Subtotal:",-1)),e("span",gs,"$"+d(M(a.value.subtotal||0)),1)]),(a.value.descuento_items||0)>0?(l(),i("div",fs,[t[53]||(t[53]=e("span",{class:"text-gray-600"},"Descuentos por Items:",-1)),e("span",xs,"-$"+d(M(a.value.descuento_items||0)),1)])):c("",!0),(a.value.descuento_general||0)>0?(l(),i("div",ys,[t[54]||(t[54]=e("span",{class:"text-gray-600"},"Descuento General:",-1)),e("span",bs,"-$"+d(M(a.value.descuento_general||0)),1)])):c("",!0),e("div",hs,[t[55]||(t[55]=e("span",{class:"text-gray-600"},"IVA (16%):",-1)),e("span",_s,"$"+d(M(a.value.iva||0)),1)]),e("div",ws,[t[56]||(t[56]=e("span",{class:"text-gray-900 font-semibold"},"Total:",-1)),e("span",ks,"$"+d(M(a.value.total||0)),1)])])])):c("",!0)])):(l(),i("div",Cs,"No hay datos disponibles.")),e("div",Es,[["borrador","pendiente"].includes((F=a.value)==null?void 0:F.estado)?(l(),i("button",{key:0,onClick:Ve,class:"px-3 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors text-sm"}," ✏️ Editar ")):c("",!0),(he=a.value)!=null&&he.proveedor&&((_e=a.value)!=null&&_e.proveedor.email)?(l(),i("button",{key:1,onClick:t[10]||(t[10]=D=>ce(a.value)),class:"px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"},d((we=a.value)!=null&&we.email_enviado?"📨 Reenviar Email":"📧 Enviar Email"),1)):c("",!0),((ke=a.value)==null?void 0:ke.estado)==="pendiente"?(l(),i("button",{key:2,onClick:t[11]||(t[11]=D=>ue(a.value)),class:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"}," 🚀 Enviar a Proveedor ")):c("",!0),["pendiente","enviado_a_proveedor"].includes((Ce=a.value)==null?void 0:Ce.estado)?(l(),i("button",{key:3,onClick:t[12]||(t[12]=D=>de(a.value.id)),class:"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm"}," ❌ Cancelar ")):c("",!0),e("button",{onClick:Q,class:"px-3 py-2 bg-gray-300 rounded-lg hover:bg-gray-400 transition-colors text-sm"}," Cerrar ")])])):c("",!0)],42,No)])):c("",!0)]}),_:1}),(l(),Pe(ut,{to:"body"},[q.value&&W.value?(l(),i("div",{key:0,class:"fixed z-[9999] bg-white rounded-xl shadow-xl border border-gray-200/50 backdrop-blur-sm w-80 max-h-96 pointer-events-auto transform transition-all duration-200 ease-out",style:dt(Ue.value),onMouseenter:qe,onMouseleave:pe},[e("div",Ts,[e("div",$s,[t[58]||(t[58]=e("h3",{class:"text-sm font-semibold text-gray-900"},"Productos",-1)),e("span",Ps,d(((r=N(W.value))==null?void 0:r.length)||0),1)])]),e("div",js,[(n=N(W.value))!=null&&n.length?(l(),i("div",Ms,[(l(!0),i(z,null,ee(N(W.value),(s,v)=>(l(),i("div",{key:v,class:"group p-3 bg-gray-50/70 rounded-lg hover:bg-gray-100/70 hover:shadow-sm transition-all duration-150"},[e("div",Os,[e("div",Is,[e("p",Ns,d(s.nombre||"Sin nombre"),1),e("div",Fs,[e("span",Ds,d(s.cantidad||0)+" und ",1),t[59]||(t[59]=e("span",{class:"text-gray-400"},"•",-1)),e("span",Ls," $"+d(M(s.precio||0)),1)]),s.descripcion?(l(),i("p",Bs,d(s.descripcion),1)):c("",!0)]),e("div",Ss,[e("p",As," $"+d(M((s.cantidad||0)*(s.precio||0))),1)])])]))),128))])):(l(),i("div",zs,t[60]||(t[60]=[e("div",{class:"w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 flex items-center justify-center"},[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m0 0V9a2 2 0 012-2h2m2 2v4"})])],-1),e("p",{class:"text-sm text-gray-500"},"Sin productos registrados",-1)])))])],36)):c("",!0)])),P.value?(l(),i("div",Vs,t[61]||(t[61]=[e("div",{class:"bg-white p-6 rounded-lg shadow-lg"},[e("div",{class:"flex items-center space-x-3"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e("span",{class:"text-gray-700"},"Procesando...")])],-1)]))):c("",!0)])],64)}}}),Xs=Oe(Hs,[["__scopeId","data-v-13629541"]]);export{Xs as default};
