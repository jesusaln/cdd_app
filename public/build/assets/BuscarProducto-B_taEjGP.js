import{r as u,c as k,p as q,H as D,i as n,o as r,f as o,k as v,b as R,v as E,z as H,n as p,t as l,l as m,F as w,m as C,J as $,M as U}from"./vendor-d19pJyVS.js";const X={class:"buscar-producto"},J={class:"mb-6"},W={class:"relative"},Y={class:"flex flex-wrap gap-2 mt-3"},G={key:0,class:"mt-6"},K={class:"flex flex-wrap gap-2"},O={key:1,class:"mt-6"},Q={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},Z=["onClick"],tt={class:"flex items-center justify-between"},ot={class:"flex-1"},et={class:"flex items-center"},st={class:"text-sm font-medium text-gray-900"},rt={class:"text-xs text-gray-500 mt-1"},nt={class:"text-right"},lt={class:"text-sm font-semibold text-green-600"},at={key:0,class:"text-xs text-gray-500"},it={class:"grid grid-cols-12 gap-2 items-center"},ct={class:"col-span-1"},dt={key:0,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ut={key:1,class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pt={class:"col-span-3"},gt={class:"font-medium text-gray-900 text-sm"},vt={key:0,class:"text-xs text-gray-500 truncate"},xt={class:"col-span-2"},ft={class:"text-sm text-gray-600 font-mono"},bt={class:"col-span-2"},kt={class:"text-sm text-gray-600"},yt={class:"col-span-2"},ht={class:"text-sm font-semibold text-green-600"},mt={class:"col-span-1"},_t={key:1,class:"text-xs text-gray-400"},wt={class:"col-span-1"},Ct=["onClick","disabled"],Lt={__name:"BuscarProducto",props:{productos:{type:Array,default:()=>[]},servicios:{type:Array,default:()=>[]},validarStock:{type:Boolean,default:!0}},emits:["agregar-producto"],setup(z,{expose:j,emit:N}){const x=z,P=N,c=u(""),f=u(!1),a=u("todos"),g=u([]),b=u(null),_=u(0),d=u({top:0,left:0,height:0});j({focus:()=>{b.value&&b.value.focus()}});const y=k(()=>{const s=(x.productos||[]).map(t=>({...t,tipo:"producto"})),e=(x.servicios||[]).map(t=>({...t,tipo:"servicio"}));return[...s,...e]}),h=k(()=>{let s=y.value;if(a.value==="productos"?s=s.filter(e=>e.tipo==="producto"):a.value==="servicios"&&(s=s.filter(e=>e.tipo==="servicio")),c.value){const e=c.value.toLowerCase();s=s.filter(t=>t.nombre.toLowerCase().includes(e)||t.codigo&&t.codigo.toLowerCase().includes(e)||t.categoria&&(typeof t.categoria=="string"?t.categoria.toLowerCase().includes(e):t.categoria.nombre.toLowerCase().includes(e))||t.descripcion&&t.descripcion.toLowerCase().includes(e))}return s.slice(0,50)}),V=k(()=>y.value.filter(s=>s.tipo==="producto").length),F=k(()=>y.value.filter(s=>s.tipo==="servicio").length),B=k(()=>y.value.filter(s=>s.tipo==="producto"?(s.stock_total||s.stock)>0:!0).sort((s,e)=>s.tipo==="producto"&&e.tipo==="producto"?(e.stock_total||e.stock)-(s.stock_total||s.stock):0).slice(0,6)),T=()=>{f.value=!0,A()},L=s=>{if(x.validarStock&&s.tipo==="producto"&&(s.stock_total||s.stock)<=0)return;const e={...s};g.value.findIndex(i=>i.id===s.id&&i.tipo===s.tipo)===-1&&(g.value.unshift(e),g.value.length>5&&g.value.pop()),P("agregar-producto",s),c.value="",f.value=!1},S=s=>(Number.parseFloat(s)||0).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}),A=()=>{if(!b.value)return;const s=b.value.getBoundingClientRect();_.value=s.width,d.value={top:s.top+window.scrollY,left:s.left+window.scrollX,height:s.height}},M=s=>{s.target.closest(".buscar-producto")||(f.value=!1)};return q(()=>{document.addEventListener("click",M)}),D(()=>{document.removeEventListener("click",M)}),(s,e)=>(r(),n("div",X,[o("div",J,[e[6]||(e[6]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Buscar Productos y Servicios ",-1)),o("div",W,[E(o("input",{ref_key:"inputBusqueda",ref:b,type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),onInput:T,onFocus:e[1]||(e[1]=t=>f.value=!0),placeholder:"Buscar por nombre, código, categoría o descripción...",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm"},null,544),[[H,c.value]]),e[5]||(e[5]=o("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center"},[o("svg",{class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))]),o("div",Y,[o("button",{type:"button",onClick:e[2]||(e[2]=t=>a.value="todos"),class:p(["px-3 py-1 text-xs font-medium rounded-full transition-colors duration-200",a.value==="todos"?"bg-green-100 text-green-800 border-green-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-gray-300"])}," Todos ("+l(h.value.length)+") ",3),o("button",{type:"button",onClick:e[3]||(e[3]=t=>a.value="productos"),class:p(["px-3 py-1 text-xs font-medium rounded-full transition-colors duration-200",a.value==="productos"?"bg-blue-100 text-blue-800 border-blue-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-gray-300"])}," Productos ("+l(V.value)+") ",3),o("button",{type:"button",onClick:e[4]||(e[4]=t=>a.value="servicios"),class:p(["px-3 py-1 text-xs font-medium rounded-full transition-colors duration-200",a.value==="servicios"?"bg-purple-100 text-purple-800 border-purple-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-gray-300"])}," Servicios ("+l(F.value)+") ",3)])]),g.value.length>0?(r(),n("div",G,[e[8]||(e[8]=o("h3",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[o("svg",{class:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),m(" Agregados recientemente ")],-1)),o("div",K,[(r(!0),n(w,null,C(g.value,t=>(r(),n("span",{key:`reciente-${t.tipo}-${t.id}`,class:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},[m(l(t.nombre)+" ",1),e[7]||(e[7]=o("svg",{class:"w-3 h-3 ml-1 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1))]))),128))])])):v("",!0),!c.value&&B.value.length>0?(r(),n("div",O,[e[9]||(e[9]=o("h3",{class:"text-sm font-medium text-gray-700 mb-3 flex items-center"},[o("svg",{class:"w-4 h-4 mr-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),m(" Sugerencias rápidas ")],-1)),o("div",Q,[(r(!0),n(w,null,C(B.value,t=>{var i;return r(),n("div",{key:`sugerencia-${t.tipo}-${t.id}`,onClick:I=>L(t),class:"p-3 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 cursor-pointer transition-all duration-200"},[o("div",tt,[o("div",ot,[o("div",et,[o("span",{class:p(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mr-2",t.tipo==="producto"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"])},l(t.tipo==="producto"?"P":"S"),3),o("span",st,l(t.nombre),1)]),o("div",rt,l(typeof t.categoria=="string"?t.categoria:((i=t.categoria)==null?void 0:i.nombre)||"Sin categoría"),1)]),o("div",nt,[o("div",lt," $"+l(S(t.tipo==="producto"?t.precio_venta:t.precio)),1),t.tipo==="producto"?(r(),n("div",at," Stock: "+l(t.stock_total||t.stock||0),1)):v("",!0)])])],8,Z)}),128))])])):v("",!0),(r(),R(U,{to:"#app"},[f.value&&h.value.length>0?(r(),n("div",{key:0,class:"z-50 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-y-auto",style:$({position:"absolute",width:_.value+"px",top:d.value.top+d.value.height+"px",left:d.value.left+"px"})},[e[13]||(e[13]=o("div",{class:"sticky top-0 bg-gray-50 border-b border-gray-200 px-4 py-2"},[o("div",{class:"grid grid-cols-12 gap-2 text-xs font-medium text-gray-600"},[o("div",{class:"col-span-1"},"Tipo"),o("div",{class:"col-span-3"},"Nombre"),o("div",{class:"col-span-2"},"Código"),o("div",{class:"col-span-2"},"Categoría"),o("div",{class:"col-span-2"},"Precio"),o("div",{class:"col-span-1"},"Stock"),o("div",{class:"col-span-1"},"Acción")])],-1)),(r(!0),n(w,null,C(h.value,t=>{var i;return r(),n("div",{key:`${t.tipo}-${t.id}`,class:"px-4 py-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0"},[o("div",it,[o("div",ct,[o("span",{class:p(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",t.tipo==="producto"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"])},[t.tipo==="producto"?(r(),n("svg",dt,e[10]||(e[10]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4-8-4m16 0v10l-8 4-8-4V7"},null,-1)]))):(r(),n("svg",ut,e[11]||(e[11]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"},null,-1),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)]))),m(" "+l(t.tipo==="producto"?"P":"S"),1)],2)]),o("div",pt,[o("div",gt,l(t.nombre),1),t.descripcion?(r(),n("div",vt,l(t.descripcion),1)):v("",!0)]),o("div",xt,[o("span",ft,l(t.codigo||"N/A"),1)]),o("div",bt,[o("span",kt,l(typeof t.categoria=="string"?t.categoria:((i=t.categoria)==null?void 0:i.nombre)||"Sin categoría"),1)]),o("div",yt,[o("span",ht," $"+l(S(t.tipo==="producto"?t.precio_venta:t.precio)),1)]),o("div",mt,[t.tipo==="producto"?(r(),n("span",{key:0,class:p(["text-xs px-2 py-1 rounded-full font-medium",(t.stock_total||t.stock)>10?"bg-green-100 text-green-800":(t.stock_total||t.stock)>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},l(t.stock_total||t.stock||0),3)):(r(),n("span",_t,"∞"))]),o("div",wt,[o("button",{type:"button",onClick:I=>L(t),disabled:x.validarStock&&t.tipo==="producto"&&(t.stock_total||t.stock)<=0,class:p(["w-full px-2 py-1 text-xs font-medium rounded-md transition-colors duration-200",x.validarStock&&t.tipo==="producto"&&(t.stock_total||t.stock)<=0?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1"])},e[12]||(e[12]=[o("svg",{class:"w-3 h-3 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1)]),10,Ct)])])])}),128))],4)):v("",!0),c.value&&h.value.length===0?(r(),n("div",{key:1,class:"px-4 py-8 text-center text-gray-500 z-50 bg-white border border-gray-300 rounded-lg shadow-lg",style:$({position:"absolute",width:_.value+"px",top:d.value.top+d.value.height+"px",left:d.value.left+"px"})},e[14]||(e[14]=[o("svg",{class:"w-12 h-12 mx-auto text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),o("p",{class:"text-sm font-medium"},"No se encontraron resultados",-1),o("p",{class:"text-xs text-gray-400 mt-1"},"Intenta con otros términos de búsqueda",-1)]),4)):v("",!0)]))]))}};export{Lt as _};
