import{E as b}from"./jspdf.es.min-BE3S9W4e.js";const z={nombre:"CLIMAS DEL DESIERTO",propietario:"JESUS ALBERTO LOPEZ NORIEGA",direccion:"Av. Paseo de la Reina, 2345",telefono:"(55) 5555-5555",email:"jesus@climasdeldesierto.com",web:"www.climasdeldesierto.com"},t={margen:{izquierdo:14,derecho:196,superior:10,inferior:280},fuentes:{titulo:{size:18,style:"bold"},subtitulo:{size:12,style:"bold"},encabezado:{size:10,style:"normal"},texto:{size:8,style:"normal"},textoSmall:{size:7,style:"normal"}},colores:{primario:[41,128,185],secundario:[52,73,94],texto:[44,62,80],linea:[189,195,199]}};class u{static formatearFecha(o){return!o||Number.isNaN(new Date(o).getTime())?new Date().toLocaleDateString("es-MX"):new Date(o).toLocaleDateString("es-MX")}static formatearMoneda(o,e="MXN"){const s=Number(o)||0;return new Intl.NumberFormat("es-MX",{style:"currency",currency:e}).format(s)}static truncarTexto(o,e=50){return o?o.length>e?`${o.substring(0,e)}...`:o:""}static validarDatos(o){const e=[];return o?(o.id||e.push("ID del documento no encontrado"),o.cliente||e.push("Datos del cliente no encontrados"),(!o.productos||!Array.isArray(o.productos))&&e.push("Lista de productos no válida"),e):(e.push("No se proporcionaron datos"),e)}}class Y{constructor(){this.doc=new b,this.posicionY=t.margen.superior,this.paginaActual=1}setFont(o,e="normal"){this.doc.setFontSize(o),this.doc.setFont("helvetica",e)}setColor(o){this.doc.setTextColor(...o)}verificarEspacio(o=20){return this.posicionY+o>t.margen.inferior?(this.nuevaPagina(),!0):!1}nuevaPagina(){this.doc.addPage(),this.paginaActual++,this.posicionY=t.margen.superior,this.agregarNumeroPagina()}agregarNumeroPagina(){this.setFont(t.fuentes.textoSmall.size,t.fuentes.textoSmall.style),this.setColor(t.colores.texto),this.doc.text(`Página ${this.paginaActual}`,t.margen.derecho-20,290,{align:"right"})}agregarLinea(o=this.posicionY){this.doc.setDrawColor(...t.colores.linea),this.doc.line(t.margen.izquierdo,o,t.margen.derecho,o)}agregarEncabezado(){const{nombre:o,propietario:e,direccion:s,telefono:i,email:n,web:r}=z;this.setFont(t.fuentes.titulo.size,t.fuentes.titulo.style),this.setColor(t.colores.primario),this.doc.text(o,105,this.posicionY+10,{align:"center"}),this.setFont(t.fuentes.encabezado.size,t.fuentes.encabezado.style),this.setColor(t.colores.secundario),this.doc.text(e,105,this.posicionY+18,{align:"center"}),this.setFont(t.fuentes.texto.size,t.fuentes.texto.style),this.setColor(t.colores.texto),[s,i,n,r].forEach((l,a)=>{this.doc.text(l,105,this.posicionY+24+a*4,{align:"center"})}),this.posicionY+=45,this.agregarLinea(),this.posicionY+=8}agregarTituloDocumento(o,e){this.setFont(t.fuentes.subtitulo.size,t.fuentes.subtitulo.style),this.setColor(t.colores.primario),this.doc.text(o.toUpperCase(),t.margen.izquierdo,this.posicionY),this.posicionY+=8,this.setFont(t.fuentes.texto.size,t.fuentes.texto.style),this.setColor(t.colores.texto),this.doc.text(`Número: ${e.id}`,t.margen.izquierdo,this.posicionY),this.doc.text(`Fecha: ${u.formatearFecha(e.fecha)}`,140,this.posicionY),this.posicionY+=8,this.agregarLinea(),this.posicionY+=8}agregarInformacionCliente(o){if(!o){console.warn("No se proporcionó cliente");return}this.verificarEspacio(50),this.setFont(t.fuentes.subtitulo.size,t.fuentes.subtitulo.style),this.setColor(t.colores.secundario),this.doc.text("CLIENTE",t.margen.izquierdo,this.posicionY),this.posicionY+=8;const e=o.nombre||o.nombre_razon_social||"Cliente sin nombre",s=o.rfc||"RFC no proporcionado",i=o.email||"Sin correo",n=o.telefono||o.celular||"Sin teléfono",r=this.construirDireccion(o),c=o.regimen_fiscal||"No especificado",l=o.uso_cfdi||"No especificado",a=[["Nombre:",e],["RFC:",s],["Dirección:",r],["Email:",i],["Teléfono:",n],["Régimen Fiscal:",c],["Uso CFDI:",l]];this.setFont(t.fuentes.texto.size,t.fuentes.texto.style),a.forEach(([h,d],m)=>{if(!d)return;const p=m%2===0?t.margen.izquierdo:110,f=this.posicionY+Math.floor(m/2)*6;this.doc.setFont("helvetica","bold"),this.setColor(t.colores.secundario),this.doc.text(h,p,f),this.doc.setFont("helvetica","normal"),this.setColor(t.colores.texto);const x=u.truncarTexto(d,35);this.doc.text(x,p+25,f)}),this.posicionY+=Math.ceil(a.length/2)*6+5,this.agregarLinea(),this.posicionY+=8}construirDireccion(o){if(!o)return"N/A";const e=[o.calle,o.numero_exterior,o.numero_interior?`Int. ${o.numero_interior}`:null,o.colonia,o.codigo_postal,o.municipio,o.estado,o.pais].filter(Boolean);return e.length>0?e.join(", "):"Dirección no proporcionada"}agregarTablaProductos(o){if(!o||o.length===0)return this.doc.text("No hay productos registrados",t.margen.izquierdo,this.posicionY),this.posicionY+=10,0;this.verificarEspacio(40),this.setFont(t.fuentes.texto.size,"bold"),this.setColor(t.colores.secundario),[{texto:"Cant.",x:t.margen.izquierdo},{texto:"Concepto",x:35},{texto:"Precio Unit.",x:130},{texto:"Subtotal",x:170}].forEach(i=>{this.doc.text(i.texto,i.x,this.posicionY)}),this.posicionY+=4,this.agregarLinea(),this.posicionY+=6,this.setFont(t.fuentes.texto.size,"normal"),this.setColor(t.colores.texto);let s=0;return o.forEach(i=>{var a,h;this.verificarEspacio(8);const n=((a=i.pivot)==null?void 0:a.cantidad)||1,r=((h=i.pivot)==null?void 0:h.precio)||i.precio||0,c=n*r;s+=c,this.doc.text(n.toString(),t.margen.izquierdo,this.posicionY);const l=u.truncarTexto(i.nombre||"Producto sin nombre",45);this.doc.text(l,35,this.posicionY),this.doc.text(u.formatearMoneda(r),130,this.posicionY),this.doc.text(u.formatearMoneda(c),170,this.posicionY),this.posicionY+=6}),this.posicionY+=4,this.agregarLinea(),this.posicionY+=8,s}agregarTotales(o,e){const s=o.total||e,i=o.iva||s*.16,n=o.subtotal||s-i;this.verificarEspacio(25),this.setFont(t.fuentes.texto.size,"normal"),this.setColor(t.colores.texto);const r=[["Subtotal:",n],["IVA (16%):",i],["TOTAL:",s]];r.forEach(([c,l],a)=>{const h=a===r.length-1;h&&(this.setFont(t.fuentes.subtitulo.size,"bold"),this.setColor(t.colores.primario)),this.doc.text(c,140,this.posicionY),this.doc.text(u.formatearMoneda(l),170,this.posicionY),this.posicionY+=h?8:6})}agregarPiePagina(o=""){o&&(this.setFont(t.fuentes.textoSmall.size,"italic"),this.setColor(t.colores.texto),this.doc.text(o,105,285,{align:"center"})),this.agregarNumeroPagina()}}const E=(g,o,e={})=>{console.log("Generando PDF con datos:",o);try{const s=u.validarDatos(o);if(s.length>0)throw console.error("Errores en los datos:",s),new Error(`Datos inválidos: ${s.join(", ")}`);const i=new Y;i.agregarEncabezado(),i.agregarTituloDocumento(g,o),i.agregarInformacionCliente(o.cliente);const n=i.agregarTablaProductos(o.productos);i.agregarTotales(o,n),e.mensaje?i.agregarPiePagina(e.mensaje):i.agregarNumeroPagina();const r=e.nombreArchivo||`${g.replace(/\s+/g,"_")}_${o.id}_${Date.now()}.pdf`;return e.retornarBlob?i.doc.output("blob"):(e.abrirEnNuevaVentana?i.doc.output("dataurlnewwindow"):i.doc.save(r),console.log(`PDF "${r}" generado exitosamente`),!0)}catch(s){throw console.error("Error al generar PDF:",s),new Error(`Error al generar PDF: ${s.message}`)}};export{E as g};
