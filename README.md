Tips para commits m√°s r√°pidos

cuando haga una actualizacion corro este en el vps

cd /srv/laravel-app/src
./update-from-github.sh

No subas node_modules ni vendor, deja que otros reconstruyan dependencias con:

composer install
npm install

Usa git add . solo despu√©s de limpiar archivos temporales o ignorados.

Para cambios frecuentes en frontend (Vite), solo sube el c√≥digo fuente (resources/js, resources/css, vite.config.js) y deja que la compilaci√≥n se haga en cada entorno.

# üè¢ Asistencia Vircom

Aplicaci√≥n desarrollada con Laravel + Vue.js para la gesti√≥n y administraci√≥n de asistencia t√©cnica y servicios de CDD.

## Caracter√≠sticas principales

-   Interfaz moderna y responsiva con Vue.js.
-   Estructura modular para facilitar el mantenimiento y la escalabilidad.
-   Integraci√≥n con servicios backend.
-   Gesti√≥n de usuarios y permisos.
-   Registro y consulta de datos relevantes.
-   Soporte para m√∫ltiples roles y funcionalidades extendidas.

## üöÄ Despliegue R√°pido (Producci√≥n)

### üî• Comando M√°s R√°pido (Una Sola L√≠nea)

```bash
# Desplegar completamente desde cero
git clone https://github.com/jesusaln/cdd_app.git /opt/cdd_app && cd /opt/cdd_app && DOCKER_BUILDKIT=1 docker compose up -d --build && sleep 10 && docker compose exec app php artisan migrate:fresh --force
```

### üìã Scripts Autom√°ticos

#### Despliegue Completo (Nuevo Servidor)
```bash
cd /opt && git clone https://github.com/jesusaln/cdd_app.git && cd cdd_app && chmod +x deploy.sh && ./deploy.sh cdd_app
```

#### Actualizaci√≥n R√°pida (Servidores Existentes)
```bash
cd /opt/cdd_app && git pull && docker compose down && DOCKER_BUILDKIT=1 docker compose up -d --build && docker compose exec app php artisan migrate:fresh --force
```

### üõ†Ô∏è Comandos Paso a Paso

```bash
# 1. Preparar entorno
cd /opt && sudo mkdir -p cdd_app && cd cdd_app

# 2. Obtener c√≥digo
git clone https://github.com/jesusaln/cdd_app.git .

# 3. Construir e iniciar
DOCKER_BUILDKIT=1 docker compose up -d --build

# 4. Esperar y migrar
sleep 10 && docker compose exec app php artisan migrate:fresh --force

# 5. Finalizar
docker compose exec app php artisan storage:link || true
```

### üÜò Soluci√≥n de Problemas

```bash
# Borrado completo y nuevo inicio (si hay problemas)
cd /opt/cdd_app && docker compose down -v --remove-orphans && docker image prune -f && git pull origin master && DOCKER_BUILDKIT=1 docker compose up -d --build && docker compose exec app php artisan migrate:fresh --force
```

### üìä Comandos de Verificaci√≥n

```bash
# Ver estado de servicios
docker compose ps

# Ver logs en tiempo real
docker compose logs -f app

# Ver estado de migraciones
docker compose exec app php artisan migrate:status

# Informaci√≥n de la aplicaci√≥n
docker compose exec app php artisan about
```

## Instalaci√≥n (Desarrollo Local)

1. Clona el repositorio:
    ```bash
    git clone https://github.com/jesusaln/cdd_app.git
    ```
2. Ingresa al directorio del proyecto:
    ```bash
    cd cdd_app
    ```
3. Instala las dependencias:
    ```bash
    npm install
    ```
4. Inicia la aplicaci√≥n en modo desarrollo:
    ```bash
    npm run serve
    ```

## Testing

### Comandos de Test

Para ejecutar tests con datos frescos (recomendado para desarrollo):

```bash
# Usando comandos directos de PHP
php artisan migrate:fresh --seed && php artisan test --filter=Cliente

# Usando npm scripts
npm run test:fresh && npm run test:cliente
```

### Tests Disponibles

- **ClienteControllerTest**: Tests de integraci√≥n para el controlador de clientes
- **CrudTest**: Tests b√°sicos de CRUD para clientes
- **ModelTest**: Tests del modelo Cliente
- **SchemaTest**: Tests de estructura de base de datos

### Funcionalidades del M√≥dulo de Clientes

#### ‚úÖ Caracter√≠sticas Implementadas

- **Autocompletado de Direcci√≥n**: Al ingresar un c√≥digo postal v√°lido, se autocompletan autom√°ticamente:
  - Estado (clave SAT)
  - Municipio
  - Lista de colonias disponibles
- **Validaciones Avanzadas**: CFDI 4.0, RFC √∫nico, email en min√∫sculas
- **Valores por Defecto**: Estado "SON" (Sonora), Uso CFDI "G03" (Gastos en general)
- **Tel√©fono de 10 D√≠gitos**: Validaci√≥n estricta de exactamente 10 n√∫meros
- **Soft Deletes**: Eliminaci√≥n suave con posibilidad de restaurar
- **Sistema de Permisos**: Control de acceso granular
- **Integraci√≥n Facturapi**: Sincronizaci√≥n autom√°tica con servicio de facturaci√≥n
- **UX Optimizada**: Bot√≥n cambiar estado solo en modal (no en tabla principal)
- **Props Vue Corregidos**: Eliminados warnings de atributos no heredados

## ‚ö†Ô∏è Soluci√≥n de Problemas Comunes

### ‚ùå Error: "columna regimen_fiscal_receptor ya existe"
**Soluci√≥n:** Este error ocurre por una migraci√≥n duplicada. Usa este comando:
```bash
cd /opt/cdd_app && docker compose exec app rm -f database/migrations/2025_09_18_152246_add_regimen_fiscal_receptor_to_sat_usos_cfdi_table.php && docker compose exec app php artisan migrate:fresh --force
```

### ‚ùå Error: "function datetime() does not exist" (PostgreSQL)
**Soluci√≥n:** Este error ocurre cuando se usa sintaxis de SQLite en PostgreSQL. Usa este comando:
```bash
cd /opt/cdd_app && git pull origin master && docker compose exec app php artisan migrate:fresh --force
```

### ‚ùå Error: Puerto ocupado o servicios no responden
**Soluci√≥n:** Limpiar completamente y reiniciar:
```bash
cd /opt/cdd_app && docker compose down -v --remove-orphans && docker image prune -f && DOCKER_BUILDKIT=1 docker compose up -d --build
```

## üåê Acceso a la Aplicaci√≥n

### Producci√≥n (con Docker + Nginx)
- **Direcci√≥n externa:** `http://localhost:8080` o `https://admin.asistenciavircom.com`
- **Puerto externo:** `8080` (puerto HTTP est√°ndar para esta aplicaci√≥n)
- **Puerto interno:** `80` (Laravel dentro del contenedor)
- **HTTPS (recomendado):** `https://admin.asistenciavircom.com` (puerto 443)

### ‚òÅÔ∏è Despliegue P√∫blico con Dominio

Para hacer la aplicaci√≥n accesible p√∫blicamente:

1. **Configurar dominio** apuntando a la IP de tu servidor
2. **Abrir puertos** en el firewall:
   ```bash
   sudo ufw allow 80   # HTTP
   sudo ufw allow 443  # HTTPS
   ```
3. **Configurar SSL** con Let's Encrypt (ver arriba)
4. **Acceso p√∫blico:** `https://admin.asistenciavircom.com`

### Desarrollo Local
- **Direcci√≥n:** `http://localhost:8000` (Laravel integrado)
- **Direcci√≥n alternativa:** `http://localhost:8080` (Vue.js independiente)

### Configuraci√≥n Nginx
- Nginx act√∫a como proxy reverso
- Escucha en puerto 8080 externamente (y 443 para SSL)
- Redirige al contenedor `app:80` internamente
- Archivos est√°ticos servidos directamente por Nginx
- Red interna dedicada `cdd_network` para aislamiento

### üåê Configuraci√≥n SSL/HTTPS con Let's Encrypt

Para hacer la aplicaci√≥n p√∫blica con HTTPS:

1. **Configurar dominio** apuntando a tu servidor
2. **Instalar Certbot** para Let's Encrypt:
   ```bash
   # En el servidor host (no en Docker)
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d admin.asistenciavircom.com
   ```
3. **Configurar renovaci√≥n autom√°tica**:
   ```bash
   sudo crontab -e
   # Agregar: 0 12 * * * /usr/bin/certbot renew --quiet
   ```

## Uso

Una vez desplegada, accede a la aplicaci√≥n seg√∫n tu configuraci√≥n:

- **Producci√≥n:** `http://localhost:8080` (puerto 8080 por defecto)
- **Desarrollo:** `http://localhost:8000` (Laravel) o `http://localhost:8080` (Vue.js)

Explora las secciones y funcionalidades disponibles seg√∫n tu rol.

## üìÅ Archivos de Despliegue

Hemos incluido scripts para facilitar el despliegue:

- **`deploy.sh`** - Script completo de despliegue autom√°tico para nuevos servidores
- **`update.sh`** - Script para actualizar instalaciones existentes
- **`comandos_rapidos.md`** - Documentaci√≥n detallada con todos los comandos disponibles

## Estructura del proyecto

```
cdd_app/
‚îú‚îÄ‚îÄ deploy.sh              # üöÄ Script de despliegue autom√°tico
‚îú‚îÄ‚îÄ update.sh              # üîÑ Script de actualizaci√≥n r√°pida
‚îú‚îÄ‚îÄ comandos_rapidos.md    # üìã Documentaci√≥n de comandos
‚îú‚îÄ‚îÄ docker-compose.yml     # ‚öôÔ∏è Configuraci√≥n Docker
‚îú‚îÄ‚îÄ database/migrations/   # üóÑÔ∏è Migraciones de base de datos
‚îú‚îÄ‚îÄ resources/             # üé® Frontend (Vue.js)
‚îú‚îÄ‚îÄ app/                   # üõ†Ô∏è C√≥digo backend (Laravel)
‚îî‚îÄ‚îÄ README.md              # üìñ Esta documentaci√≥n
```

## Contribuci√≥n

1. Haz un fork del repositorio.
2. Crea una nueva rama con tu mejora: `git checkout -b mejora/feature-nueva`.
3. Realiza el commit de tus cambios: `git commit -m 'Agrega nueva funcionalidad'`.
4. Haz push a la rama: `git push origin mejora/feature-nueva`.
5. Abre un Pull Request.

## üéØ Resumen - Inicio R√°pido

### Para Nuevo Servidor (Producci√≥n)
```bash
git clone https://github.com/jesusaln/cdd_app.git /opt/cdd_app && cd /opt/cdd_app && DOCKER_BUILDKIT=1 docker compose up -d --build && sleep 10 && docker compose exec app php artisan migrate:fresh --force
```
**üåê Acceso:** `http://localhost:8080` (puerto 8080) o `https://admin.asistenciavircom.com` (puerto 443)

### Para Servidor Existente (Actualizaci√≥n)
```bash
cd /opt/cdd_app && git pull && docker compose down && DOCKER_BUILDKIT=1 docker compose up -d --build && docker compose exec app php artisan migrate:fresh --force
```
**üåê Acceso:** `http://localhost:8080` (puerto 8080) o `https://admin.asistenciavircom.com` (puerto 443)

### Para Desarrollo Local
```bash
git clone https://github.com/jesusaln/cdd_app.git && cd cdd_app && npm install && npm run dev
```
**üåê Acceso:** `http://localhost:8000` (Laravel) o `http://localhost:8080` (Vue.js)

### Problemas Comunes
- **Columna duplicada:** `rm -f database/migrations/2025_09_18_152246_add_regimen_fiscal_receptor_to_sat_usos_cfdi_table.php`
- **Error PostgreSQL:** `git pull` para obtener correcciones autom√°ticas
- **Puerto ocupado:** Usa `http://localhost:8080` (no `http://localhost:8000`) en producci√≥n

## Licencia

Consulta el archivo LICENSE para detalles sobre la licencia del proyecto.

---

# cdd_app

Application developed with Vue.js for management and administration of information related to CDD.

## Main features

-   Modern, responsive interface built with Vue.js.
-   Modular structure for easy maintenance and scalability.
-   Integration with backend services.
-   User and permission management.
-   Registration and consultation of relevant data.
-   Support for multiple roles and extended functionalities.

## Installation

1. Clone the repository:
    ```bash
    git clone https://github.com/jesusaln/cdd_app.git
    ```
2. Enter the project directory:
    ```bash
    cd cdd_app
    ```
3. Install dependencies:
    ```bash
    npm install
    ```
4. Start the application in development mode:
    ```bash
    npm run serve
    ```

## Usage

-   Go to `http://localhost:8080` in your browser.
-   Explore the available sections and features according to your user role.

## Project Structure

```
cdd_app/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ router/
‚îÇ   ‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îî‚îÄ‚îÄ App.vue
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## Contribution

1. Fork the repository.
2. Create a new branch for your improvement: `git checkout -b feature/new-feature`.
3. Commit your changes: `git commit -m 'Add new functionality'`.
4. Push the branch: `git push origin feature/new-feature`.
5. Open a Pull Request.

## License

See the LICENSE file for project license details.
